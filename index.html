<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <title>七七手机</title>

    <!-- Favicon 配置 -->
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="https://i.postimg.cc/tCg8Vw0P/app20.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="https://i.postimg.cc/tCg8Vw0P/app20.png"
    />
    <link rel="shortcut icon" href="https://i.postimg.cc/tCg8Vw0P/app20.png" />

    <!-- 防止HTML被浏览器缓存，确保用户获取最新版本 -->
    <meta
      http-equiv="Cache-Control"
      content="no-cache, no-store, must-revalidate"
    />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />

    <!-- iOS PWA 配置 -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="apple-mobile-web-app-title" content="七七手机" />
    <meta name="theme-color" content="#000000" />
    <link rel="manifest" href="manifest.json" />
    <link
      rel="apple-touch-icon"
      href="https://i.postimg.cc/tCg8Vw0P/app20.png"
    />

    <!-- Service Worker 注册 -->
    <script>
      // 注册 Service Worker
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", function () {
          navigator.serviceWorker
            .register("./sw.js")
            .then(function (registration) {
              // 1. 注册成功
              console.log(
                "Service Worker 注册成功，作用域:",
                registration.scope
              );

              // 2. 手动检查更新 (每次页面加载都检查)
              registration.update();

              // 3. 监听发现新 Service Worker
              registration.onupdatefound = () => {
                const newWorker = registration.installing;
                newWorker.onstatechange = () => {
                  if (newWorker.state === "installed") {
                    if (navigator.serviceWorker.controller) {
                      // 新内容已安装，但还没激活 -> 【确实有更新】
                      console.log("检测到 Service Worker 更新");
                      if (window.showUpdateNotification) {
                        window.showUpdateNotification();
                      }
                    } else {
                      // 首次安装内容
                      console.log("内容已缓存供离线使用");
                    }
                  }
                };
              };
            })
            .catch((error) => {
              console.error("Service Worker 注册失败:", error);
            });

          // 4. 监听 controllerchange (当新SW接管页面时，通常意味着已更新并刷新)
          navigator.serviceWorker.addEventListener("controllerchange", () => {
            console.log("Service Worker 控制权已变更 (页面已更新)");
          });
        });
      }
    </script>

    <!-- 版本检测和更新提示系统 -->
    <script>
      (function () {
        const CURRENT_VERSION = "2.15364"; // 当前版本号
        const VERSION_KEY = "app_version";
        const LAST_CHECK_KEY = "last_version_check";

        // 1. 先定义显示弹窗函数，防止报错
        window.showUpdateNotification = function () {
          // 确保 DOM 已就绪 (防止在 <head> 中调用时 body 为 null)
          if (!document.body) {
            window.addEventListener(
              "DOMContentLoaded",
              window.showUpdateNotification
            );
            return;
          }
          // 防止重复显示
          if (document.getElementById("app-update-notification")) return;
          // 延迟显示，避免干扰页面加载
          setTimeout(() => {
            const updateDiv = document.createElement("div");
            updateDiv.id = "app-update-notification";
            updateDiv.style.cssText = `
              position: fixed;
              top: 100px;
              left: 50%;
              transform: translateX(-50%);
              background: rgba(255, 255, 255, 0.95);
              backdrop-filter: blur(40px) saturate(180%);
              -webkit-backdrop-filter: blur(40px) saturate(180%);
              color: #1c1c1e;
              padding: 16px 20px;
              border-radius: 24px;
              box-shadow: 0 12px 40px rgba(0,0,0,0.12), 0 4px 12px rgba(0,0,0,0.08);
              border: 0.5px solid rgba(255,255,255,0.6);
              z-index: 99999;
              font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", sans-serif;
              font-size: 15px;
              display: flex;
              align-items: center;
              justify-content: space-between;
              gap: 16px;
              min-width: 300px;
              max-width: 90vw;
              animation: slideDown 0.5s cubic-bezier(0.19, 1, 0.22, 1);
            `;

            updateDiv.innerHTML = `
              <div style="flex: 1; display:flex; flex-direction:column; justify-content:center;">
                 <div style="font-weight: 600; font-size: 16px; letter-spacing: -0.3px; line-height: 1.3; margin-bottom: 3px;">App Update</div>
                 <div style="font-size: 13px; color: #8a8a8e; line-height: 1.3;">新版本 v${CURRENT_VERSION} 已就绪</div>
              </div>
              
              <div style="display: flex; align-items: center; gap: 10px;">
                <button id="refresh-btn" style="
                  background: #007AFF;
                  color: white;
                  border: none;
                  padding: 8px 18px;
                  border-radius: 12px;
                  cursor: pointer;
                  font-weight: 600;
                  font-size: 14px;
                  transition: all 0.2s;
                  box-shadow: 0 2px 6px rgba(0,122,255,0.2);
                " onmousedown="this.style.transform='scale(0.95)'" onmouseup="this.style.transform='scale(1)'">更新</button>
                
                <button id="dismiss-btn" style="
                  background: rgba(120, 120, 128, 0.08);
                  color: #8a8a8e;
                  border: none;
                  width: 30px;
                  height: 30px;
                  border-radius: 50%;
                  cursor: pointer;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  font-size: 14px;
                  transition: background 0.2s;
                " onmouseover="this.style.background='rgba(120,120,128,0.2)'" onmouseout="this.style.background='rgba(120,120,128,0.08)'">✕</button>
              </div>
            `;

            // 添加动画
            const style = document.createElement("style");
            style.textContent = `
              @keyframes slideDown {
                from { transform: translateX(-50%) translateY(-100%) scale(0.9); opacity: 0; }
                to { transform: translateX(-50%) translateY(0) scale(1); opacity: 1; }
              }
            `;
            document.head.appendChild(style);

            document.body.appendChild(updateDiv);

            // 刷新按钮
            document.getElementById("refresh-btn").onclick = () => {
              location.reload(true); // 强制刷新
            };

            // 关闭按钮
            document.getElementById("dismiss-btn").onclick = () => {
              updateDiv.style.transition =
                "all 0.3s cubic-bezier(0.19, 1, 0.22, 1)";
              updateDiv.style.transform = "translateX(-50%) translateY(-20px)";
              updateDiv.style.opacity = "0";
              setTimeout(() => updateDiv.remove(), 300);
            };

            // 15秒后自动消失
            setTimeout(() => {
              if (document.body.contains(updateDiv)) {
                updateDiv.style.transition =
                  "all 0.3s cubic-bezier(0.19, 1, 0.22, 1)";
                updateDiv.style.transform =
                  "translateX(-50%) translateY(-20px)";
                updateDiv.style.opacity = "0";
                setTimeout(() => updateDiv.remove(), 300);
              }
            }, 15000);
          }, 1000);
        };

        // 2. 然后再执行检测逻辑
        const savedVersion = localStorage.getItem(VERSION_KEY);
        const lastCheck = localStorage.getItem(LAST_CHECK_KEY);
        const now = Date.now();

        // 如果是旧版本（没有记录或版本不匹配）
        if (!savedVersion || savedVersion !== CURRENT_VERSION) {
          console.log(
            `检测到版本更新: ${savedVersion || "未知"} -> ${CURRENT_VERSION}`
          );

          // 显示更新提示（仅在非首次访问时）
          if (savedVersion && savedVersion !== CURRENT_VERSION) {
            window.showUpdateNotification();
          }

          // 更新版本记录
          localStorage.setItem(VERSION_KEY, CURRENT_VERSION);
          localStorage.setItem(LAST_CHECK_KEY, now);
        }

        // 定期检测（每小时检查一次服务器版本）
        const ONE_HOUR = 60 * 60 * 1000;
        if (!lastCheck || now - parseInt(lastCheck) > ONE_HOUR) {
          checkServerVersion();
          localStorage.setItem(LAST_CHECK_KEY, now);
        }

        // 检查服务器版本（通过请求index.html并检查meta标签）
        function checkServerVersion() {
          fetch(window.location.href, {
            cache: "no-cache",
            headers: { "Cache-Control": "no-cache" },
          })
            .then((response) => response.text())
            .then((html) => {
              // 从HTML中提取版本号
              const match = html.match(
                /const CURRENT_VERSION = ['"]([^'"]+)['"]/
              );
              if (match && match[1] !== CURRENT_VERSION) {
                console.log("发现服务器新版本:", match[1]);
                window.showUpdateNotification();
              }
            })
            .catch((err) => console.log("版本检查失败:", err));
        }
      })();
    </script>

    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="settings-ios-style.css" />
    <link rel="stylesheet" href="voice-bubble-fix.css" />
    <link rel="stylesheet" href="voice-touch-fix.css" />
    <link rel="stylesheet" href="ios_modal_theme.css" />
    <link rel="stylesheet" href="meetu-ios-style.css" />
    <link rel="stylesheet" href="shopping-ios-style.css" />
    <link rel="stylesheet" href="anecdotes.css" />
    <link rel="stylesheet" href="location-card.css" />
    <link rel="stylesheet" href="chat-settings-page.css" />
    <style id="custom-font-style"></style>
    <style id="custom-bubble-styles"></style>
    <style id="custom-pendant-styles"></style>
    <style id="global-user-styles"></style>
    <script src="main.js"></script>
    <script src="DEBUG_MESSAGE_INTERACTIONS.js"></script>
    <script src="GLOBAL_MENU_FIX.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  </head>

  <body>
    <!-- 全局壁纸层：解决iOS PWA底部白块问题 -->
    <!-- 这个层覆盖整个视口（包括安全区域），始终显示用户壁纸 -->
    <div id="global-wallpaper"></div>

    <div
      id="click-shield"
      style="
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 9999;
        display: none;
      "
    ></div>
    <div
      id="off-screen-render-container"
      style="
        position: absolute;
        top: -9999px;
        left: -9999px;
        width: 375px;
        z-index: -1;
      "
    ></div>
    <div class="phone-frame app-pop-in">
      <img id="device-skin" src="" alt="" />
      <div class="content-mask">
        <div class="status-bar">
          <div class="sb-left-container">
            <div id="status-bar-time">--:--</div>
            <!-- <span class="carrier-name">七七移动</span> -->
          </div>

          <div class="sb-right-container">
            <svg
              width="18"
              height="12"
              viewBox="0 0 18 12"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M2.10352 8.59365C2.68405 8.59388 3.15426 9.05554 3.1543 9.6249V10.8856C3.15404 11.4548 2.68392 11.9167 2.10352 11.9169H1.05176C0.471162 11.9169 0.00025504 11.455 0 10.8856V9.6249C3.63929e-05 9.0554 0.471027 8.59365 1.05176 8.59365H2.10352ZM7.05176 8.59365C7.63241 8.59377 8.10351 9.05544 8.10352 9.6249V10.8856C8.10327 11.4549 7.63227 11.9168 7.05176 11.9169H6C5.4194 11.9169 4.94848 11.455 4.94824 10.8856V9.6249C4.94825 9.05537 5.41925 8.59366 6 8.59365H7.05176ZM12 8.59365C12.5808 8.59365 13.0518 9.05537 13.0518 9.6249V10.8856C13.0516 11.4551 12.5807 11.9169 12 11.9169H10.9482C10.3677 11.9167 9.89759 11.455 9.89746 10.8856V9.6249C9.89746 9.05546 10.3676 8.5938 10.9482 8.59365H12ZM16.9482 8.59365C17.529 8.59365 18 9.05537 18 9.6249V10.8856C17.9998 11.455 17.5289 11.9169 16.9482 11.9169H15.8975C15.3168 11.9169 14.8459 11.455 14.8457 10.8856V9.6249C14.8457 9.05547 15.3159 8.59382 15.8965 8.59365H16.9482Z"
                fill="black"
              />
              <path
                d="M2.10352 4.12444C2.68394 4.12467 3.15408 4.58647 3.1543 5.15569V6.30218C3.15414 6.87145 2.68398 7.33321 2.10352 7.33343H1.05176C0.471099 7.33343 0.000153016 6.87159 0 6.30218V5.15569C0.000212863 4.58633 0.471136 4.12444 1.05176 4.12444H2.10352ZM7.05176 2.97894C7.63241 2.97903 8.10348 3.44074 8.10352 4.01019V6.30218C8.10336 6.87153 7.63234 7.33334 7.05176 7.33343H6C5.41936 7.33341 4.94839 6.87158 4.94824 6.30218V4.01019C4.94828 3.44069 5.41929 2.97896 6 2.97894H7.05176ZM12 1.48968C12.5808 1.48968 13.0518 1.95139 13.0518 2.52093V6.30218C13.0517 6.87169 12.5807 7.33343 12 7.33343H10.9482C10.3676 7.33328 9.89749 6.8716 9.89746 6.30218V2.52093C9.89746 1.95148 10.3676 1.48983 10.9482 1.48968H12Z"
                fill="black"
              />
              <path
                opacity="0.2"
                d="M15.8953 0H16.9468C17.5276 0 17.9984 0.461701 17.9984 1.03124V6.30201C17.9984 6.87155 17.5276 7.33325 16.9468 7.33325H15.8953C15.3145 7.33325 14.8438 6.87155 14.8438 6.30201V1.03124C14.8438 0.461701 15.3145 0 15.8953 0Z"
                fill="black"
              />
            </svg>

            <svg
              class="status-icon"
              width="16"
              height="12"
              viewBox="0 0 18 13"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M3.4248 12.2393C2.78223 12.2393 2.21257 12.1162 1.71582 11.8701C1.21908 11.624 0.822591 11.2891 0.526367 10.8652C0.230143 10.4368 0.0569661 9.95833 0.00683594 9.42969L0 9.34082H1.44238L1.44922 9.39551C1.49479 9.68262 1.60417 9.94466 1.77734 10.1816C1.95508 10.4186 2.1875 10.6055 2.47461 10.7422C2.76172 10.8789 3.08301 10.9473 3.43848 10.9473C3.84408 10.9473 4.20182 10.8584 4.51172 10.6807C4.82161 10.4984 5.06315 10.25 5.23633 9.93555C5.41406 9.62109 5.50293 9.25879 5.50293 8.84863V8.83496C5.50293 8.42936 5.41406 8.06934 5.23633 7.75488C5.05859 7.44043 4.81706 7.19661 4.51172 7.02344C4.20638 6.8457 3.85319 6.75684 3.45215 6.75684C3.15592 6.75684 2.88021 6.80241 2.625 6.89355C2.37435 6.98014 2.15104 7.1123 1.95508 7.29004C1.86849 7.37207 1.78646 7.46094 1.70898 7.55664C1.63151 7.64779 1.56315 7.75033 1.50391 7.86426H0.177734L0.669922 2.13574H6.41211V3.43457H1.87988L1.5791 6.5791H1.68848C1.82975 6.35579 2.00521 6.16667 2.21484 6.01172C2.42904 5.85677 2.67057 5.73828 2.93945 5.65625C3.20833 5.57422 3.49316 5.5332 3.79395 5.5332C4.41374 5.5332 4.96061 5.67448 5.43457 5.95703C5.91309 6.23958 6.28906 6.62695 6.5625 7.11914C6.83594 7.61133 6.97266 8.17415 6.97266 8.80762V8.82129C6.97266 9.49121 6.81999 10.0837 6.51465 10.5986C6.21387 11.1136 5.79688 11.5169 5.26367 11.8086C4.73503 12.0957 4.12207 12.2393 3.4248 12.2393Z"
                fill="currentColor"
              />
              <path
                d="M13.0735 12.2393C12.3672 12.2393 11.7337 12.1208 11.1731 11.8838C10.6126 11.6423 10.1341 11.2959 9.7376 10.8447C9.34112 10.3936 9.03578 9.85124 8.82159 9.21777C8.61195 8.57975 8.50713 7.86426 8.50713 7.07129V7.05762C8.50713 6.00944 8.69398 5.10026 9.06768 4.33008C9.44138 3.55534 9.97002 2.95605 10.6536 2.53223C11.3372 2.1084 12.137 1.89648 13.053 1.89648C13.8004 1.89648 14.4681 2.02865 15.056 2.29297C15.6439 2.55729 16.1269 2.92871 16.5052 3.40723C16.8834 3.88118 17.1318 4.43717 17.2503 5.0752L17.2571 5.14355H15.719L15.6985 5.0752C15.5254 4.49186 15.2086 4.04297 14.7483 3.72852C14.2926 3.41406 13.7275 3.25684 13.053 3.25684C12.4469 3.25684 11.9205 3.41178 11.4739 3.72168C11.0273 4.03158 10.681 4.47135 10.4349 5.04102C10.1933 5.60612 10.0726 6.27604 10.0726 7.05078V7.06445C10.0726 7.65234 10.1409 8.18099 10.2776 8.65039C10.4189 9.11979 10.6217 9.52083 10.886 9.85352C11.1504 10.1816 11.4671 10.4346 11.8362 10.6123C12.2054 10.79 12.6224 10.8789 13.0872 10.8789C13.625 10.8789 14.0967 10.7741 14.5022 10.5645C14.9124 10.3503 15.2314 10.054 15.4593 9.67578C15.6871 9.29753 15.8034 8.85547 15.8079 8.34961L15.8148 8.13086H13.2786V6.89355H17.3323V8.11719C17.3323 8.74154 17.2321 9.30664 17.0315 9.8125C16.831 10.3184 16.5439 10.7536 16.1702 11.1182C15.7965 11.4782 15.3476 11.7562 14.8235 11.9521C14.2995 12.1436 13.7161 12.2393 13.0735 12.2393Z"
                fill="currentColor"
              />
            </svg>
            <div class="battery-container" id="batteryContainer">
              <svg
                class="battery-shell-svg"
                viewBox="0 0 28 13"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <rect
                  id="battery-level"
                  x="2"
                  y="2"
                  width="10"
                  height="9"
                  rx="2"
                />
                <rect
                  class="shell-stroke"
                  opacity="0.4"
                  x="0.5"
                  y="0.5"
                  width="24"
                  height="12"
                  rx="3.5"
                />
                <path
                  class="shell-fill"
                  opacity="0.5"
                  d="M26 4.5V8.5C26.8059 8.16122 27.33 7.37313 27.33 6.5C27.33 5.62687 26.8059 4.83878 26 4.5"
                />
              </svg>

              <svg
                class="battery-bolt-svg"
                id="batteryBolt"
                viewBox="0 0 12 17"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  class="bolt-path"
                  d="M6.69922 1.1665C7.08714 0.696399 7.70983 0.499969 8.24512 0.783691C8.7674 1.06066 8.94038 1.64843 8.77734 2.20361L8.74023 2.31396L7.22168 6.33252H9.8252C10.4336 6.33252 10.9678 6.79213 10.9678 7.45166C10.9677 7.79369 10.8282 8.06675 10.6572 8.28271L10.6494 8.2915L4.91309 15.27L4.91211 15.271C4.52657 15.7383 3.90523 15.9404 3.36816 15.6567C2.80512 15.3592 2.65413 14.7044 2.87793 14.1206L4.39551 10.105H1.79199C1.21122 10.105 0.715984 9.6972 0.65625 9.10693L0.649414 8.98682L0.655273 8.86475C0.681644 8.5883 0.798226 8.35152 0.96875 8.146H0.967773L6.69824 1.16748L6.69922 1.1665Z"
                />
              </svg>
            </div>
          </div>
        </div>

        <div id="dynamic-island" class="dynamic-island">
          <div class="island-collapsed-content">
            <div class="collapsed-music-info">
              <svg
                class="music-icon-collapsed"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M9 18V5l12-2v13"
                  stroke="white"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                ></path>
                <circle
                  cx="6"
                  cy="18"
                  r="3"
                  stroke="white"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                ></circle>
                <circle
                  cx="18"
                  cy="16"
                  r="3"
                  stroke="white"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                ></circle>
              </svg>
              <div class="title-scroller-window">
                <span id="collapsed-song-title" class="collapsed-title"></span>
              </div>
            </div>
          </div>
          <div class="island-expanded-content">
            <div class="expanded-header">
              <div id="shared-listening-avatars" class="shared-avatars">
                <div id="avatar-image-container"></div>
                <div id="end-session-bubble" class="confirmation-bubble">
                  <span>结束一起听?</span>
                  <button id="end-listening-session-btn">结束</button>
                </div>
              </div>
              <div class="song-details">
                <div id="island-song-title" class="song-title">Pepas</div>
                <div id="island-song-artist" class="song-artist">Farruko</div>
              </div>
              <button id="island-invite-button" class="island-action-button">
                <svg
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M8 11C10.7614 11 13 8.76142 13 6C13 3.23858 10.7614 1 8 1C5.23858 1 3 3.23858 3 6C3 8.76142 5.23858 11 8 11Z"
                    fill="white"
                  />
                  <path
                    d="M0 21C0 16.5817 3.58172 13 8 13C12.4183 13 16 16.5817 16 21C16 22.1046 15.1046 23 14 23H2C0.895431 23 0 22.1046 0 21Z"
                    fill="white"
                  />
                  <path
                    d="M17 13C18.6569 13 20 11.6569 20 10C20 8.34315 18.6569 7 17 7C15.3431 7 14 8.34315 14 10C14 11.6569 15.3431 13 17 13Z"
                    fill="white"
                  />
                  <path
                    d="M19 10V2L22 3"
                    stroke="white"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </svg>
              </button>
            </div>

            <div class="progress-container">
              <span id="progress-current-time">0:00</span>
              <div class="progress-bar-wrapper">
                <div id="progress-bar-fill" class="progress-bar-fill"></div>
              </div>
              <span id="progress-remaining-time">-0:00</span>
            </div>

            <div class="controls-container">
              <button id="island-prev-btn" class="control-button">
                <svg viewBox="0 0 24 24">
                  <path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"></path>
                </svg>
              </button>
              <button
                id="island-play-pause-btn"
                class="control-button play-pause"
              >
                <svg class="play-icon" viewBox="0 0 24 24">
                  <path d="M8 5v14l11-7z"></path>
                </svg>
                <svg class="pause-icon" viewBox="0 0 24 24">
                  <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"></path>
                </svg>
              </button>
              <button id="island-next-btn" class="control-button">
                <svg viewBox="0 0 24 24">
                  <path d="M16 6h2v12h-2zm-4.5 6l-8.5 6V6z"></path>
                </svg>
              </button>
            </div>
          </div>
        </div>
        <div id="home-screen" class="screen active">
          <div class="content">
            <div class="header-content">
              <div class="clock">
                <span id="clock-hours">--</span>
                <span>:</span>
                <span id="clock-minutes">--</span>
              </div>
              <div class="motto-container">
                <p id="motto" contenteditable="true">签名语录 (点击编辑)</p>
              </div>
            </div>

            <div class="app-grid">
              <div
                class="app-container"
                id="worldbook-app-icon"
                data-app-id="worldbook-screen"
              >
                <div class="app-icon">
                  <img
                    src="https://i.postimg.cc/tsb1R1yk/shi-jie-shu.png"
                    data-default-src="https://i.postimg.cc/tsb1R1yk/shi-jie-shu.png"
                    alt="世界书"
                  />
                </div>
                <span class="app-name">世界书</span>
              </div>
              <div
                class="app-container"
                id="messages-app-icon"
                data-app-id="messages-screen"
              >
                <div class="app-icon">
                  <img
                    src="https://i.postimg.cc/sMzBfByK/xiao-xi.png"
                    data-default-src="https://i.postimg.cc/sMzBfByK/xiao-xi.png"
                    alt="消息图标"
                  />
                </div>
                <span class="app-name">讯息</span>
              </div>

              <div
                class="app-container"
                id="wow-app-icon"
                data-app-id="wow-screen"
              >
                <div class="app-icon">
                  <img
                    src="https://i.postimg.cc/Qx3TJnT1/wa-wu.png"
                    data-default-src="https://i.postimg.cc/Qx3TJnT1/wa-wu.png"
                    alt="哇呜"
                  />
                </div>
                <span class="app-name">哇呜</span>
              </div>

              <div
                class="app-container"
                id="music-app-icon"
                data-app-id="music-screen"
              >
                <div class="app-icon">
                  <img
                    src="https://i.postimg.cc/pmv9V9xY/yin-le.png"
                    data-default-src="https://i.postimg.cc/pmv9V9xY/yin-le.png"
                    alt="音乐图标"
                  />
                </div>
                <span class="app-name">音乐</span>
              </div>

              <div
                class="app-container"
                id="gacha-app-icon"
                data-app-id="gacha-screen"
              >
                <div class="app-icon">
                  <img
                    src="https://i.postimg.cc/fVs3W3Zv/peng-you-quan.png"
                    data-default-src="https://i.postimg.cc/fVs3W3Zv/peng-you-quan.png"
                    alt="GACHA"
                  />
                </div>
                <span class="app-name">动态</span>
              </div>

              <div
                class="app-container"
                id="SHOP-app-icon"
                data-app-id="shop-screen"
              >
                <div class="app-icon">
                  <img
                    src="https://i.postimg.cc/NKtyGyY2/gou-wu.png"
                    data-default-src="https://i.postimg.cc/NKtyGyY2/gou-wu.png"
                    alt="qidai"
                  />
                </div>
                <span class="app-name">购物</span>
              </div>

              <div
                class="app-container"
                id="GAME-app-icon"
                data-app-id="slacking-off-screen"
              >
                <div class="app-icon">
                  <img
                    src="https://i.postimg.cc/bskDj0X9/you-xi.png"
                    data-default-src="https://i.postimg.cc/bskDj0X9/you-xi.png"
                    alt="game"
                  />
                </div>
                <span class="app-name">游戏</span>
              </div>

              <div
                class="app-container"
                id="beautify-app-icon"
                data-app-id="beautify-screen"
              >
                <div class="app-icon">
                  <img
                    src="https://i.postimg.cc/sMzBfByZ/mei-hua.png"
                    data-default-src="https://i.postimg.cc/sMzBfByZ/mei-hua.png"
                    alt="美化"
                  />
                </div>
                <span class="app-name">美化</span>
              </div>

              <div
                class="app-container"
                id="settings-app-icon"
                data-app-id="settings-screen"
              >
                <div class="app-icon">
                  <img
                    src="https://i.postimg.cc/XrWZNZ3G/she-zhi.png"
                    data-default-src="https://i.postimg.cc/XrWZNZ3G/she-zhi.png"
                    alt="设置"
                  />
                </div>
                <span class="app-name">设置</span>
              </div>
            </div>
          </div>

          <button id="open-drawer-btn" class="drawer-trigger-btn">
            <svg
              width="28"
              height="28"
              viewBox="0 0 28 28"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <g clip-path="url(#clip0_201_99351)">
                <path
                  d="M4.73828 14.5977C4.29297 14.7734 4 15.1719 4 15.5938C4 16.2852 4.50391 16.8125 5.18359 16.8125C5.54688 16.8125 6.00391 16.6133 6.29688 16.4961L15.2734 12.9805H13.6211L22.5977 16.4961C22.8906 16.6133 23.3594 16.8125 23.7109 16.8125C24.3906 16.8125 24.8945 16.2852 24.8945 15.5938C24.8945 15.1719 24.6016 14.7734 24.1562 14.5977L16.1641 11.4688C15.625 11.2578 14.9688 11 14.4531 11C13.9258 11 13.2812 11.2578 12.7422 11.4688L4.73828 14.5977Z"
                  fill="black"
                  fill-opacity="0.85"
                />
              </g>
              <defs>
                <clipPath id="clip0_201_99351">
                  <rect
                    width="20.8945"
                    height="5.94141"
                    fill="white"
                    transform="translate(4 11)"
                  />
                </clipPath>
              </defs>
            </svg>
          </button>

          <div id="bottom-drawer" class="app-drawer">
            <div class="drawer-handle-container" id="close-drawer-btn">
              <div class="drawer-handle"></div>
            </div>

            <div class="drawer-content">
              <h3 style="margin: 10px 0 20px 0; color: #333; font-size: 16px">
                更多应用
              </h3>

              <div class="app-grid">
                <div
                  class="app-container"
                  id="qilang-app-icon"
                  data-app-id="qilang-screen"
                >
                  <div class="app-icon">
                    <img
                      src="https://placehold.co/120x120/5E5CE6/FFFFFF/png?text=七浪"
                      alt="七浪"
                    />
                  </div>
                  <span class="app-name">应用二</span>
                </div>

                <div class="app-container" id="new-app-2">
                  <div class="app-icon">
                    <img
                      src="https://placehold.co/120x120/5856D6/FFFFFF/png?text=APP2"
                      alt="App 2"
                    />
                  </div>
                  <span class="app-name">应用二</span>
                </div>

                <div class="app-container" id="new-app-3">
                  <div class="app-icon">
                    <img
                      src="https://placehold.co/120x120/FF9500/FFFFFF/png?text=APP3"
                      alt="App 3"
                    />
                  </div>
                  <span class="app-name">应用三</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div id="settings-screen" class="screen">
          <!-- Header 保持原样，或者微调 -->
          <div class="settings-header">
            <button id="back-button" class="header-icon-button">
              <svg viewBox="0 0 24 24">
                <path
                  d="M15 18l-6-6 6-6"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </button>
            <h1>设置</h1>
            <div class="header-actions">
              <button id="save-all-settings-btn" class="header-icon-button">
                <svg viewBox="0 0 24 24">
                  <path
                    d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"
                  />
                  <polyline points="17 21 17 13 7 13 7 21" />
                  <polyline points="7 3 7 8 15 8" />
                </svg>
              </button>
              <button id="select-api-library-btn" class="header-icon-button">
                <svg viewBox="0 0 24 24">
                  <line x1="8" y1="6" x2="21" y2="6" />
                  <line x1="8" y1="12" x2="21" y2="12" />
                  <line x1="8" y1="18" x2="21" y2="18" />
                  <line x1="3" y1="6" x2="3.01" y2="6" />
                  <line x1="3" y1="12" x2="3.01" y2="12" />
                  <line x1="3" y1="18" x2="3.01" y2="18" />
                </svg>
              </button>
            </div>
          </div>

          <!-- iOS Style Content -->
          <div class="settings-content-ios">
            <!-- Section: Connectivity -->
            <div class="settings-group-header">API 连接</div>
            <div class="settings-group">
              <!-- API URL -->
              <div class="settings-item">
                <div
                  class="settings-icon-container"
                  style="background-color: #007aff"
                >
                  <svg
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M13.0601 10.94C15.3101 13.19 15.3101 16.83 13.0601 19.07C10.8101 21.31 7.17009 21.32 4.93009 19.07C2.69009 16.82 2.68009 13.18 4.93009 10.94"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M10.59 13.41C8.24996 11.07 8.24996 7.27001 10.59 4.92001C12.93 2.57001 16.73 2.58001 19.08 4.92001C21.43 7.26001 21.42 11.06 19.08 13.41"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </div>
                <div class="settings-item-content">
                  <span class="settings-label">API URL</span>
                  <div class="settings-value">
                    <input
                      type="text"
                      id="api-url"
                      class="settings-input"
                      placeholder="https://..."
                      onchange="handleInputChange('api-url')"
                    />
                  </div>
                </div>
              </div>
              <!-- API Key -->
              <div class="settings-item">
                <div
                  class="settings-icon-container"
                  style="background-color: #007aff"
                >
                  <svg
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M19.79 14.9299C17.73 16.9799 14.78 17.6099 12.19 16.7999L7.48002 21.4999C7.14002 21.8499 6.47002 22.0599 5.99002 21.9899L3.81002 21.6899C3.09002 21.5899 2.42002 20.9099 2.31002 20.1899L2.01002 18.0099C1.94002 17.5299 2.17002 16.8599 2.50002 16.5199L7.20002 11.8199C6.40002 9.21995 7.02002 6.26995 9.08002 4.21995C12.03 1.26995 16.82 1.26995 19.78 4.21995C22.74 7.16995 22.74 11.9799 19.79 14.9299Z"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-miterlimit="10"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M6.89001 17.49L9.19001 19.79"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-miterlimit="10"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M14.5 11C15.3284 11 16 10.3284 16 9.5C16 8.67157 15.3284 8 14.5 8C13.6716 8 13 8.67157 13 9.5C13 10.3284 13.6716 11 14.5 11Z"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </div>
                <div class="settings-item-content">
                  <span class="settings-label">API Key</span>
                  <div class="settings-value">
                    <input
                      type="password"
                      id="api-key"
                      class="settings-input"
                      placeholder="sk-..."
                      onchange="handleInputChange('api-key')"
                    />
                  </div>
                </div>
              </div>
              <!-- Connect Test -->
              <div class="settings-item" id="connect-api-button">
                <div
                  class="settings-item-content"
                  style="justify-content: center; padding-left: 0"
                >
                  <button class="settings-button-text">连接测试</button>
                  <span
                    id="api-connection-status"
                    style="
                      position: absolute;
                      right: 16px;
                      font-size: 13px;
                      color: #8e8e93;
                    "
                  ></span>
                </div>
              </div>
            </div>

            <!-- Section: Model -->
            <div class="settings-group-header">模型设置</div>
            <div class="settings-group">
              <!-- Model Select -->
              <div class="settings-item">
                <div
                  class="settings-icon-container"
                  style="background-color: #af52de"
                >
                  <svg
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M2 9V6.5C2 4.01 4.01 2 6.5 2H9"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M15 2H17.5C19.99 2 22 4.01 22 6.5V9"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M22 16V17.5C22 19.99 19.99 22 17.5 22H16"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M9 22H6.5C4.01 22 2 19.99 2 17.5V15"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M10.5 7V9C10.5 10 10 10.5 9 10.5H7C6 10.5 5.5 10 5.5 9V7C5.5 6 6 5.5 7 5.5H9C10 5.5 10.5 6 10.5 7Z"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M18.5 7V9C18.5 10 18 10.5 17 10.5H15C14 10.5 13.5 10 13.5 9V7C13.5 6 14 5.5 15 5.5H17C18 5.5 18.5 6 18.5 7Z"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M10.5 15V17C10.5 18 10 18.5 9 18.5H7C6 18.5 5.5 18 5.5 17V15C5.5 14 6 13.5 7 13.5H9C10 13.5 10.5 14 10.5 15Z"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M18.5 15V17C18.5 18 18 18.5 17 18.5H15C14 18.5 13.5 18 13.5 17V15C13.5 14 14 13.5 15 13.5H17C18 13.5 18.5 14 18.5 15Z"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </div>
                <div class="settings-item-content">
                  <span class="settings-label">API 模型</span>
                  <div class="settings-value">
                    <select id="api-model" class="settings-select" disabled>
                      <option value="" disabled selected>请先连接</option>
                    </select>
                  </div>
                  <img
                    class="settings-chevron"
                    src="data:image/svg+xml;charset=utf-8,%3Csvg width='8' height='13' viewBox='0 0 8 13' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M2.40952 12.3813L7.67842 7.22875C7.90423 7.00978 8.00003 6.77713 8.00003 6.49658C8.00003 6.21603 7.89739 5.98337 7.67842 5.76441L2.40952 0.61183C2.23161 0.433919 2.01949 0.351807 1.7663 0.351807C1.2531 0.351807 0.835693 0.755528 0.835693 1.26873C0.835693 1.52191 0.945177 1.75457 1.12993 1.93932L5.81036 6.48974L1.12993 11.0538C0.945177 11.2386 0.835693 11.4644 0.835693 11.7244C0.835693 12.2376 1.2531 12.6482 1.7663 12.6482C2.01949 12.6482 2.23161 12.5592 2.40952 12.3813Z' fill='%23C7C7CC'/%3E%3C/svg%3E"
                  />
                </div>
              </div>
              <!-- Temperature -->
              <div
                class="settings-item"
                style="
                  height: auto;
                  align-items: flex-start;
                  padding-top: 10px;
                  padding-bottom: 10px;
                "
              >
                <div
                  class="settings-icon-container"
                  style="background-color: #ff2d55"
                >
                  <svg
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M16.42 7.95C18.86 10.39 18.86 14.35 16.42 16.79C13.98 19.23 10.02 19.23 7.58 16.79C5.14 14.35 5.14 10.39 7.58 7.95C10.02 5.51 13.98 5.51 16.42 7.95Z"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M8.24999 21.64C6.24999 20.84 4.49999 19.39 3.33999 17.38C2.19999 15.41 1.81999 13.22 2.08999 11.13"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M5.84998 4.47998C7.54998 3.14998 9.67997 2.35999 12 2.35999C14.27 2.35999 16.36 3.12997 18.04 4.40997"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M15.75 21.64C17.75 20.84 19.5 19.39 20.66 17.38C21.8 15.41 22.18 13.22 21.91 11.13"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </div>
                <div
                  class="settings-item-content"
                  style="flex-direction: column; align-items: normal; gap: 0"
                >
                  <div class="settings-slider-header">
                    <span>随机性 (温度)</span>
                    <span id="temperature-value">1.0</span>
                  </div>
                  <div class="settings-slider-container">
                    <input
                      type="range"
                      id="temperature-slider"
                      class="settings-slider"
                      min="0"
                      max="2"
                      value="1"
                      step="0.1"
                      oninput="document.getElementById('temperature-value').textContent=this.value"
                    />
                  </div>
                </div>
              </div>
              <!-- Save Config -->
              <div class="settings-item" id="save-api-to-library-btn">
                <div
                  class="settings-item-content"
                  style="justify-content: center"
                >
                  <button class="settings-button-text">
                    保存配置到 API 库
                  </button>
                </div>
              </div>
            </div>

            <!-- Section: MiniMax TTS -->
            <div class="settings-group-header">语音合成 (MiniMax)</div>
            <div class="settings-group">
              <div class="settings-item">
                <div
                  class="settings-icon-container"
                  style="background-color: #34c759"
                >
                  <svg
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M14.99 17.5H16.5C19.52 17.5 22 15.03 22 12C22 8.98 19.53 6.5 16.5 6.5H14.99"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M9 6.5H7.5C4.47 6.5 2 8.97 2 12C2 15.02 4.47 17.5 7.5 17.5H9"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M8 12H16"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </div>
                <div class="settings-item-content">
                  <span class="settings-label">GroupID</span>
                  <div class="settings-value">
                    <input
                      type="text"
                      id="minimax-group-id"
                      class="settings-input"
                      placeholder="123456..."
                    />
                  </div>
                </div>
              </div>
              <div class="settings-item">
                <div
                  class="settings-icon-container"
                  style="background-color: #34c759"
                >
                  <svg
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M19.79 14.9299C17.73 16.9799 14.78 17.6099 12.19 16.7999L7.48002 21.4999C7.14002 21.8499 6.47002 22.0599 5.99002 21.9899L3.81002 21.6899C3.09002 21.5899 2.42002 20.9099 2.31002 20.1899L2.01002 18.0099C1.94002 17.5299 2.17002 16.8599 2.50002 16.5199L7.20002 11.8199C6.40002 9.21995 7.02002 6.26995 9.08002 4.21995C12.03 1.26995 16.82 1.26995 19.78 4.21995C22.74 7.16995 22.74 11.9799 19.79 14.9299Z"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-miterlimit="10"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M6.89001 17.49L9.19001 19.79"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-miterlimit="10"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M14.5 11C15.3284 11 16 10.3284 16 9.5C16 8.67157 15.3284 8 14.5 8C13.6716 8 13 8.67157 13 9.5C13 10.3284 13.6716 11 14.5 11Z"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </div>
                <div class="settings-item-content">
                  <span class="settings-label">API Key</span>
                  <div class="settings-value">
                    <input
                      type="password"
                      id="minimax-api-key"
                      class="settings-input"
                      placeholder="eyJ..."
                    />
                  </div>
                </div>
              </div>
              <div class="settings-item">
                <div
                  class="settings-icon-container"
                  style="background-color: #34c759"
                >
                  <svg
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M21.0799 8.58003V15.42C21.0799 16.54 20.4799 17.58 19.5099 18.15L13.5699 21.58C12.5999 22.14 11.3999 22.14 10.4199 21.58L4.47992 18.15C3.50992 17.59 2.90991 16.55 2.90991 15.42V8.58003C2.90991 7.46003 3.50992 6.41999 4.47992 5.84999L10.4199 2.42C11.3899 1.86 12.5899 1.86 13.5699 2.42L19.5099 5.84999C20.4799 6.41999 21.0799 7.45003 21.0799 8.58003Z"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M9.75 12V10.8C9.75 9.26001 10.84 8.63005 12.17 9.40005L13.21 10L14.25 10.6C15.58 11.37 15.58 12.63 14.25 13.4L13.21 14L12.17 14.6C10.84 15.37 9.75 14.74 9.75 13.2V12Z"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-miterlimit="10"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </div>
                <div class="settings-item-content">
                  <span class="settings-label">TTS模型</span>
                  <div class="settings-value">
                    <select id="minimax-model-select" class="settings-select">
                      <option value="">请填写配置</option>
                    </select>
                  </div>
                  <img
                    class="settings-chevron"
                    src="data:image/svg+xml;charset=utf-8,%3Csvg width='8' height='13' viewBox='0 0 8 13' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M2.40952 12.3813L7.67842 7.22875C7.90423 7.00978 8.00003 6.77713 8.00003 6.49658C8.00003 6.21603 7.89739 5.98337 7.67842 5.76441L2.40952 0.61183C2.23161 0.433919 2.01949 0.351807 1.7663 0.351807C1.2531 0.351807 0.835693 0.755528 0.835693 1.26873C0.835693 1.52191 0.945177 1.75457 1.12993 1.93932L5.81036 6.48974L1.12993 11.0538C0.945177 11.2386 0.835693 11.4644 0.835693 11.7244C0.835693 12.2376 1.2531 12.6482 1.7663 12.6482C2.01949 12.6482 2.23161 12.5592 2.40952 12.3813Z' fill='%23C7C7CC'/%3E%3C/svg%3E"
                  />
                </div>
              </div>
              <div class="settings-item" id="fetch-minimax-models-btn">
                <div
                  class="settings-item-content"
                  style="justify-content: center"
                >
                  <button class="settings-button-text">拉取模型</button>
                  <span
                    id="fetch-models-status"
                    style="
                      position: absolute;
                      right: 16px;
                      font-size: 13px;
                      color: #8e8e93;
                    "
                  ></span>
                </div>
              </div>
              <div class="settings-item" id="test-tts-button">
                <div
                  class="settings-item-content"
                  style="justify-content: center"
                >
                  <button class="settings-button-text">测试语音合成</button>
                  <span
                    id="tts-test-status"
                    style="
                      position: absolute;
                      right: 16px;
                      font-size: 13px;
                      color: #8e8e93;
                    "
                  ></span>
                </div>
              </div>
            </div>

            <!-- Section: System -->
            <div class="settings-group-header">系统功能</div>
            <div class="settings-group">
              <div class="settings-item">
                <div
                  class="settings-icon-container"
                  style="background-color: #8e8e93"
                >
                  <svg
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="white"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path
                      d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"
                    ></path>
                  </svg>
                </div>
                <div class="settings-item-content">
                  <span class="settings-label">全屏模式</span>
                  <label class="switch settings-switch-container">
                    <input type="checkbox" id="toggle-frame-visibility" />
                    <span class="slider round"></span>
                  </label>
                </div>
              </div>
              <div class="settings-item">
                <div
                  class="settings-icon-container"
                  style="background-color: #000000"
                >
                  <svg
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="white"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path
                      d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"
                    ></path>
                  </svg>
                </div>
                <div class="settings-item-content">
                  <span class="settings-label">深色模式</span>
                  <label class="switch settings-switch-container">
                    <input type="checkbox" id="toggle-dark-mode" />
                    <span class="slider round"></span>
                  </label>
                </div>
              </div>
              <div class="settings-item">
                <div
                  class="settings-icon-container"
                  style="background-color: #34c759"
                >
                  <svg
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M20.5 9.5C22 9.5 22 10 22 11V13C22 14 22 14.5 20.5 14.5"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M10 8L8.11001 10.5C7.72001 11.17 8.20001 12 8.97001 12H11.27C12.04 12 12.52 12.83 12.14 13.5L10 16"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M7 19C3 19 2 18 2 14V10C2 6 3 5 7 5"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M13 5C17 5 18 6 18 10V14C18 18 17 19 13 19"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </div>
                <div class="settings-item-content">
                  <span class="settings-label">显示状态栏</span>
                  <label class="switch settings-switch-container">
                    <input type="checkbox" id="toggle-status-bar" checked />
                    <span class="slider round"></span>
                  </label>
                </div>
              </div>
              <div class="settings-item" id="nav-to-proactive-settings">
                <div
                  class="settings-icon-container"
                  style="background-color: #5856d6"
                >
                  <svg
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M17 9C17 12.87 13.64 16 9.5 16L8.57001 17.12L8.02 17.78C7.55 18.34 6.65 18.22 6.34 17.55L5 14.6C3.18 13.32 2 11.29 2 9C2 5.13 5.36 2 9.5 2C12.52 2 15.13 3.67001 16.3 6.07001C16.75 6.96001 17 7.95 17 9Z"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M22.0001 12.86C22.0001 15.15 20.8201 17.18 19.0001 18.46L17.6601 21.41C17.3501 22.08 16.4501 22.21 15.9801 21.64L14.5001 19.86C12.0801 19.86 9.92007 18.79 8.57007 17.12L9.50006 16C13.6401 16 17.0001 12.87 17.0001 9C17.0001 7.95 16.7501 6.96001 16.3001 6.07001C19.5701 6.82001 22.0001 9.57999 22.0001 12.86Z"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M7 9H12"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </div>
                <div class="settings-item-content">
                  <span class="settings-label">AI 主动消息</span>
                  <div class="settings-value">
                    <span id="proactive-status-text">已关闭</span>
                  </div>
                  <img
                    class="settings-chevron"
                    src="data:image/svg+xml;charset=utf-8,%3Csvg width='8' height='13' viewBox='0 0 8 13' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M2.40952 12.3813L7.67842 7.22875C7.90423 7.00978 8.00003 6.77713 8.00003 6.49658C8.00003 6.21603 7.89739 5.98337 7.67842 5.76441L2.40952 0.61183C2.23161 0.433919 2.01949 0.351807 1.7663 0.351807C1.2531 0.351807 0.835693 0.755528 0.835693 1.26873C0.835693 1.52191 0.945177 1.75457 1.12993 1.93932L5.81036 6.48974L1.12993 11.0538C0.945177 11.2386 0.835693 11.4644 0.835693 11.7244C0.835693 12.2376 1.2531 12.6482 1.7663 12.6482C2.01949 12.6482 2.23161 12.5592 2.40952 12.3813Z' fill='%23C7C7CC'/%3E%3C/svg%3E"
                  />
                </div>
              </div>
              
              <!-- iOS 特性调整 -->
              <div class="settings-item" id="nav-to-ios-settings">
                <div
                  class="settings-icon-container"
                  style="background-color: #007aff"
                >
                  <svg
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M17.5 12C17.5 15.04 15.04 17.5 12 17.5C8.96 17.5 6.5 15.04 6.5 12C6.5 8.96 8.96 6.5 12 6.5C15.04 6.5 17.5 8.96 17.5 12Z"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M12 2V4"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M12 20V22"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M4 12H2"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M22 12H20"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </div>
                <div class="settings-item-content">
                  <span class="settings-label">iOS 特性调整</span>
                  <div class="settings-value">
                    <span id="ios-settings-status-text">PWA适配</span>
                  </div>
                  <img
                    class="settings-chevron"
                    src="data:image/svg+xml;charset=utf-8,%3Csvg width='8' height='13' viewBox='0 0 8 13' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M2.40952 12.3813L7.67842 7.22875C7.90423 7.00978 8.00003 6.77713 8.00003 6.49658C8.00003 6.21603 7.89739 5.98337 7.67842 5.76441L2.40952 0.61183C2.23161 0.433919 2.01949 0.351807 1.7663 0.351807C1.2531 0.351807 0.835693 0.755528 0.835693 1.26873C0.835693 1.52191 0.945177 1.75457 1.12993 1.93932L5.81036 6.48974L1.12993 11.0538C0.945177 11.2386 0.835693 11.4644 0.835693 11.7244C0.835693 12.2376 1.2531 12.6482 1.7663 12.6482C2.01949 12.6482 2.23161 12.5592 2.40952 12.3813Z' fill='%23C7C7CC'/%3E%3C/svg%3E"
                  />
                </div>
              </div>
            </div>

            <!-- Section: Personalization -->
            <div class="settings-group-header">个性化</div>
            <div class="settings-group">
              <!-- Skin -->
              <div
                class="settings-item"
                onclick="document.getElementById('skin-upload').click()"
              >
                <div
                  class="settings-icon-container"
                  style="background-color: #ff9500"
                >
                  <svg
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="white"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <rect
                      x="5"
                      y="2"
                      width="14"
                      height="20"
                      rx="2"
                      ry="2"
                    ></rect>
                    <line x1="12" y1="18" x2="12.01" y2="18"></line>
                  </svg>
                </div>
                <div class="settings-item-content">
                  <span class="settings-label">更换手机外壳</span>
                  <div class="settings-value">
                    <span style="font-size: 13px">选择PNG</span>
                  </div>
                  <img
                    class="settings-chevron"
                    src="data:image/svg+xml;charset=utf-8,%3Csvg width='8' height='13' viewBox='0 0 8 13' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M2.40952 12.3813L7.67842 7.22875C7.90423 7.00978 8.00003 6.77713 8.00003 6.49658C8.00003 6.21603 7.89739 5.98337 7.67842 5.76441L2.40952 0.61183C2.23161 0.433919 2.01949 0.351807 1.7663 0.351807C1.2531 0.351807 0.835693 0.755528 0.835693 1.26873C0.835693 1.52191 0.945177 1.75457 1.12993 1.93932L5.81036 6.48974L1.12993 11.0538C0.945177 11.2386 0.835693 11.4644 0.835693 11.7244C0.835693 12.2376 1.2531 12.6482 1.7663 12.6482C2.01949 12.6482 2.23161 12.5592 2.40952 12.3813Z' fill='%23C7C7CC'/%3E%3C/svg%3E"
                  />
                </div>
                <!-- Hidden Inputs within item logic -->
                <input
                  type="file"
                  id="skin-upload"
                  accept="image/*"
                  style="display: none"
                  onchange="handleSkinUpload(this)"
                />
              </div>
              <div
                class="settings-item"
                id="reset-skin-btn"
                style="display: none"
                onclick="resetSkin()"
              >
                <div
                  class="settings-item-content"
                  style="justify-content: center"
                >
                  <button
                    class="settings-button-text settings-button-destructive"
                  >
                    恢复默认手机壳
                  </button>
                </div>
              </div>
              <!-- Skin Size Controls Container -->
              <div
                id="skin-size-controls"
                style="display: none; padding: 10px 16px"
              >
                <div
                  style="font-size: 13px; font-weight: 600; margin-bottom: 8px"
                >
                  外壳尺寸微调
                </div>
                <div style="display: flex; gap: 10px; margin-bottom: 10px">
                  <input
                    type="number"
                    id="skin-width-input"
                    class="form-input"
                    placeholder="宽"
                  />
                  <input
                    type="number"
                    id="skin-height-input"
                    class="form-input"
                    placeholder="高"
                  />
                </div>
                <div style="display: flex; gap: 10px; margin-bottom: 10px">
                  <input
                    type="number"
                    id="skin-offset-x-input"
                    class="form-input"
                    placeholder="X偏移"
                  />
                  <input
                    type="number"
                    id="skin-offset-y-input"
                    class="form-input"
                    placeholder="Y偏移"
                  />
                </div>
                <button id="apply-skin-size-btn" class="settings-button-text">
                  应用调整
                </button>
              </div>

              <!-- Wallpaper -->
              <div class="settings-item" id="upload-wallpaper-btn">
                <div
                  class="settings-icon-container"
                  style="background-color: #32ade6"
                >
                  <svg
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M9 10C10.1046 10 11 9.10457 11 8C11 6.89543 10.1046 6 9 6C7.89543 6 7 6.89543 7 8C7 9.10457 7.89543 10 9 10Z"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M12 2H9C4 2 2 4 2 9V15C2 20 4 22 9 22H15C20 22 22 20 22 15V11"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M16.1199 5.11002C15.7899 4.07002 16.1799 2.78002 17.2599 2.43002C17.8299 2.25002 18.5399 2.40002 18.9399 2.95002C19.3199 2.38002 20.0499 2.24002 20.6199 2.43002C21.7099 2.78002 22.0999 4.07002 21.7699 5.11002C21.2499 6.75002 19.4499 7.61002 18.9499 7.61002C18.4399 7.61002 16.6499 6.77002 16.1199 5.11002Z"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M2.66992 18.9501L7.59992 15.6401C8.38992 15.1101 9.52992 15.1701 10.2399 15.7801L10.5699 16.0701C11.3499 16.7401 12.6099 16.7401 13.3899 16.0701L17.5499 12.5001C18.3299 11.8301 19.5899 11.8301 20.3699 12.5001L21.9999 13.9001"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </div>
                <div class="settings-item-content">
                  <span class="settings-label">主页壁纸</span>
                  <div class="settings-value">
                    <div
                      id="wallpaper-preview"
                      style="
                        width: 24px;
                        height: 36px;
                        border-radius: 4px;
                        background-color: #eee;
                        margin-right: 5px;
                        background-size: cover;
                      "
                    ></div>
                  </div>
                  <img
                    class="settings-chevron"
                    src="data:image/svg+xml;charset=utf-8,%3Csvg width='8' height='13' viewBox='0 0 8 13' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M2.40952 12.3813L7.67842 7.22875C7.90423 7.00978 8.00003 6.77713 8.00003 6.49658C8.00003 6.21603 7.89739 5.98337 7.67842 5.76441L2.40952 0.61183C2.23161 0.433919 2.01949 0.351807 1.7663 0.351807C1.2531 0.351807 0.835693 0.755528 0.835693 1.26873C0.835693 1.52191 0.945177 1.75457 1.12993 1.93932L5.81036 6.48974L1.12993 11.0538C0.945177 11.2386 0.835693 11.4644 0.835693 11.7244C0.835693 12.2376 1.2531 12.6482 1.7663 12.6482C2.01949 12.6482 2.23161 12.5592 2.40952 12.3813Z' fill='%23C7C7CC'/%3E%3C/svg%3E"
                  />
                </div>
              </div>
              <div class="settings-item" id="reset-wallpaper-btn">
                <div
                  class="settings-item-content"
                  style="justify-content: center"
                >
                  <button
                    class="settings-button-text settings-button-destructive"
                  >
                    恢复默认壁纸
                  </button>
                </div>
              </div>

              <!-- Font -->
              <div class="settings-item" id="change-font-btn">
                <div
                  class="settings-icon-container"
                  style="background-color: #007aff"
                >
                  <svg
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M9 22H15C20 22 22 20 22 15V9C22 4 20 2 15 2H9C4 2 2 4 2 9V15C2 20 4 22 9 22Z"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M7 8.89C10.15 7.32 13.85 7.32 17 8.89"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M12 16.3V7.93"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </div>
                <div class="settings-item-content">
                  <span class="settings-label">全局字体</span>
                  <img
                    class="settings-chevron"
                    src="data:image/svg+xml;charset=utf-8,%3Csvg width='8' height='13' viewBox='0 0 8 13' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M2.40952 12.3813L7.67842 7.22875C7.90423 7.00978 8.00003 6.77713 8.00003 6.49658C8.00003 6.21603 7.89739 5.98337 7.67842 5.76441L2.40952 0.61183C2.23161 0.433919 2.01949 0.351807 1.7663 0.351807C1.2531 0.351807 0.835693 0.755528 0.835693 1.26873C0.835693 1.52191 0.945177 1.75457 1.12993 1.93932L5.81036 6.48974L1.12993 11.0538C0.945177 11.2386 0.835693 11.4644 0.835693 11.7244C0.835693 12.2376 1.2531 12.6482 1.7663 12.6482C2.01949 12.6482 2.23161 12.5592 2.40952 12.3813Z' fill='%23C7C7CC'/%3E%3C/svg%3E"
                  />
                </div>
              </div>
              <div class="settings-item" id="restore-font-btn">
                <div
                  class="settings-item-content"
                  style="justify-content: center"
                >
                  <button
                    class="settings-button-text settings-button-destructive"
                  >
                    恢复默认字体
                  </button>
                </div>
              </div>
            </div>

            <!-- Section: Data -->
            <div class="settings-group-header">数据安全</div>
            <div class="settings-group">
              <div class="settings-item" id="backup-data-btn">
                <div
                  class="settings-icon-container"
                  style="background-color: #34c759"
                >
                  <svg
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M9.32007 6.5L11.8801 3.94L14.4401 6.5"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-miterlimit="10"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M11.8799 14.18V4.01"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-miterlimit="10"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M4 12C4 16.42 7 20 12 20C17 20 20 16.42 20 12"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-miterlimit="10"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </div>
                <div class="settings-item-content">
                  <button class="settings-button-text" style="text-align: left">
                    备份所有数据
                  </button>
                </div>
              </div>
              <div class="settings-item" id="import-data-btn">
                <div
                  class="settings-icon-container"
                  style="background-color: #ff9500"
                >
                  <svg
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M9.32007 11.68L11.8801 14.24L14.4401 11.68"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-miterlimit="10"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M11.8799 4V14.17"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-miterlimit="10"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M20 12.18C20 16.6 17 20.18 12 20.18C7 20.18 4 16.6 4 12.18"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-miterlimit="10"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </div>
                <div class="settings-item-content">
                  <button class="settings-button-text" style="text-align: left">
                    恢复备份
                  </button>
                </div>
              </div>
            </div>

            <!-- Section: About -->
            <div class="settings-group-header">关于</div>
            <div class="settings-group">
              <div class="settings-item" id="about-device-btn">
                <div
                  class="settings-icon-container"
                  style="background-color: #8e8e93"
                >
                  <svg
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M12 7.75V13"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M21.08 8.58003V15.42C21.08 16.54 20.48 17.58 19.51 18.15L13.57 21.58C12.6 22.14 11.4 22.14 10.42 21.58L4.47998 18.15C3.50998 17.59 2.90997 16.55 2.90997 15.42V8.58003C2.90997 7.46003 3.50998 6.41999 4.47998 5.84999L10.42 2.42C11.39 1.86 12.59 1.86 13.57 2.42L19.51 5.84999C20.48 6.41999 21.08 7.45003 21.08 8.58003Z"
                      stroke="white"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M12 16.2V16.3"
                      stroke="white"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </div>
                <div class="settings-item-content">
                  <span class="settings-label">关于本机</span>
                  <div class="settings-value">v2.15</div>
                  <img
                    class="settings-chevron"
                    src="data:image/svg+xml;charset=utf-8,%3Csvg width='8' height='13' viewBox='0 0 8 13' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M2.40952 12.3813L7.67842 7.22875C7.90423 7.00978 8.00003 6.77713 8.00003 6.49658C8.00003 6.21603 7.89739 5.98337 7.67842 5.76441L2.40952 0.61183C2.23161 0.433919 2.01949 0.351807 1.7663 0.351807C1.2531 0.351807 0.835693 0.755528 0.835693 1.26873C0.835693 1.52191 0.945177 1.75457 1.12993 1.93932L5.81036 6.48974L1.12993 11.0538C0.945177 11.2386 0.835693 11.4644 0.835693 11.7244C0.835693 12.2376 1.2531 12.6482 1.7663 12.6482C2.01949 12.6482 2.23161 12.5592 2.40952 12.3813Z' fill='%23C7C7CC'/%3E%3C/svg%3E"
                  />
                </div>
              </div>
            </div>

            <div class="settings-footer-info">
              <div
                style="
                  display: flex;
                  gap: 10px;
                  flex-wrap: wrap;
                  justify-content: center;
                "
              >
                <span class="footer-tag device-tag">七七手机 xhs@7%</span>
                <span class="footer-tag version-tag"
                  >版本号：<span style="color: #5c9ebd; font-weight: 600"
                    >2</span
                  >.<span style="color: #5c9ebd; font-weight: 600"
                    >15364</span
                  ></span
                >
              </div>
            </div>
          </div>

          <input
            type="file"
            id="import-file-input"
            style="display: none"
            onchange="handleFileImport(event)"
            accept=".json,.zip,application/json,application/zip,application/x-zip-compressed,multipart/x-zip"
          />
          <input
            type="file"
            id="wallpaper-upload-input"
            accept="image/*"
            style="display: none"
          />
          <input
            type="file"
            id="font-import-input"
            accept=".ttf,.otf"
            style="display: none"
          />
        </div>
        <div id="music-screen" class="screen">
          <div class="settings-header">
            <button id="music-back-button" class="header-icon-button">
              <svg viewBox="0 0 24 24">
                <path
                  d="M15 18l-6-6 6-6"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </button>
            <h1>音乐</h1>
            <div class="header-actions">
              <button id="playlist-multiselect-btn" class="header-icon-button">
                <svg class="icon-select" viewBox="0 0 24 24">
                  <path
                    d="M8 6h13M8 12h13M8 18h13M3 6h.01M3 12h.01M3 18h.01"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </svg>
              </button>
            </div>
          </div>
          <div id="music-content" class="music-content">
            <button id="add-playlist-btn" class="add-playlist-button">
              新建歌单
            </button>
            <div class="scrollable-list-container">
              <div id="playlist-grid" class="playlist-grid"></div>
            </div>
          </div>
        </div>
        <div id="playlist-detail-screen" class="screen">
          <div class="settings-header playlist-header">
            <button id="playlist-back-button" class="header-icon-button">
              <svg viewBox="0 0 24 24">
                <path
                  d="M15 18l-6-6 6-6"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </button>
            <h1 id="playlist-name-title">歌单名称</h1>
            <div class="header-actions">
              <button id="edit-playlist-name-btn" class="header-icon-button">
                <svg
                  class="icon-filled"
                  width="28"
                  height="29"
                  viewBox="0 0 28 29"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <g clip-path="url(#clip0_201_71773)">
                    <path
                      d="M2.9375 24.7326H25.332C25.8477 24.7326 26.2812 24.299 26.2812 23.7834C26.2812 23.2678 25.8477 22.8459 25.332 22.8459H2.9375C2.42188 22.8459 2 23.2678 2 23.7834C2 24.299 2.42188 24.7326 2.9375 24.7326Z"
                      fill="black"
                      fill-opacity="0.85"
                    />
                    <path
                      d="M7.74215 19.9631L11.6328 18.3576C11.9257 18.2404 12.0664 18.135 12.2422 17.9592L23.457 6.82638C24.5586 5.73654 24.5469 4.45919 23.4336 3.33419L20.9727 0.84982C19.8477 -0.263462 18.5703 -0.286899 17.4688 0.802945L6.24215 11.9358C6.06637 12.0998 5.9609 12.2287 5.84371 12.5217L4.20308 16.4123C3.95699 16.9983 4.01558 17.5842 4.4609 18.0295L6.12496 19.7053C6.55855 20.1389 7.14449 20.2209 7.74215 19.9631ZM7.56637 18.1467C7.33199 18.2287 7.15621 18.2287 6.94527 18.0178L6.1484 17.2209C5.93746 17.01 5.93746 16.8225 6.03121 16.6115L7.48434 13.2014L18.6523 2.11544C18.9922 1.79904 19.3906 1.7756 19.707 2.09201L22.1797 4.5881C22.4961 4.91623 22.4727 5.31466 22.1445 5.64279L10.9765 16.7287L7.56637 18.1467ZM3.17184 20.549H4.5898C4.91793 20.549 5.05855 20.4904 5.31637 20.2795L6.41793 19.4358L4.73043 17.7131L2.83199 19.717C2.48043 20.0803 2.65621 20.549 3.17184 20.549ZM6.41793 13.2014L11.2109 18.0178L12.3125 16.9279L7.51949 12.0998L6.41793 13.2014ZM16.1445 3.55685L20.9375 8.37326L22.0391 7.29513L17.2461 2.46701L16.1445 3.55685Z"
                      fill="black"
                      fill-opacity="0.85"
                    />
                  </g>
                  <defs>
                    <clipPath id="clip0_201_71773">
                      <rect
                        width="24.2812"
                        height="28.0317"
                        fill="white"
                        transform="translate(2)"
                      />
                    </clipPath>
                  </defs>
                </svg>
              </button>
              <button id="upload-cover-btn" class="header-icon-button">
                <svg
                  class="icon-filled"
                  width="35"
                  height="30"
                  viewBox="0 0 35 30"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <g clip-path="url(#clip0_201_94166)">
                    <path
                      d="M3.70312 23.5195C2.56641 23.5195 1.88672 22.8398 1.88672 21.6914V20.9766L5.48438 17.8359C6 17.3789 6.5625 17.1445 7.07812 17.1445C7.65234 17.1445 8.25 17.3789 8.76562 17.8594L11.0039 19.875L16.6055 14.9062C17.1797 14.3906 17.8242 14.1562 18.4922 14.1562C19.1367 14.1562 19.8047 14.4023 20.3555 14.918L25.7461 19.9102V21.7148C25.7461 22.8398 25.0547 23.5195 23.9414 23.5195H3.70312ZM8.78906 14.9062C7.19531 14.9062 5.89453 13.6055 5.89453 12.0117C5.89453 10.4297 7.19531 9.11719 8.78906 9.11719C10.3711 9.11719 11.6719 10.4297 11.6719 12.0117C11.6719 13.6055 10.3711 14.9062 8.78906 14.9062ZM3.67969 25.3945H23.9531C26.4141 25.3945 27.6328 24.1875 27.6328 21.7734V7.45312C27.6328 5.03906 26.4141 3.82031 23.9531 3.82031H3.67969C1.23047 3.82031 0 5.03906 0 7.45312V21.7734C0 24.1875 1.23047 25.3945 3.67969 25.3945Z"
                      fill="black"
                      fill-opacity="0.85"
                    />
                    <path
                      d="M26.707 29.2148C30.8203 29.2148 34.2539 25.7812 34.2539 21.668C34.2539 17.5195 30.8438 14.1094 26.707 14.1094C22.5586 14.1094 19.1484 17.5195 19.1484 21.668C19.1484 25.8164 22.5469 29.2148 26.707 29.2148Z"
                      fill="white"
                    />
                    <path
                      d="M26.707 27.6211C29.9297 27.6211 32.6602 24.9141 32.6602 21.668C32.6602 18.3984 29.9648 15.7148 26.707 15.7148C23.4375 15.7148 20.7539 18.3984 20.7539 21.668C20.7539 24.9375 23.4375 27.6211 26.707 27.6211Z"
                      fill="black"
                      fill-opacity="0.85"
                    />
                    <path
                      d="M26.707 25.3945C26.2617 25.3945 25.9805 25.1016 25.9805 24.668V22.3828H23.6953C23.2617 22.3828 22.9805 22.1016 22.9805 21.668C22.9805 21.2227 23.2617 20.9414 23.6953 20.9414H25.9805V18.6562C25.9805 18.2344 26.2617 17.9414 26.707 17.9414C27.1406 17.9414 27.4219 18.2344 27.4219 18.6562V20.9414H29.707C30.1406 20.9414 30.4336 21.2227 30.4336 21.668C30.4336 22.1016 30.1406 22.3828 29.707 22.3828H27.4219V24.668C27.4219 25.1016 27.1406 25.3945 26.707 25.3945Z"
                      fill="white"
                    />
                  </g>
                  <defs>
                    <clipPath id="clip0_201_94166">
                      <rect width="34.2539" height="29.2148" fill="white" />
                    </clipPath>
                  </defs>
                </svg>
              </button>
              <button id="multi-select-btn" class="header-icon-button">
                <svg class="icon-select" viewBox="0 0 24 24">
                  <path
                    d="M8 6h13M8 12h13M8 18h13M3 6h.01M3 12h.01M3 18h.01"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </svg>
              </button>
            </div>
          </div>
          <div class="playlist-content">
            <button id="import-music-button" class="import-button">
              导入歌曲
            </button>
            <ul id="song-list" class="song-list"></ul>
          </div>
          <input
            type="file"
            id="music-file-input"
            accept=".mp3,.wav,.flac"
            multiple=""
            style="display: none"
          />
        </div>
        <div id="messages-screen" class="screen">
          <div class="settings-header">
            <button id="messages-back-button" class="header-icon-button">
              <svg
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M15 18l-6-6 6-6" />
              </svg>
            </button>

            <h1>消息</h1>

            <div class="header-actions">
              <button id="messages-add-btn" class="header-icon-button">
                <svg
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <line x1="12" y1="5" x2="12" y2="19"></line>
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
              </button>

              <button id="messages-multiselect-btn" class="header-icon-button">
                <svg
                  class="icon-select"
                  width="22"
                  height="22"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M8 6h13" />
                  <path d="M8 12h13" />
                  <path d="M8 18h13" />
                  <path d="M3 6h.01" />
                  <path d="M3 12h.01" />
                  <path d="M3 18h.01" />
                </svg>
              </button>
            </div>
          </div>
          <div
            id="create-group-modal"
            class="modal-overlay"
            style="display: none"
          >
            <div class="modal-content">
              <div class="modal-header">
                <button
                  id="create-group-back-btn"
                  class="app-back-button"
                  style="display: none; font-size: 14px"
                >
                  返回
                </button>
                <h2 id="create-group-title">创建群聊</h2>
                <button id="create-group-close-btn" class="modal-close-button">
                  &times;
                </button>
              </div>

              <div class="modal-body" style="padding: 0; overflow-y: auto">
                <div
                  id="group-mode-selection"
                  style="
                    padding: 20px;
                    display: flex;
                    flex-direction: column;
                    gap: 15px;
                  "
                >
                  <div class="group-mode-card" id="mode-select-existing">
                    <div
                      class="mode-icon"
                      style="background-color: rgba(173, 216, 255, 0.6)"
                    >
                      <svg
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          d="M9.15957 11.62C9.12957 11.62 9.10957 11.62 9.07957 11.62C9.02957 11.61 8.95957 11.61 8.89957 11.62C5.99957 11.53 3.80957 9.25 3.80957 6.44C3.80957 3.58 6.13957 1.25 8.99957 1.25C11.8596 1.25 14.1896 3.58 14.1896 6.44C14.1796 9.25 11.9796 11.53 9.18957 11.62C9.17957 11.62 9.16957 11.62 9.15957 11.62ZM8.99957 2.75C6.96957 2.75 5.30957 4.41 5.30957 6.44C5.30957 8.44 6.86957 10.05 8.85957 10.12C8.91957 10.11 9.04957 10.11 9.17957 10.12C11.1396 10.03 12.6796 8.42 12.6896 6.44C12.6896 4.41 11.0296 2.75 8.99957 2.75Z"
                          fill="#292D32"
                        />
                        <path
                          d="M16.5396 11.75C16.5096 11.75 16.4796 11.75 16.4496 11.74C16.0396 11.78 15.6196 11.49 15.5796 11.08C15.5396 10.67 15.7896 10.3 16.1996 10.25C16.3196 10.24 16.4496 10.24 16.5596 10.24C18.0196 10.16 19.1596 8.96 19.1596 7.49C19.1596 5.97 17.9296 4.74 16.4096 4.74C15.9996 4.75 15.6596 4.41 15.6596 4C15.6596 3.59 15.9996 3.25 16.4096 3.25C18.7496 3.25 20.6596 5.16 20.6596 7.5C20.6596 9.8 18.8596 11.66 16.5696 11.75C16.5596 11.75 16.5496 11.75 16.5396 11.75Z"
                          fill="#292D32"
                        />
                        <path
                          d="M9.16961 22.55C7.20961 22.55 5.23961 22.05 3.74961 21.05C2.35961 20.13 1.59961 18.87 1.59961 17.5C1.59961 16.13 2.35961 14.86 3.74961 13.93C6.74961 11.94 11.6096 11.94 14.5896 13.93C15.9696 14.85 16.7396 16.11 16.7396 17.48C16.7396 18.85 15.9796 20.12 14.5896 21.05C13.0896 22.05 11.1296 22.55 9.16961 22.55ZM4.57961 15.19C3.61961 15.83 3.09961 16.65 3.09961 17.51C3.09961 18.36 3.62961 19.18 4.57961 19.81C7.06961 21.48 11.2696 21.48 13.7596 19.81C14.7196 19.17 15.2396 18.35 15.2396 17.49C15.2396 16.64 14.7096 15.82 13.7596 15.19C11.2696 13.53 7.06961 13.53 4.57961 15.19Z"
                          fill="#292D32"
                        />
                        <path
                          d="M18.3397 20.75C17.9897 20.75 17.6797 20.51 17.6097 20.15C17.5297 19.74 17.7897 19.35 18.1897 19.26C18.8197 19.13 19.3997 18.88 19.8497 18.53C20.4197 18.1 20.7297 17.56 20.7297 16.99C20.7297 16.42 20.4197 15.88 19.8597 15.46C19.4197 15.12 18.8697 14.88 18.2197 14.73C17.8197 14.64 17.5597 14.24 17.6497 13.83C17.7397 13.43 18.1397 13.17 18.5497 13.26C19.4097 13.45 20.1597 13.79 20.7697 14.26C21.6997 14.96 22.2297 15.95 22.2297 16.99C22.2297 18.03 21.6897 19.02 20.7597 19.73C20.1397 20.21 19.3597 20.56 18.4997 20.73C18.4397 20.75 18.3897 20.75 18.3397 20.75Z"
                          fill="#FFFFFF"
                        />
                      </svg>
                    </div>
                    <div class="mode-info">
                      <h3>选择现有角色</h3>
                      <p>从通讯录选择AI或用户</p>
                    </div>
                  </div>

                  <div class="group-mode-card" id="mode-create-empty">
                    <div class="mode-icon" style="background-color: #34c759">
                      <svg
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          d="M17.8701 21.8698C17.5601 21.8698 17.2501 21.7898 16.9701 21.6198L12.9601 19.2397C12.5401 19.2297 12.1201 19.1998 11.7201 19.1398C11.4501 19.0998 11.2201 18.9197 11.1201 18.6597C11.0201 18.3997 11.0701 18.1197 11.2501 17.9097C11.9101 17.1397 12.2501 16.2197 12.2501 15.2397C12.2501 12.8197 10.1201 10.8497 7.50008 10.8497C6.52008 10.8497 5.58007 11.1198 4.79007 11.6398C4.57007 11.7798 4.30007 11.7998 4.06007 11.6898C3.83007 11.5798 3.66008 11.3597 3.63008 11.0997C3.60008 10.8197 3.58008 10.5398 3.58008 10.2498C3.58008 5.28976 7.88008 1.25977 13.1601 1.25977C18.4401 1.25977 22.7401 5.28976 22.7401 10.2498C22.7401 12.9698 21.4801 15.4697 19.2601 17.1797L19.6001 19.8998C19.6801 20.5798 19.3801 21.2198 18.8101 21.5898C18.5301 21.7698 18.2001 21.8698 17.8701 21.8698ZM13.1501 17.7297C13.2901 17.7197 13.4301 17.7598 13.5501 17.8398L17.7401 20.3298C17.8501 20.3998 17.9401 20.3698 18.0001 20.3298C18.0501 20.2998 18.1301 20.2198 18.1101 20.0798L17.7201 16.9197C17.6901 16.6397 17.8101 16.3698 18.0301 16.2098C20.0701 14.7798 21.2401 12.5997 21.2401 10.2297C21.2401 6.09974 17.6201 2.73975 13.1601 2.73975C8.87008 2.73975 5.35007 5.85979 5.09007 9.77979C5.84007 9.48979 6.65008 9.32977 7.49008 9.32977C10.9401 9.32977 13.7401 11.9697 13.7401 15.2197C13.7501 16.0997 13.5401 16.9497 13.1501 17.7297Z"
                          fill="#292D32"
                        />
                        <path
                          d="M4.57977 22.7498C4.31977 22.7498 4.06977 22.6798 3.83977 22.5298C3.38977 22.2398 3.14978 21.7398 3.20978 21.2098L3.40977 19.6698C2.05977 18.5698 1.25977 16.9398 1.25977 15.2298C1.25977 13.2798 2.27978 11.4598 3.98978 10.3698C5.01978 9.69981 6.23977 9.33984 7.50977 9.33984C10.9598 9.33984 13.7598 11.9798 13.7598 15.2298C13.7598 16.5498 13.2798 17.8498 12.3998 18.8798C11.2698 20.2498 9.57977 21.0498 7.71977 21.1098L5.27977 22.5598C5.05977 22.6898 4.81977 22.7498 4.57977 22.7498ZM7.49977 10.8398C6.51977 10.8398 5.57976 11.1098 4.78976 11.6298C3.50976 12.4498 2.74977 13.7898 2.74977 15.2298C2.74977 16.6198 3.42978 17.8898 4.62978 18.7098C4.85978 18.8698 4.97977 19.1398 4.94977 19.4198L4.72977 21.1298L7.11977 19.7098C7.23977 19.6398 7.36977 19.5998 7.49977 19.5998C8.96977 19.5998 10.3598 18.9698 11.2398 17.8998C11.8998 17.1198 12.2498 16.1998 12.2498 15.2198C12.2498 12.8098 10.1198 10.8398 7.49977 10.8398Z"
                          fill="#FFFFFF"
                        />
                      </svg>
                    </div>
                    <div class="mode-info">
                      <h3>新建空白群</h3>
                      <p>直接创建一个新群聊</p>
                    </div>
                  </div>
                </div>

                <div
                  id="group-member-select-container"
                  style="display: none; padding: 10px 0"
                >
                  <div id="group-member-list" class="contact-list"></div>
                </div>
              </div>

              <div
                class="modal-footer"
                id="group-create-footer"
                style="display: none"
              >
                <button id="confirm-create-group-btn" class="save-button">
                  确定创建
                </button>
              </div>
            </div>
          </div>
          <!-- 这里是消息界面的内容区域，现在是空的 -->
          <div class="messages-content">
            <ul id="contact-list" class="contact-list">
              <!-- 联系人列表项将通过 JS 动态添加到这里 -->
            </ul>
          </div>
          <div class="messages-bottom-bar">
            <div class="glass-segment-control">
              <button class="segment-btn active" data-type="single">
                单聊
              </button>
              <button class="segment-btn" data-type="group">群聊</button>
              <div class="segment-indicator"></div>
            </div>
          </div>
        </div>

        <!-- === 晤面 (Meetu) 界面 === -->
        <div id="meetu-screen" class="screen" style="display: none">
          <div class="meetu-paper-background"></div>
          <!-- 翻书动画层 -->
          <div id="meetu-book-animation" style="display: none">
            <div class="book-spine"></div>
            <div class="book-page left-page"></div>
            <div class="book-page right-page"></div>
          </div>

          <div class="settings-header meetu-header">
            <button id="meetu-back-button" class="header-icon-button">
              <svg
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M15 18l-6-6 6-6" />
              </svg>
            </button>
            <div style="flex: 1"></div>
            <button
              id="meetu-export-btn"
              class="header-icon-button"
              style="margin-right: 10px"
            >
              <!-- 导出图标 -->
              <svg
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
              </svg>
            </button>
            <button id="meetu-style-btn" class="header-icon-button">
              <!-- 羽毛笔图标 -->
              <svg
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path
                  d="M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5z"
                ></path>
                <line x1="16" y1="8" x2="2" y2="22"></line>
                <line x1="17.5" y1="15" x2="9" y2="15"></line>
              </svg>
            </button>
          </div>

          <div id="meetu-content-area" class="meetu-content">
            <!-- 文本内容将在这里动态生成 -->
            <div class="meetu-text-page active" id="meetu-active-page"></div>
          </div>

          <div class="meetu-page-controls">
            <button id="meetu-prev-page" class="page-nav-btn">&lt;</button>
            <span id="meetu-page-indicator">1 / 1</span>
            <button id="meetu-next-page" class="page-nav-btn">&gt;</button>
          </div>

          <div class="meetu-actions">
            <!-- 重Roll 图标: 刷新/循环 -->
            <button
              id="meetu-reroll-btn"
              class="meetu-action-btn icon-btn"
              title="重Roll"
            >
              <svg
                width="22"
                height="22"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <polyline points="23 4 23 10 17 10"></polyline>
                <polyline points="1 20 1 14 7 14"></polyline>
                <path
                  d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"
                ></path>
              </svg>
            </button>
            <!-- 续写 图标: 羽毛笔 -->
            <button
              id="meetu-continue-btn"
              class="meetu-action-btn icon-btn primary"
              title="续写"
            >
              <svg
                width="22"
                height="22"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path
                  d="M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5z"
                ></path>
                <line x1="16" y1="8" x2="2" y2="22"></line>
              </svg>
            </button>
          </div>
        </div>

        <!-- === 笔风设置弹窗 === -->
        <div id="meetu-style-modal" class="modal-overlay" style="display: none">
          <div class="modal-content">
            <div class="modal-header">
              <h2>笔风设置</h2>
              <button id="meetu-style-close-btn" class="modal-close-button">
                &times;
              </button>
            </div>
            <div class="modal-body">
              <button
                id="meetu-add-style-btn"
                class="add-playlist-button"
                style="margin-bottom: 15px"
              >
                + 新建笔风
              </button>
              <div id="meetu-style-list" class="scrollable-list-container">
                <!-- 笔风列表项 -->
              </div>
            </div>
          </div>
        </div>

        <!-- === 笔风编辑器 (嵌套弹窗或替换内容) === -->
        <div
          id="meetu-style-editor-modal"
          class="modal-overlay"
          style="display: none; z-index: 2100"
        >
          <div class="modal-content">
            <div class="modal-header">
              <h2 id="meetu-editor-title">编辑笔风</h2>
              <button id="meetu-editor-close-btn" class="modal-close-button">
                &times;
              </button>
            </div>
            <div class="modal-body">
              <input
                type="text"
                id="meetu-style-name"
                class="form-input"
                placeholder="笔风名称 (如: 细腻描写)"
                style="margin-bottom: 10px"
              />
              <textarea
                id="meetu-style-prompt"
                class="form-textarea"
                placeholder="输入Prompt指令，描述你想要的文风、视角和侧重点..."
                style="height: 150px"
              ></textarea>
            </div>
            <div class="modal-footer">
              <button id="meetu-save-style-btn" class="save-button">
                保存
              </button>
            </div>
          </div>
        </div>

        <!-- === 续写指导弹窗 === -->
        <div
          id="meetu-continue-modal"
          class="modal-overlay"
          style="display: none; z-index: 2101"
        >
          <div class="modal-content">
            <div class="modal-header">
              <h2>续写思路</h2>
              <button id="meetu-continue-close-btn" class="modal-close-button">
                &times;
              </button>
            </div>
            <div class="modal-body">
              <p class="modal-description">
                写出你的想法（也可以留空直接让它发挥）：
              </p>
              <textarea
                id="meetu-continue-input"
                class="form-textarea"
                placeholder="例如：'让他发现那张照片' 或 '描写一下窗外的雨声'..."
                style="height: 100px"
              ></textarea>
            </div>
            <div class="modal-footer">
              <button
                id="meetu-confirm-continue-btn"
                class="save-button"
                style="width: 100%"
              >
                开始续写
              </button>
            </div>
          </div>
        </div>

        <input
          type="file"
          id="cover-upload-input"
          accept="image/*"
          style="display: none"
        />
        <audio id="audio-player" style="display: none"></audio>
        <!-- === 新增：添加联系人弹出层 (Modal) === -->
        <div id="add-contact-modal" class="modal-overlay" style="display: none">
          <div class="modal-content">
            <!-- 1. 顶部滑块和关闭按钮 -->
            <div class="modal-header">
              <div class="role-switcher">
                <span class="switch-label active" data-form="ai">Char</span>
                <label class="switch">
                  <input type="checkbox" id="role-switch-checkbox" />
                  <span class="slider round"></span>
                </label>
                <span class="switch-label" data-form="user">User</span>
              </div>
              <button id="modal-close-btn" class="modal-close-button">
                &times;
              </button>
            </div>

            <!-- 2. AI信息表单 (默认显示) -->
            <div id="ai-form" class="role-form active">
              <div class="avatar-uploader">
                <img
                  src="https://placehold.co/100x100/EFEFEF/AAAAAA?text=Char"
                  id="ai-avatar-preview"
                  class="avatar-preview"
                />
                <input
                  type="file"
                  id="ai-avatar-input"
                  class="avatar-input"
                  accept="image/*"
                />
                <label for="ai-avatar-input" class="avatar-upload-label"
                  >上传头像</label
                >
              </div>
              <input
                type="text"
                id="ai-name-input"
                class="form-input"
                placeholder="  角色名"
              />
              <textarea
                id="ai-persona-input"
                class="form-textarea"
                placeholder="人设输入区域..."
              ></textarea>
            </div>

            <!-- 3. 用户信息表单 (默认隐藏) -->
            <div id="user-form" class="role-form">
              <div class="avatar-uploader">
                <img
                  src="https://placehold.co/100x100/EFEFEF/AAAAAA?text=User"
                  id="user-avatar-preview"
                  class="avatar-preview"
                />
                <input
                  type="file"
                  id="user-avatar-input"
                  class="avatar-input"
                  accept="image/*"
                />
                <label for="user-avatar-input" class="avatar-upload-label"
                  >上传头像</label
                >
              </div>
              <input
                type="text"
                id="user-name-input"
                class="form-input"
                placeholder="  你的名字"
              />
              <textarea
                id="user-persona-input"
                class="form-textarea"
                placeholder="你的人设..."
              ></textarea>
            </div>

            <!-- 4. 底部公共部分 -->
            <div class="modal-footer">
              <div class="form-group-inline">
                <label for="context-memory-input">上下文记忆:</label>
                <input
                  type="number"
                  id="context-memory-input"
                  class="form-input"
                  value="10"
                  min="0"
                  max="100"
                />
              </div>
              <button id="save-contact-btn" class="save-button">保存</button>
            </div>
          </div>
        </div>
        <!-- === 新增：聊天界面 === -->
        <div id="chat-screen" class="screen">
          <!-- 1. 悬浮顶栏 -->
          <div class="chat-header">
            <button id="chat-back-button" class="floating-glass-btn circle">
              <svg
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M10.5999 12.71C10.5062 12.617 10.4318 12.5064 10.381 12.3846C10.3302 12.2627 10.3041 12.132 10.3041 12C10.3041 11.868 10.3302 11.7373 10.381 11.6154C10.4318 11.4936 10.5062 11.383 10.5999 11.29L15.1899 6.71C15.2836 6.61704 15.358 6.50644 15.4088 6.38458C15.4596 6.26272 15.4857 6.13201 15.4857 6C15.4857 5.86799 15.4596 5.73728 15.4088 5.61542C15.358 5.49356 15.2836 5.38296 15.1899 5.29C15.0025 5.10375 14.7491 4.99921 14.4849 4.99921C14.2207 4.99921 13.9673 5.10375 13.7799 5.29L9.18989 9.88C8.62809 10.4425 8.31253 11.205 8.31253 12C8.31253 12.795 8.62809 13.5575 9.18989 14.12L13.7799 18.71C13.9662 18.8947 14.2176 18.9989 14.4799 19C14.6115 19.0008 14.742 18.9755 14.8638 18.9258C14.9856 18.876 15.0965 18.8027 15.1899 18.71C15.2836 18.617 15.358 18.5064 15.4088 18.3846C15.4596 18.2627 15.4857 18.132 15.4857 18C15.4857 17.868 15.4596 17.7373 15.4088 17.6154C15.358 17.4936 15.2836 17.383 15.1899 17.29L10.5999 12.71Z"
                  fill="#374957"
                />
              </svg>
            </button>

            <h1 id="chat-contact-name">角色名</h1>
            <div id="block-status-notice" style="display: none"></div>

            <div id="chat-header-actions-normal" class="floating-glass-group">
              <button id="chat-search-button" class="header-icon-btn">
                <svg
                  width="18"
                  height="18"
                  viewBox="0 0 18 18"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <g clip-path="url(#clip0_1800_966)">
                    <path
                      d="M17.7801 16.7203L13.3033 12.2435C14.5233 10.7515 15.1231 8.84758 14.9787 6.92568C14.8343 5.00378 13.9567 3.21091 12.5275 1.9179C11.0983 0.624891 9.22678 -0.069323 7.30007 -0.0211491C5.37336 0.0270248 3.53886 0.8139 2.17605 2.17672C0.813229 3.53954 0.0263534 5.37403 -0.0218205 7.30074C-0.0699943 9.22745 0.624219 11.099 1.91723 12.5282C3.21023 13.9574 5.00311 14.835 6.92501 14.9794C8.84691 15.1238 10.7508 14.524 12.2428 13.304L16.7196 17.7808C16.861 17.9174 17.0505 17.993 17.2471 17.9913C17.4438 17.9896 17.6319 17.9107 17.771 17.7716C17.91 17.6326 17.9889 17.4445 17.9906 17.2478C17.9923 17.0512 17.9167 16.8617 17.7801 16.7203ZM7.49984 13.5005C6.31315 13.5005 5.15311 13.1486 4.16642 12.4893C3.17972 11.83 2.41068 10.893 1.95656 9.79661C1.50243 8.70025 1.38361 7.49385 1.61512 6.32997C1.84664 5.16608 2.41808 4.09698 3.2572 3.25787C4.09631 2.41875 5.16541 1.84731 6.32929 1.6158C7.49318 1.38428 8.69958 1.5031 9.79594 1.95723C10.8923 2.41136 11.8294 3.18039 12.4887 4.16709C13.1479 5.15378 13.4998 6.31382 13.4998 7.50051C13.4981 9.09126 12.8653 10.6163 11.7405 11.7412C10.6157 12.866 9.09059 13.4987 7.49984 13.5005Z"
                      fill="#374957"
                    />
                  </g>
                  <defs>
                    <clipPath id="clip0_1800_966">
                      <rect width="18" height="18" fill="white" />
                    </clipPath>
                  </defs>
                </svg>
              </button>

              <button id="chat-settings-button" class="header-icon-btn">
                <svg
                  width="20"
                  height="20"
                  viewBox="0 0 20 20"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M10.0001 6.66718C9.34081 6.66718 8.69635 6.86267 8.14818 7.22894C7.60002 7.59521 7.17278 8.11581 6.92048 8.7249C6.66819 9.33398 6.60218 10.0042 6.7308 10.6508C6.85942 11.2974 7.17689 11.8914 7.64306 12.3575C8.10924 12.8237 8.70318 13.1412 9.34978 13.2698C9.99639 13.3984 10.6666 13.3324 11.2757 13.0801C11.8848 12.8278 12.4054 12.4006 12.7716 11.8524C13.1379 11.3042 13.3334 10.6598 13.3334 10.0005C13.3334 9.11645 12.9822 8.26861 12.3571 7.64349C11.732 7.01836 10.8841 6.66718 10.0001 6.66718V6.66718ZM10.0001 11.6672C9.67045 11.6672 9.34822 11.5694 9.07413 11.3863C8.80005 11.2032 8.58643 10.9429 8.46028 10.6383C8.33414 10.3338 8.30113 9.99866 8.36544 9.67536C8.42975 9.35206 8.58848 9.05509 8.82157 8.822C9.05466 8.58891 9.35163 8.43018 9.67493 8.36587C9.99823 8.30156 10.3333 8.33456 10.6379 8.46071C10.9424 8.58686 11.2027 8.80048 11.3859 9.07456C11.569 9.34864 11.6668 9.67087 11.6668 10.0005C11.6668 10.4425 11.4912 10.8665 11.1786 11.179C10.866 11.4916 10.4421 11.6672 10.0001 11.6672Z"
                    fill="#374957"
                  />
                  <path
                    d="M17.745 11.5833L17.375 11.37C17.5416 10.4637 17.5416 9.53463 17.375 8.62833L17.745 8.415C18.0296 8.25085 18.279 8.03226 18.479 7.77172C18.6791 7.51118 18.8259 7.21378 18.911 6.89651C18.9961 6.57925 19.0179 6.24832 18.9751 5.92263C18.9324 5.59694 18.8259 5.28286 18.6617 4.99833C18.4976 4.7138 18.279 4.46439 18.0184 4.26434C17.7579 4.06428 17.4605 3.91751 17.1432 3.83239C16.826 3.74726 16.495 3.72547 16.1693 3.76824C15.8436 3.81101 15.5296 3.91751 15.245 4.08167L14.8742 4.29583C14.1738 3.69743 13.3689 3.23354 12.5 2.9275V2.5C12.5 1.83696 12.2366 1.20107 11.7678 0.732233C11.299 0.263392 10.6631 0 10 0C9.33699 0 8.70111 0.263392 8.23227 0.732233C7.76343 1.20107 7.50004 1.83696 7.50004 2.5V2.9275C6.63119 3.23464 5.82658 3.69967 5.1267 4.29917L4.7542 4.08333C4.17957 3.75181 3.49677 3.66214 2.85602 3.83405C2.21527 4.00596 1.66906 4.42536 1.33754 5C1.00602 5.57464 0.916346 6.25743 1.08825 6.89818C1.26016 7.53893 1.67957 8.08515 2.2542 8.41667L2.6242 8.63C2.45763 9.5363 2.45763 10.4654 2.6242 11.3717L2.2542 11.585C1.67957 11.9165 1.26016 12.4627 1.08825 13.1035C0.916346 13.7442 1.00602 14.427 1.33754 15.0017C1.66906 15.5763 2.21527 15.9957 2.85602 16.1676C3.49677 16.3395 4.17957 16.2499 4.7542 15.9183L5.12504 15.7042C5.82567 16.3027 6.63085 16.7666 7.50004 17.0725V17.5C7.50004 18.163 7.76343 18.7989 8.23227 19.2678C8.70111 19.7366 9.33699 20 10 20C10.6631 20 11.299 19.7366 11.7678 19.2678C12.2366 18.7989 12.5 18.163 12.5 17.5V17.0725C13.3689 16.7654 14.1735 16.3003 14.8734 15.7008L15.2459 15.9158C15.8205 16.2474 16.5033 16.337 17.1441 16.1651C17.7848 15.9932 18.331 15.5738 18.6625 14.9992C18.9941 14.4245 19.0837 13.7417 18.9118 13.101C18.7399 12.4602 18.3205 11.914 17.7459 11.5825L17.745 11.5833ZM15.6217 8.43667C15.9039 9.45922 15.9039 10.5391 15.6217 11.5617C15.5724 11.7396 15.5837 11.9289 15.6537 12.0998C15.7236 12.2707 15.8484 12.4135 16.0084 12.5058L16.9117 13.0275C17.1032 13.138 17.243 13.3201 17.3003 13.5336C17.3575 13.7472 17.3276 13.9747 17.2171 14.1662C17.1066 14.3578 16.9246 14.4975 16.711 14.5548C16.4974 14.6121 16.2699 14.5822 16.0784 14.4717L15.1734 13.9483C15.0133 13.8556 14.8269 13.8188 14.6436 13.8437C14.4603 13.8686 14.2904 13.9538 14.1609 14.0858C13.4191 14.843 12.4847 15.3833 11.4584 15.6483C11.2792 15.6944 11.1205 15.7987 11.0072 15.9449C10.8939 16.0911 10.8324 16.2709 10.8325 16.4558V17.5C10.8325 17.721 10.7447 17.933 10.5885 18.0893C10.4322 18.2455 10.2202 18.3333 9.9992 18.3333C9.77819 18.3333 9.56623 18.2455 9.40995 18.0893C9.25367 17.933 9.16587 17.721 9.16587 17.5V16.4567C9.16596 16.2717 9.10451 16.092 8.99121 15.9458C8.8779 15.7996 8.71918 15.6952 8.54004 15.6492C7.51366 15.3831 6.57948 14.8416 5.83837 14.0833C5.70881 13.9513 5.53898 13.8661 5.35567 13.8412C5.17235 13.8163 4.98596 13.8531 4.82587 13.9458L3.92254 14.4683C3.82773 14.5239 3.72286 14.5602 3.61397 14.5751C3.50509 14.59 3.39433 14.5832 3.28808 14.5551C3.18183 14.527 3.08219 14.4782 2.99489 14.4114C2.90759 14.3446 2.83435 14.2613 2.7794 14.1661C2.72445 14.0709 2.68887 13.9658 2.6747 13.8568C2.66053 13.7479 2.66807 13.6372 2.69686 13.5311C2.72566 13.425 2.77515 13.3257 2.84248 13.2389C2.90981 13.152 2.99366 13.0793 3.0892 13.025L3.99254 12.5033C4.15249 12.411 4.27726 12.2682 4.34725 12.0973C4.41724 11.9264 4.42848 11.7371 4.3792 11.5592C4.097 10.5366 4.097 9.45672 4.3792 8.43417C4.42759 8.25657 4.41582 8.06795 4.34571 7.89774C4.27561 7.72754 4.15113 7.58534 3.9917 7.49333L3.08837 6.97167C2.89686 6.86116 2.75709 6.6791 2.69982 6.46555C2.64254 6.25199 2.67245 6.02442 2.78295 5.83292C2.89346 5.64141 3.07552 5.50164 3.28907 5.44437C3.50263 5.38709 3.73019 5.41699 3.9217 5.5275L4.8267 6.05083C4.98635 6.14376 5.17235 6.18101 5.35548 6.15672C5.5386 6.13244 5.70846 6.048 5.83837 5.91667C6.58011 5.15945 7.51456 4.61918 8.54087 4.35417C8.72056 4.30797 8.8797 4.20313 8.99306 4.05625C9.10643 3.90938 9.16754 3.72887 9.1667 3.54333V2.5C9.1667 2.27899 9.2545 2.06702 9.41078 1.91074C9.56706 1.75446 9.77902 1.66667 10 1.66667C10.221 1.66667 10.433 1.75446 10.5893 1.91074C10.7456 2.06702 10.8334 2.27899 10.8334 2.5V3.54333C10.8333 3.7283 10.8947 3.90804 11.008 4.05423C11.1213 4.20043 11.2801 4.30478 11.4592 4.35083C12.4859 4.61679 13.4204 5.15824 14.1617 5.91667C14.2913 6.04872 14.4611 6.13391 14.6444 6.15881C14.8277 6.1837 15.0141 6.14689 15.1742 6.05417L16.0775 5.53167C16.1723 5.47609 16.2772 5.43981 16.3861 5.42492C16.495 5.41003 16.6057 5.41683 16.712 5.44492C16.8182 5.47301 16.9179 5.52184 17.0052 5.58859C17.0925 5.65535 17.1657 5.73872 17.2207 5.83389C17.2756 5.92907 17.3112 6.03417 17.3254 6.14316C17.3395 6.25214 17.332 6.36285 17.3032 6.46891C17.2744 6.57497 17.2249 6.67429 17.1576 6.76114C17.0903 6.848 17.0064 6.92068 16.9109 6.975L16.0075 7.49667C15.8484 7.58892 15.7243 7.73123 15.6545 7.90141C15.5847 8.07159 15.5732 8.26008 15.6217 8.4375V8.43667Z"
                    fill="#374957"
                  />
                </svg>
              </button>
            </div>

            <div
              id="chat-header-actions-select"
              style="margin-left: auto; display: none"
            >
              <button id="forward-messages-btn" class="header-icon-button">
                <svg
                  width="22"
                  height="22"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8" />
                  <polyline points="16 6 12 2 8 6" />
                  <line x1="12" y1="2" x2="12" y2="15" />
                </svg>
              </button>
              <button
                id="delete-messages-btn"
                class="header-icon-button"
                style="color: #ff3b30"
              >
                <svg viewBox="0 0 24 24">
                  <polyline points="3 6 5 6 21 6" />
                  <path
                    d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"
                  />
                </svg>
              </button>
              <button id="cancel-selection-btn" class="header-icon-button">
                <svg
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M18 6L6 18M6 6l12 12" />
                </svg>
              </button>
            </div>
          </div>

          <!-- 2. 聊天消息容器 -->
          <div id="chat-messages-container" class="chat-messages-container">
            <!-- 聊天气泡将通过 JS 动态添加到这里 -->
          </div>

          <div class="feature-item" id="receipt-feature">
            <svg
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <g clip-path="url(#clip0_1532_6)">
                <path
                  d="M7.43945 7.30999C8.7074 8.40228 10.3259 9.00212 11.9995 8.99999C13.678 9.00254 15.3011 8.39925 16.5705 7.30099C15.8865 5.38699 14.3875 3.60999 12.0055 1.99999C9.62145 3.61299 8.12245 5.39399 7.44045 7.31199"
                  stroke="black"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M9.50391 22C10.3727 21.2287 11.2082 20.4207 12.0079 19.578C12.8048 20.4215 13.6382 21.2296 14.5059 22"
                  stroke="black"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M11 6H11.01"
                  stroke="black"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M12 19.5781V9.00012"
                  stroke="black"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M10 17H14"
                  stroke="black"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M8 13H16"
                  stroke="black"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </g>
              <defs>
                <clipPath id="clip0_1532_6">
                  <rect
                    width="24"
                    height="24"
                    fill="white"
                    transform="matrix(0 -1 1 0 0 24)"
                  />
                </clipPath>
              </defs>
            </svg>

            <!-- <span class="feature-name">接收</span> -->
          </div>

          <div id="more-features-panel" class="features-panel">
            <div class="features-grid">
              <div class="feature-item" id="time-perception-feature">
                <div class="feature-icon">
                  <svg
                    width="32"
                    height="32"
                    viewBox="0 0 32 32"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M16 28C9.5 28 4 22.5 4 16C4 11.8564 6.23502 8.11926 9.53935 5.95416C11.308 4.79528 13.383 4.0868 15.5856 4.00746L16 4L16 9C12.134 9 9 12.134 9 16C9 19.866 12.134 23 16 23C19.7855 23 22.8691 19.9952 22.9959 16.2407L23 16H28C28 22.4 22.6679 27.8305 16.2993 27.9961L16 28Z"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linecap="round"
                    />
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M20.0004 10.2549L20 4.68374C21.6055 5.22635 23.1055 6.1651 24.5 7.5C25.786 8.731 26.6883 10.1197 27.2068 11.6662L27.3121 12L21.7448 11.9992C21.2709 11.32 20.6796 10.7288 20.0004 10.2549Z"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linecap="round"
                    />
                  </svg>
                </div>
                <span class="feature-name">时间</span>
              </div>
              <div class="feature-item" id="transfer-feature">
                <div class="feature-icon">
                  <svg
                    width="32"
                    height="32"
                    viewBox="0 0 32 32"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M16 4C22.6274 4 28 9.37258 28 16C28 22.6274 22.6274 28 16 28C9.37258 28 4 22.6274 4 16C4 9.37258 9.37258 4 16 4Z"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M12 19C12 21 14 22 16 22C18 22 20 21 20 19C20 18 19 17 16 16C13 15 12 13.9963 12 13C12 11 14 10 16 10C18 10 20 11 20 13"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M16 9V23"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </div>
                <span class="feature-name">转账</span>
              </div>

              <div class="feature-item" id="image-feature">
                <div class="feature-icon">
                  <svg
                    width="32"
                    height="32"
                    viewBox="0 0 32 32"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M10.6273 16.9408L11.3728 18.0592C11.6179 18.4268 12.1146 18.5261 12.4822 18.2811C12.5577 18.2307 12.6241 18.168 12.6785 18.0954L17.3681 11.8426C17.6332 11.4891 18.1347 11.4175 18.4881 11.6826C18.5461 11.7261 18.598 11.7773 18.6422 11.8348L27.0095 22.7122C27.2788 23.0624 27.2133 23.5647 26.8631 23.8341C26.7233 23.9417 26.5518 24 26.3754 24H5.60005C5.15822 24 4.80005 23.6418 4.80005 23.2C4.80005 23.0269 4.85619 22.8585 4.96005 22.72L9.32162 16.9046C9.58671 16.5511 10.0882 16.4795 10.4416 16.7446C10.5142 16.799 10.5769 16.8653 10.6273 16.9408Z"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <circle
                      cx="10.5"
                      cy="10.5"
                      r="2.5"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </div>
                <span class="feature-name">图片</span>
              </div>

              <div class="feature-item" id="voice-call-feature">
                <div class="feature-icon">
                  <svg
                    width="32"
                    height="32"
                    viewBox="0 0 32 32"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M7.24049 4.94601L8.46792 4.70052C9.32077 4.52995 10.1861 4.93011 10.6085 5.6904L12.7024 9.45942C13.136 10.24 12.9997 11.2135 12.3683 11.8449L10.9586 13.2546C10.3098 13.9042 10.1866 14.9121 10.6604 15.6985C11.4555 17.0206 12.3812 18.2096 13.4373 19.2657C14.4933 20.3218 15.6816 21.2466 17.0019 22.0401C17.7884 22.5118 18.795 22.388 19.4439 21.7399L20.8535 20.3302C21.485 19.6988 22.4585 19.5624 23.239 19.9961L27.0081 22.09C27.7684 22.5124 28.1685 23.3777 27.9979 24.2305L27.7525 25.458C27.6351 26.0442 27.2617 26.5472 26.7337 26.8275C21.7799 29.468 16.4042 27.8895 10.6066 22.0919C4.80898 16.2943 3.23044 10.9186 5.87098 5.96478C6.1513 5.43674 6.65429 5.06335 7.24049 4.94601Z"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </div>
                <span class="feature-name">语音电话</span>
              </div>

              <div class="feature-item" id="call-summary-feature">
                <div class="feature-icon">
                  <svg
                    width="32"
                    height="32"
                    viewBox="0 0 32 32"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M27 20L16 25L5 20"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M16.4191 7.19342L27.0328 12.092C27.5343 12.3235 27.7531 12.9176 27.5217 13.4191C27.422 13.635 27.2487 13.8083 27.0328 13.908L16.4191 18.8066C16.1532 18.9293 15.8469 18.9293 15.581 18.8066L4.96729 13.908C4.46584 13.6765 4.24695 13.0824 4.47839 12.581C4.57804 12.365 4.75138 12.1917 4.96729 12.092L15.581 7.19342C15.8469 7.0707 16.1532 7.0707 16.4191 7.19342Z"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </div>
                <span class="feature-name">通话摘要</span>
              </div>

              <div class="feature-item" id="appointment-feature">
                <div class="feature-icon">
                  <svg
                    width="32"
                    height="32"
                    viewBox="0 0 32 32"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M20 16C23 16 23 12 23 12C23 12 25 14 25 19C25 24 22 28 16.0025 28C10.0051 28 7 23.9983 7 19C7 12 14 12 14 4C14 4 20 8 20 16Z"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linecap="round"
                    />
                    <path
                      d="M13.0579 27.0273C10.1158 20.0546 15 16 15 16C15 16 15 25 20 22C20 22 20 26.9 17 27.9"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linecap="round"
                    />
                  </svg>
                </div>
                <span class="feature-name">赴约</span>
              </div>

              <div class="feature-item" id="dating-history-feature">
                <div class="feature-icon">
                  <svg
                    width="32"
                    height="32"
                    viewBox="0 0 32 32"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M7 3H21L27 9V27C27 28.1046 26.1046 29 25 29H7C5.89543 29 5 28.1046 5 27V5C5 3.89543 5.89543 3 7 3Z"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M11 21H15"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M11 17H21"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M11 13H21"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M21 3V9H27"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </div>
                <span class="feature-name">约会记录</span>
              </div>
              <div class="feature-item" id="text-image-feature">
                <div class="feature-icon">
                  <svg
                    width="32"
                    height="32"
                    viewBox="0 0 32 32"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M6 4H26C27.1046 4 28 4.89543 28 6V26C28 27.1046 27.1046 28 26 28H6C4.89543 28 4 27.1046 4 26V6C4 4.89543 4.89543 4 6 4Z"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M11.9559 17.4338L12.1963 17.7945C12.5027 18.254 13.1236 18.3782 13.5831 18.0718C13.6839 18.0046 13.7717 17.9196 13.8421 17.821L17.1135 13.2411C17.4345 12.7917 18.0591 12.6876 18.5085 13.0086C18.6201 13.0884 18.7141 13.1902 18.7847 13.3078L23.0913 20.4855C23.3755 20.9591 23.2219 21.5733 22.7483 21.8575C22.5929 21.9507 22.4151 22 22.2338 22H9.61804C9.06576 22 8.61804 21.5523 8.61804 21C8.61804 20.8447 8.65419 20.6916 8.72361 20.5528L10.2294 17.5412C10.4764 17.0473 11.077 16.847 11.571 17.094C11.7267 17.1719 11.8593 17.289 11.9559 17.4338Z"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <circle
                      cx="11"
                      cy="12"
                      r="2"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </div>
                <span class="feature-name">文图</span>
              </div>
              <div class="feature-item" id="reroll-feature">
                <div class="feature-icon">
                  <svg
                    width="32"
                    height="32"
                    viewBox="0 0 32 32"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M16 7C11 7 7 11 7 16C7 21 11 25 16 25C21 25 25 21 25 16C25 13.3139 23.8456 10.9164 22.0018 9.2726"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M14 3L18 7L14 11"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </div>
                <span class="feature-name">重Roll</span>
              </div>

              <div class="feature-item" id="anywhere-door-feature">
                <div class="feature-icon">
                  <svg
                    width="32"
                    height="32"
                    viewBox="0 0 32 32"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M21 6L26 11L11 26H6L6 21L21 6Z"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M8 19L13 24"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M18 9L23 14"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linejoin="round"
                    />
                  </svg>
                </div>
                <span class="feature-name">任意门</span>
              </div>

              <div class="feature-item" id="narration-toggle-feature">
                <div class="feature-icon">
                  <svg
                    width="32"
                    height="32"
                    viewBox="0 0 32 32"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M18 5.18C17.35 5.06 16.68 5 16 5C9.92487 5 5 9.92487 5 16C5 18.0183 5.47679 19.9096 6.3585 21.5355L5 27L10.4269 25.6387C12.0065 26.5063 13.885 27 16 27C22.68 27 27 22.08 27 16C27 15.317 26.9378 14.6486 26.8189 14.0002"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M23 5L27 9"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M27 5L23 9"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M11 18H17"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M11 14H21"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </div>
                <div class="feature-name">隐藏动描旁白</div>
              </div>

              <div class="feature-item" id="attachment-file-feature">
                <div class="feature-icon">
                  <svg
                    width="32"
                    height="32"
                    viewBox="0 0 32 32"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M24 14C24 14 28 14.5 28 19C28 23.5 24 24 24 24H15C15 24 11 23.5 11 19C11 14.5 15 14 15 14H18"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M8 18C5.33333 17.6667 4 16 4 13C4 10 5.33333 8.33333 8 8H17C19.6667 8.33333 21 10 21 13C21 16 19.6667 17.6667 17 18H14"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </div>
                <span class="feature-name">附件</span>
              </div>

              <div class="feature-item" id="tic-tac-toe-feature">
                <div class="feature-icon">
                  <svg
                    width="32"
                    height="32"
                    viewBox="0 0 32 32"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M25 19V22C25 23.6569 23.6569 25 22 25H19V25"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M7 19V22C7 23.6569 8.34315 25 10 25H13V25"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M25 13V10C25 8.34315 23.6569 7 22 7H19V7"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M7 13V10C7 8.34315 8.34315 7 10 7H13V7"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </div>
                <span class="feature-name">井字棋</span>
              </div>

              <div class="feature-item" id="ludo-game-feature">
                <div class="feature-icon">
                  <svg
                    width="32"
                    height="32"
                    viewBox="0 0 32 32"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M7.24467 4.12232L29.2112 15.1056C29.7052 15.3526 29.9054 15.9532 29.6584 16.4472C29.5616 16.6407 29.4047 16.7977 29.2112 16.8944L7.24467 27.8777C6.75069 28.1247 6.15001 27.9244 5.90303 27.4305C5.78022 27.1849 5.76382 26.8996 5.85766 26.6415L8.80783 18.5285C8.92717 18.2004 9.20907 17.9582 9.55151 17.8897L19 16L9.55151 14.1103C9.20907 14.0418 8.92717 13.7996 8.80783 13.4715L5.85766 5.35849C5.66892 4.83946 5.93668 4.26569 6.45571 4.07695C6.71377 3.98311 6.99906 3.99952 7.24467 4.12232Z"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </div>
                <span class="feature-name">飞行棋</span>
              </div>

              <div class="feature-item" id="memory-feature">
                <div class="feature-icon">
                  <svg
                    width="32"
                    height="32"
                    viewBox="0 0 32 32"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M6 12H26C27.1046 12 28 12.8954 28 14V26C28 27.1046 27.1046 28 26 28H6C4.89543 28 4 27.1046 4 26V14C4 12.8954 4.89543 12 6 12Z"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M10 24H22"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M7 8H25"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M10 4H22"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </div>
                <span class="feature-name">记忆</span>
              </div>

              <div class="feature-item" id="peeping-feature">
                <div class="feature-icon">
                  <svg
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M17.0645 12.1579L20.9592 16.0526C21.2212 16.3525 21.3124 16.765 21.2013 17.1474L20.4856 19.6421C20.3753 20.0196 20.0826 20.3163 19.7066 20.4316L17.1487 21.2C16.741 21.3105 16.3053 21.1986 16.0013 20.9053L12.0961 17C11.5653 16.4697 10.8464 16.1708 10.0961 16.1684C9.73491 16.17 9.37746 16.2415 9.04345 16.3789C8.70814 16.5108 8.35111 16.5786 7.99082 16.5789C7.23959 16.5813 6.51893 16.2816 5.99082 15.7474L2.83292 12.5895C2.11555 11.8746 1.83459 10.831 2.09608 9.85263L3.32766 5.29474C3.57794 4.30573 4.34269 3.5289 5.32766 3.26316L9.92766 2.09474C10.1683 2.03221 10.4159 2.00037 10.6645 2C11.4148 2.00233 12.1337 2.30126 12.6645 2.83158L15.8224 5.98947C16.6314 6.79876 16.8762 8.01434 16.4434 9.07368C16.0107 10.133 16.2555 11.3486 17.0645 12.1579ZM16.9803 19.6526L19.0856 19.0316L19.6645 16.9684L15.9487 13.2526C14.6842 11.9957 14.3056 10.0987 14.9908 8.45263C15.1717 7.97833 15.0561 7.44201 14.6961 7.08421L11.5382 3.92632C11.3059 3.6882 10.9866 3.55514 10.654 3.55789C10.5458 3.5419 10.4358 3.5419 10.3277 3.55789L5.73819 4.78947C5.30689 4.9055 4.97 5.24239 4.85398 5.67368L3.6224 10.3053C3.50688 10.7381 3.63131 11.1997 3.94871 11.5158L7.10661 14.6737C7.33886 14.9118 7.65821 15.0449 7.99082 15.0421C8.1523 15.0406 8.31239 15.0121 8.4645 14.9579C8.98451 14.7403 9.54292 14.6293 10.1066 14.6316C11.291 14.6183 12.4303 15.0854 13.2645 15.9263L16.9803 19.6526Z"
                      fill="black"
                    />
                    <path
                      d="M10.2961 6.96842L7.03292 10.2316C6.72508 10.5398 6.72508 11.0391 7.03292 11.3474C7.34115 11.6552 7.84048 11.6552 8.14871 11.3474L11.4119 8.08421C11.5623 7.93759 11.6472 7.73641 11.6472 7.52632C11.6472 7.31622 11.5623 7.11504 11.4119 6.96842C11.1036 6.66058 10.6043 6.66058 10.2961 6.96842Z"
                      fill="black"
                    />
                  </svg>
                </div>
                <span class="feature-name">观序</span>
              </div>

              <div class="feature-item" id="meetu-feature">
                <div class="feature-icon">
                  <svg
                    width="32"
                    height="32"
                    viewBox="0 0 32 32"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M25 24.7782C25 20.4824 20.9706 17 16 17C11.0294 17 7 20.4824 7 24.7782C7 26.8737 11.2832 27.947 15.6708 27.9981H16.3292C20.7168 27.947 25 26.8737 25 24.7782Z"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <circle
                      cx="16"
                      cy="9"
                      r="5"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </div>
                <span class="feature-name">晤面</span>
              </div>

              <div class="feature-item" id="anecdotes-feature">
                <div class="feature-icon">
                  <svg
                    width="32"
                    height="32"
                    viewBox="0 0 32 32"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M6 7H26C27.1046 7 28 7.89543 28 9V23C28 24.1046 27.1046 25 26 25H6C4.89543 25 4 24.1046 4 23V9C4 7.89543 4.89543 7 6 7Z"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M8 11L16 17L24 11"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </div>
                <span class="feature-name">逸事</span>
              </div>

              <div class="feature-item" id="location-feature">
                <div class="feature-icon">
                  <svg
                    width="32"
                    height="32"
                    viewBox="0 0 32 32"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M16 4C11.5817 4 8 7.58172 8 12C8 17.5228 16 28 16 28C16 28 24 17.5228 24 12C24 7.58172 20.4183 4 16 4Z"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <circle
                      cx="16"
                      cy="12"
                      r="3"
                      stroke="#464646"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </div>
                <span class="feature-name">定位</span>
              </div>

              <input
                type="file"
                id="file-attachment-input"
                accept=".doc,.docx,.pdf,.ppt,.pptx"
                style="display: none"
              />
            </div>
          </div>

          <div id="reply-preview-bar">
            <div class="reply-text-wrapper">
              <div
                style="
                  font-size: 12px;
                  color: black;
                  font-weight: bold;
                  margin-bottom: 2px;
                "
              >
                回复: <span id="reply-preview-name">Name</span>
              </div>
              <div id="reply-preview-content" class="reply-content-text">
                Content...
              </div>
            </div>
            <button id="cancel-reply-btn" class="reply-close-btn">
              &times;
            </button>
          </div>

          <!-- 3. 底部输入区域 -->
          <div class="chat-input-area">
            <div class="action-button-group">
              <button id="voice-input-toggle" class="chat-action-button">
                <svg
                  id="mic-icon"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <rect
                    x="8"
                    y="2"
                    width="8"
                    height="13"
                    rx="4"
                    fill="#2B3F6C"
                    stroke="#2B3F6C"
                    stroke-width="1.5"
                  />
                  <path
                    d="M20 11.5C20 15.9183 16.4183 19.5 12 19.5C7.58172 19.5 4 15.9183 4 11.5"
                    stroke="#2B3F6C"
                    stroke-width="1.5"
                    stroke-linecap="round"
                  />
                  <path
                    d="M12 22V20"
                    stroke="#2B3F6C"
                    stroke-width="1.5"
                    stroke-linecap="round"
                  />
                </svg>

                <svg
                  id="keyboard-icon"
                  style="display: none"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M12 17.8096H2C1.59 17.8096 1.25 17.4696 1.25 17.0596C1.25 16.6496 1.59 16.3096 2 16.3096H12C12.41 16.3096 12.75 16.6496 12.75 17.0596C12.75 17.4796 12.41 17.8096 12 17.8096Z"
                    fill="#292D32"
                  />
                  <path
                    d="M9.77979 22.75H4.22974C2.03974 22.75 1.25977 21.98 1.25977 19.8V15.7C1.25977 13.52 2.03974 12.75 4.22974 12.75H9.77979C11.9698 12.75 12.7498 13.52 12.7498 15.7V19.81C12.7498 21.98 11.9698 22.75 9.77979 22.75ZM4.21973 14.25C2.85973 14.25 2.74976 14.36 2.74976 15.7V19.81C2.74976 21.15 2.85973 21.26 4.21973 21.26H9.76978C11.1298 21.26 11.2397 21.15 11.2397 19.81V15.7C11.2397 14.36 11.1298 14.25 9.76978 14.25H4.21973Z"
                    fill="#292D32"
                  />
                  <path
                    d="M15.0002 22.7502C14.7302 22.7502 14.4802 22.6002 14.3502 22.3702C14.2202 22.1302 14.2202 21.8502 14.3602 21.6102L15.4102 19.8602C15.6202 19.5102 16.0802 19.3902 16.4402 19.6002C16.8002 19.8102 16.9102 20.2702 16.7002 20.6302L16.4302 21.0802C19.1902 20.4302 21.2602 17.9502 21.2602 14.9902C21.2602 14.5802 21.6002 14.2402 22.0102 14.2402C22.4202 14.2402 22.7602 14.5802 22.7602 14.9902C22.7502 19.2702 19.2702 22.7502 15.0002 22.7502Z"
                    fill="#292D32"
                  />
                  <path
                    d="M2 9.75C1.59 9.75 1.25 9.41 1.25 9C1.25 4.73 4.73 1.25 9 1.25C9.27 1.25 9.52002 1.4 9.65002 1.63C9.78002 1.87 9.78001 2.15 9.64001 2.39L8.59003 4.14C8.38003 4.49 7.92 4.61 7.56 4.4C7.2 4.19 7.08999 3.73 7.29999 3.37L7.57001 2.92C4.81001 3.57 2.73999 6.05 2.73999 9.01C2.74999 9.41 2.41 9.75 2 9.75Z"
                    fill="#292D32"
                  />
                  <path
                    d="M18.5 11.75C15.61 11.75 13.25 9.4 13.25 6.5C13.25 3.6 15.6 1.25 18.5 1.25C21.4 1.25 23.75 3.6 23.75 6.5C23.75 9.4 21.39 11.75 18.5 11.75ZM18.5 2.75C16.43 2.75 14.75 4.43 14.75 6.5C14.75 8.57 16.43 10.25 18.5 10.25C20.57 10.25 22.25 8.57 22.25 6.5C22.25 4.43 20.57 2.75 18.5 2.75Z"
                    fill="#292D32"
                  />
                </svg>
              </button>
            </div>

            <div class="chat-input-wrapper">
              <input type="text" id="chat-message-input" placeholder=" " />
              <button id="voice-record-button" style="display: none">
                按住 说话
              </button>
            </div>

            <button id="chat-emoji-button" class="chat-action-button">
              <svg
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <g clip-path="url(#clip0_203_26915)">
                  <path
                    d="M12 24C9.62663 24 7.30655 23.2962 5.33316 21.9776C3.35977 20.6591 1.8217 18.7849 0.913451 16.5922C0.00519943 14.3995 -0.232441 11.9867 0.230582 9.65892C0.693605 7.33115 1.83649 5.19295 3.51472 3.51472C5.19295 1.83649 7.33115 0.693605 9.65892 0.230582C11.9867 -0.232441 14.3995 0.00519943 16.5922 0.913451C18.7849 1.8217 20.6591 3.35977 21.9776 5.33316C23.2962 7.30655 24 9.62663 24 12C23.9966 15.1815 22.7312 18.2318 20.4815 20.4815C18.2318 22.7312 15.1815 23.9966 12 24V24ZM12 2.00001C10.0222 2.00001 8.08879 2.5865 6.4443 3.68531C4.79981 4.78412 3.51809 6.34591 2.76121 8.17317C2.00433 10.0004 1.8063 12.0111 2.19215 13.9509C2.578 15.8907 3.53041 17.6725 4.92894 19.0711C6.32746 20.4696 8.10929 21.422 10.0491 21.8079C11.9889 22.1937 13.9996 21.9957 15.8268 21.2388C17.6541 20.4819 19.2159 19.2002 20.3147 17.5557C21.4135 15.9112 22 13.9778 22 12C21.9971 9.34873 20.9426 6.80689 19.0679 4.93215C17.1931 3.05742 14.6513 2.00292 12 2.00001V2.00001ZM17.666 15.746C17.8641 15.5696 17.9841 15.3218 17.9994 15.057C18.0148 14.7922 17.9244 14.5321 17.748 14.334C17.5716 14.1359 17.3238 14.0159 17.059 14.0006C16.7942 13.9852 16.5341 14.0756 16.336 14.252C15.1135 15.2813 13.5945 15.8936 12 16C10.4064 15.8937 8.88823 15.2821 7.66601 14.254C7.46815 14.0774 7.20824 13.9866 6.94344 14.0016C6.67864 14.0166 6.43064 14.1362 6.25401 14.334C6.07737 14.5319 5.98657 14.7918 6.00157 15.0566C6.01657 15.3214 6.13615 15.5694 6.33401 15.746C7.92187 17.1025 9.91422 17.8951 12 18C14.0858 17.8951 16.0781 17.1025 17.666 15.746ZM14 10C14 11 14.895 11 16 11C17.105 11 18 11 18 10C18 9.46957 17.7893 8.96087 17.4142 8.58579C17.0391 8.21072 16.5304 8.00001 16 8.00001C15.4696 8.00001 14.9609 8.21072 14.5858 8.58579C14.2107 8.96087 14 9.46957 14 10ZM11 10C11 9.73479 10.8946 9.48044 10.7071 9.2929C10.5196 9.10536 10.2652 9.00001 10 9.00001H7.00001C6.73479 9.00001 6.48044 9.10536 6.2929 9.2929C6.10536 9.48044 6.00001 9.73479 6.00001 10C6.00001 10.2652 6.10536 10.5196 6.2929 10.7071C6.48044 10.8946 6.73479 11 7.00001 11H10C10.2652 11 10.5196 10.8946 10.7071 10.7071C10.8946 10.5196 11 10.2652 11 10Z"
                    fill="#374957"
                  />
                </g>
                <defs>
                  <clipPath id="clip0_203_26915">
                    <rect width="24" height="24" fill="white" />
                  </clipPath>
                </defs>
              </svg>
            </button>

            <button id="chat-add-attachment-button" class="chat-action-button">
              <svg
                width="18"
                height="18"
                viewBox="0 0 18 18"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <g clip-path="url(#clip0_203_26735)">
                  <path
                    d="M17.25 8.25H9.75V0.75C9.75 0.551088 9.67098 0.360322 9.53033 0.21967C9.38968 0.0790176 9.19891 0 9 0V0C8.80109 0 8.61032 0.0790176 8.46967 0.21967C8.32902 0.360322 8.25 0.551088 8.25 0.75V8.25H0.75C0.551088 8.25 0.360322 8.32902 0.21967 8.46967C0.0790176 8.61032 0 8.80109 0 9H0C0 9.19891 0.0790176 9.38968 0.21967 9.53033C0.360322 9.67098 0.551088 9.75 0.75 9.75H8.25V17.25C8.25 17.4489 8.32902 17.6397 8.46967 17.7803C8.61032 17.921 8.80109 18 9 18C9.19891 18 9.38968 17.921 9.53033 17.7803C9.67098 17.6397 9.75 17.4489 9.75 17.25V9.75H17.25C17.4489 9.75 17.6397 9.67098 17.7803 9.53033C17.921 9.38968 18 9.19891 18 9C18 8.80109 17.921 8.61032 17.7803 8.46967C17.6397 8.32902 17.4489 8.25 17.25 8.25Z"
                    fill="#374957"
                  />
                </g>
                <defs>
                  <clipPath id="clip0_203_26735">
                    <rect width="18" height="18" fill="white" />
                  </clipPath>
                </defs>
              </svg>
            </button>
          </div>

          <div id="emoji-panel">
            <div class="emoji-panel-header">
              <button id="add-emoji-btn" class="panel-header-button">
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <line x1="12" y1="5" x2="12" y2="19"></line>
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
              </button>
              <button id="multiselect-emoji-btn" class="panel-header-button">
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </button>
            </div>
            <div id="emoji-grid-container"></div>
          </div>
        </div>

        <button id="scroll-to-bottom-btn">
          <svg
            width="27"
            height="31"
            viewBox="0 0 27 31"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <g clip-path="url(#clip0_201_5911)">
              <path
                d="M24.9049 13.6817L26.191 14.9678C26.7356 15.5123 26.7356 16.3929 26.191 16.9316L14.9349 28.1935C14.3904 28.7381 13.5098 28.7381 12.9711 28.1935L1.7092 16.9316C1.16464 16.3871 1.16464 15.5065 1.7092 14.9678L2.99528 13.6817C3.54562 13.1313 4.44356 13.1429 4.98232 13.7049L11.6329 20.6856V4.03611C11.6329 3.26562 12.2527 2.64575 13.0232 2.64575H14.877C15.6475 2.64575 16.2674 3.26562 16.2674 4.03611V20.6856L22.9179 13.7049C23.4567 13.1371 24.3546 13.1255 24.9049 13.6817Z"
                fill="black"
              />
            </g>
            <defs>
              <clipPath id="clip0_201_5911">
                <rect
                  width="25.9533"
                  height="29.6609"
                  fill="white"
                  transform="translate(0.973877 0.791992)"
                />
              </clipPath>
            </defs>
          </svg>
        </button>

        <div id="worldbook-screen" class="screen">
          <div class="settings-header">
            <button id="worldbook-back-button" class="header-icon-button">
              <svg viewBox="0 0 24 24">
                <path
                  d="M15 18l-6-6 6-6"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </button>
            <h1>世界书</h1>

            <div id="worldbook-header-actions-normal" class="header-actions">
              <button id="worldbook-groups-btn" class="header-icon-button">
                <svg
                  class="icon-filled"
                  width="28"
                  height="30"
                  viewBox="0 0 28 30"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <g clip-path="url(#clip0_201_72786)">
                    <path
                      d="M25.793 24.417V6.99121C25.793 4.54199 24.5742 3.31152 22.1602 3.31152H10.7578C8.34375 3.31152 7.125 4.54199 7.125 6.99121V24.417C7.125 26.8663 8.34375 28.085 10.7578 28.085H22.1602C24.5742 28.085 25.793 26.8663 25.793 24.417Z"
                      fill="black"
                      fill-opacity="0.85"
                    />
                    <path
                      d="M3 24.0538C3 26.9366 4.94531 28.7999 8.12109 28.6124C12.1055 28.4014 15.75 28.0264 20.3555 26.7491C22.7344 26.0694 23.8242 24.5459 23.8242 21.8155V4.65923C23.8242 1.17876 21.5039 -0.579054 18.3516 0.170946C15.1172 0.897509 11.7656 1.44829 7.64062 1.68267C4.91016 1.85845 3 3.61626 3 6.60454V24.0538Z"
                      fill="white"
                    />
                    <path
                      d="M4.59375 24.0538C4.59375 26.0928 5.85938 27.1475 8.02734 27.0186C11.9648 26.8077 15.4453 26.4444 19.9219 25.2139C21.5859 24.7452 22.2305 23.8663 22.2305 21.8155V4.65925C22.2305 2.32722 20.9766 1.1905 18.7266 1.71784C15.4453 2.45612 11.9648 3.04206 7.74609 3.28815C5.84766 3.40534 4.59375 4.48347 4.59375 6.60456V24.0538ZM6.48047 23.7139V6.55769C6.48047 5.57331 7.08984 5.18659 7.96875 5.13972C12 4.92878 15.4102 4.34284 18.6211 3.61628C19.7109 3.37019 20.3438 3.93269 20.3438 4.98737V21.7452C20.3438 22.8233 19.9805 23.3038 19.0781 23.5381C15.4102 24.5577 12 24.9327 8.10938 25.1319C7.08984 25.1788 6.48047 24.6631 6.48047 23.7139Z"
                      fill="black"
                      fill-opacity="0.85"
                    />
                    <path
                      d="M9.05859 9.28815C12.375 9.07722 15.0469 8.62019 17.7773 8.01081C18.3164 7.89362 18.4453 7.62409 18.4453 7.29597C18.4453 6.93269 18.1641 6.61628 17.6484 6.72175C15.0469 7.29597 12.375 7.76472 9.05859 7.97565C8.58984 8.01081 8.37891 8.29206 8.37891 8.65534C8.37891 9.03034 8.66016 9.31159 9.05859 9.28815ZM9.05859 13.0616C12.375 12.8506 15.0469 12.3819 17.7773 11.7842C18.3164 11.667 18.4453 11.3975 18.4453 11.0694C18.4453 10.7061 18.1641 10.3897 17.6484 10.4952C15.0469 11.0694 12.375 11.5381 9.05859 11.7491C8.58984 11.7842 8.37891 12.0655 8.37891 12.417C8.37891 12.792 8.66016 13.085 9.05859 13.0616ZM9.05859 16.835C12.375 16.6241 15.0469 16.1553 17.7773 15.5577C18.3164 15.4405 18.4453 15.1709 18.4453 14.8428C18.4453 14.4795 18.1641 14.1631 17.6484 14.2686C15.0469 14.8428 12.375 15.3116 9.05859 15.5225C8.58984 15.5577 8.37891 15.8389 8.37891 16.1905C8.37891 16.5655 8.66016 16.8584 9.05859 16.835ZM9.05859 20.5967C10.9805 20.4913 12.2578 20.3038 13.5234 20.1045C13.9102 20.0342 14.1211 19.7295 14.1211 19.4249C14.1211 19.0733 13.8398 18.7334 13.3125 18.8272C12.1875 19.003 10.9453 19.1788 9.05859 19.2842C8.58984 19.3194 8.37891 19.6006 8.37891 19.9522C8.37891 20.3272 8.66016 20.6202 9.05859 20.5967Z"
                      fill="black"
                      fill-opacity="0.85"
                    />
                  </g>
                  <defs>
                    <clipPath id="clip0_201_72786">
                      <rect
                        width="22.793"
                        height="29.3224"
                        fill="white"
                        transform="translate(3)"
                      />
                    </clipPath>
                  </defs>
                </svg>
              </button>
              <button id="worldbook-multiselect-btn" class="header-icon-button">
                <svg class="icon-select" viewBox="0 0 24 24">
                  <path
                    d="M8 6h13M8 12h13M8 18h13M3 6h.01M3 12h.01M3 18h.01"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </svg>
              </button>
            </div>

            <div
              id="worldbook-header-actions-select"
              class="header-actions"
              style="display: none"
            >
              <button id="move-books-btn" class="header-icon-button">
                <svg viewBox="0 0 24 24">
                  <path
                    d="M5 9l7-7 7 7M12 2v20"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </svg>
              </button>
              <button
                id="worldbook-cancel-select-btn"
                class="header-icon-button"
              >
                <svg viewBox="0 0 24 24">
                  <path
                    d="M18 6L6 18M6 6l12 12"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </svg>
              </button>
            </div>
          </div>
          <div class="music-content">
            <div class="scrollable-list-container">
              <div
                id="worldbook-list"
                class="contact-list"
                style="margin-top: 20px"
              ></div>
            </div>
          </div>
        </div>

        <!-- === 新增：聊天设置弹出层 (Modal) === -->
        <div
          id="chat-settings-modal"
          class="modal-overlay"
          style="display: none"
        >
          <div class="modal-content large">
            <div class="modal-header">
              <h2>聊天设置</h2>
              <button id="chat-settings-close-btn" class="modal-close-button">
                &times;
              </button>
            </div>

            <div class="modal-body settings-accordion">
              <!-- 1. 角色信息 (默认展开) -->
              <details class="settings-section" open>
                <summary>
                  <span>
                    <span class="section-icon">
                      <svg
                        width="28"
                        height="28"
                        viewBox="0 0 28 28"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <g clip-path="url(#clip0_201_74392)">
                          <path
                            d="M3.67969 24.5742H23.9531C26.4141 24.5742 27.6328 23.3672 27.6328 20.9531V6.63281C27.6328 4.21875 26.4141 3 23.9531 3H3.67969C1.23047 3 0 4.21875 0 6.63281V20.9531C0 23.3672 1.23047 24.5742 3.67969 24.5742ZM3.70312 22.6875C2.53125 22.6875 1.88672 22.0664 1.88672 20.8477V6.73828C1.88672 5.51953 2.53125 4.88672 3.70312 4.88672H23.9297C25.0898 4.88672 25.7461 5.51953 25.7461 6.73828V20.8477C25.7461 22.0664 25.0898 22.6875 23.9297 22.6875H3.70312Z"
                            fill="black"
                            fill-opacity="0.85"
                          />
                          <path
                            d="M5.19142 18.7148H11.6719C12.8086 18.7148 13.3477 18.1641 13.3477 17.0742V10.5234C13.3477 9.43359 12.8086 8.88281 11.6719 8.88281H5.19142C4.07813 8.88281 3.51562 9.42188 3.51562 10.5234V17.0742C3.51562 18.1641 4.07813 18.7148 5.19142 18.7148ZM4.87501 17.6133C5.22657 16.5586 6.55078 15.5742 8.4375 15.5742C10.3242 15.5742 11.6484 16.5586 12 17.6133H4.87501ZM8.4375 14.7422C7.40625 14.7422 6.59767 13.875 6.59767 12.7383C6.59767 11.6484 7.40625 10.7813 8.4375 10.7813C9.45704 10.7813 10.2656 11.6484 10.2656 12.7383C10.2656 13.875 9.45704 14.7422 8.4375 14.7422ZM19.5703 18.5859C20.332 18.5859 21.0469 18.5156 21.5039 18.3281C21.8203 18.1992 22.0078 18 22.0078 17.6953C22.0078 17.4023 21.7969 17.168 21.4922 17.168C21.375 17.168 21.2695 17.2031 21.1172 17.2266C20.7656 17.2734 20.4258 17.4141 19.6992 17.4141C17.4258 17.4141 16.0195 16.043 16.0195 13.8164C16.0195 11.625 17.4492 10.125 19.5352 10.125C21.6094 10.125 23.0039 11.4375 23.0039 13.3828C23.0039 14.543 22.6523 15.2695 22.0898 15.2695C21.7383 15.2695 21.5977 15.1172 21.5977 14.7773V11.8711C21.5977 11.5195 21.3516 11.25 21.0117 11.25C20.7539 11.25 20.5195 11.4375 20.4492 11.6719V11.7656C20.168 11.4375 19.7812 11.25 19.2188 11.25C17.9766 11.25 17.1094 12.3281 17.1094 13.8164C17.1094 15.3516 17.9766 16.3945 19.2539 16.3945C19.8164 16.3945 20.3086 16.1484 20.6484 15.7031C20.9062 16.1484 21.3984 16.3945 21.9844 16.3945C23.2969 16.3945 24.1641 15.1758 24.1641 13.3125C24.1641 10.7578 22.2656 8.98828 19.5352 8.98828C16.7109 8.98828 14.7773 10.9453 14.7773 13.8047C14.7773 16.6758 16.6992 18.5859 19.5703 18.5859ZM19.4297 15.2109C18.7969 15.2109 18.4102 14.6836 18.4102 13.793C18.4102 12.9141 18.8086 12.3984 19.4414 12.3984C20.0859 12.3984 20.4844 12.9141 20.4844 13.7578C20.4844 14.6602 20.0859 15.2109 19.4297 15.2109Z"
                            fill="black"
                            fill-opacity="0.85"
                          />
                        </g>
                        <defs>
                          <clipPath id="clip0_201_74392">
                            <rect
                              width="27.6328"
                              height="21.5742"
                              fill="white"
                              transform="translate(0 3)"
                            />
                          </clipPath>
                        </defs>
                      </svg>
                    </span>
                    角色信息
                  </span>
                  <span class="chevron">
                    <svg
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      width="16"
                      height="16"
                    >
                      <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                  </span>
                </summary>
                <div class="section-content">
                  <!-- 角色切换器: 顶部居中 -->
                  <div class="role-switcher">
                    <span class="switch-label active" data-form="ai-settings"
                      >Char</span
                    >
                    <label class="switch">
                      <input
                        type="checkbox"
                        id="role-switch-checkbox-settings"
                      />
                      <span class="slider"></span>
                      <!-- 移除 round 类，样式已在 CSS 中定义为圆角 -->
                    </label>
                    <span class="switch-label" data-form="user-settings"
                      >User</span
                    >
                  </div>

                  <!-- AI Form -->
                  <div id="ai-form-settings" class="role-form active">
                    <div class="compact-avatar-row">
                      <div class="avatar-left-col">
                        <img
                          src="https://placehold.co/100x100/EFEFEF/AAAAAA?text=Char"
                          id="ai-avatar-preview-settings"
                          class="avatar-preview"
                        />
                        <button
                          onclick="document.getElementById('ai-avatar-input-settings').click()"
                          class="change-avatar-btn-small"
                        >
                          更换头像
                        </button>
                        <input
                          type="file"
                          id="ai-avatar-input-settings"
                          style="display: none"
                          accept="image/*"
                        />
                      </div>
                      <div class="avatar-right-col">
                        <label
                          style="
                            font-size: 12px;
                            color: #8e8e93;
                            margin-bottom: 4px;
                            display: block;
                          "
                          >角色名</label
                        >
                        <input
                          type="text"
                          id="ai-name-input-settings"
                          class="form-input"
                          placeholder="角色名"
                        />
                      </div>
                    </div>
                    <label
                      style="
                        font-size: 12px;
                        color: #8e8e93;
                        margin-bottom: 4px;
                        display: block;
                      "
                      >人设 (Persona)</label
                    >
                    <textarea
                      id="ai-persona-input-settings"
                      class="form-textarea"
                      placeholder="人设..."
                      rows="4"
                    ></textarea>
                  </div>

                  <!-- User Form -->
                  <div id="user-form-settings" class="role-form">
                    <div class="compact-avatar-row">
                      <div class="avatar-left-col">
                        <img
                          src="https://placehold.co/100x100/EFEFEF/AAAAAA?text=User"
                          id="user-avatar-preview-settings"
                          class="avatar-preview"
                        />
                        <button
                          onclick="document.getElementById('user-avatar-input-settings').click()"
                          class="change-avatar-btn-small"
                        >
                          更换头像
                        </button>
                        <input
                          type="file"
                          id="user-avatar-input-settings"
                          style="display: none"
                          accept="image/*"
                        />
                      </div>
                      <div class="avatar-right-col">
                        <label
                          style="
                            font-size: 12px;
                            color: #8e8e93;
                            margin-bottom: 4px;
                            display: block;
                          "
                          >昵称</label
                        >
                        <input
                          type="text"
                          id="user-name-input-settings"
                          class="form-input"
                          placeholder="你的名字"
                        />
                      </div>
                    </div>
                    <label
                      style="
                        font-size: 12px;
                        color: #8e8e93;
                        margin-bottom: 4px;
                        display: block;
                      "
                      >人设 (User Persona)</label
                    >
                    <textarea
                      id="user-persona-input-settings"
                      class="form-textarea"
                      placeholder="你的人设..."
                      rows="4"
                    ></textarea>
                  </div>

                  <div class="form-group" style="margin-top: 16px">
                    <label
                      style="
                        font-size: 12px;
                        color: #8e8e93;
                        margin-bottom: 4px;
                        display: block;
                      "
                      >上下文记忆 (条数)</label
                    >
                    <input
                      type="number"
                      id="context-memory-input-settings"
                      class="form-input"
                      value="10"
                      min="0"
                      max="100"
                    />
                  </div>
                </div>
              </details>

              <!-- 2. 世界书设置 -->
              <details class="settings-section">
                <summary>
                  <span>
                    <span class="section-icon">
                      <svg
                        width="28"
                        height="28"
                        viewBox="0 0 28 28"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <g clip-path="url(#clip0_201_73339)">
                          <path
                            d="M1 22.8164C1 23.7773 1.63281 24.1523 2.32422 24.1523C2.72266 24.1523 3.0625 23.918 3.50781 23.6484C4.79688 22.7695 6.39062 22.2305 8.01953 22.2422C9.70703 22.2539 11.3828 22.875 12.6953 24.1406C13.2109 24.6094 13.5859 24.7617 14.0195 24.7617C14.4414 24.7617 14.8281 24.6094 15.332 24.1406C16.6445 22.8867 18.3203 22.2539 20.0195 22.2422C21.6484 22.2305 23.2305 22.7695 24.5195 23.6484C24.9648 23.918 25.3047 24.1523 25.7148 24.1523C26.3945 24.1523 27.0273 23.7773 27.0273 22.8164V6.91406C27.0273 6.71484 27.0156 6.55078 26.8867 6.35156C25.8438 4.53516 23.1953 3 19.9727 3C17.418 3 15.2031 4.01953 14.0195 5.46094C12.8359 4.01953 10.6094 3 8.06641 3C4.83203 3 2.18359 4.53516 1.14062 6.35156C1.02344 6.55078 1 6.71484 1 6.91406V22.8164ZM2.88672 21.8203V7.18359C3.83594 5.8125 5.89844 4.88672 8.06641 4.88672C10.293 4.88672 12.2383 5.82422 13.0703 7.25391V22.0195C11.875 21.0703 10.0117 20.3555 8.06641 20.3555C6.02734 20.3555 4.12891 20.9297 2.88672 21.8203ZM14.957 22.0195V7.25391C15.7891 5.82422 17.7461 4.88672 19.9727 4.88672C22.1289 4.88672 24.1914 5.8125 25.1406 7.18359V21.8203C23.8984 20.9297 22 20.3555 19.9727 20.3555C18.0156 20.3555 16.1523 21.0703 14.957 22.0195Z"
                            fill="black"
                            fill-opacity="0.85"
                          />
                        </g>
                        <defs>
                          <clipPath id="clip0_201_73339">
                            <rect
                              width="26.0273"
                              height="21.7852"
                              fill="white"
                              transform="translate(1 3)"
                            />
                          </clipPath>
                        </defs>
                      </svg>
                    </span>
                    世界书设置
                  </span>
                  <span class="chevron">
                    <svg
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      width="16"
                      height="16"
                    >
                      <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                  </span>
                </summary>
                <div class="section-content">
                  <div class="form-group">
                    <label>关联世界书组 (多选):</label>
                    <div
                      id="worldbook-group-multiselect-container"
                      class="multiselect-container"
                    ></div>
                  </div>
                  <div class="toggle-row">
                    <div>
                      <span>读取世界书表情包</span>
                      <div style="font-size: 10px; color: #888">
                        格式: [表情名:URL链接]
                      </div>
                    </div>
                    <label class="switch">
                      <input type="checkbox" id="enable-wb-stickers-toggle" />
                      <span class="slider round"></span>
                    </label>
                  </div>
                </div>
              </details>

              <!-- 3. 显示设置 -->
              <details class="settings-section">
                <summary>
                  <span>
                    <span class="section-icon">
                      <svg
                        width="38"
                        height="28"
                        viewBox="0 0 38 28"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <g clip-path="url(#clip0_201_87177)">
                          <path
                            d="M2.69531 22.2734H25.2305C26.918 22.2734 27.9375 21.2539 27.9375 19.5664V5.51562C27.9375 3.82812 26.918 2.82031 25.2305 2.82031H2.69531C1.01953 2.82031 0 3.82812 0 5.51562V19.5664C0 21.2539 1.01953 22.2734 2.69531 22.2734ZM2.73047 20.3867C2.21484 20.3867 1.88672 20.0586 1.88672 19.543V5.55078C1.88672 5.02344 2.21484 4.70703 2.73047 4.70703H25.207C25.7227 4.70703 26.0508 5.02344 26.0508 5.55078V19.543C26.0508 20.0586 25.7227 20.3867 25.207 20.3867H2.73047ZM10.2656 25.0625H17.6719V22.1211H10.2656V25.0625ZM10.1953 26.4336H17.7422C18.2578 26.4336 18.6797 26.0117 18.6797 25.4844C18.6797 24.957 18.2578 24.5352 17.7422 24.5352H10.1953C9.67969 24.5352 9.24609 24.957 9.24609 25.4844C9.24609 26.0117 9.67969 26.4336 10.1953 26.4336Z"
                            fill="black"
                            fill-opacity="0.85"
                          />
                          <path
                            d="M15.9375 20.3633C15.9375 22.4141 16.9453 23.3633 18.9492 23.3633H34.7227C36.7266 23.3633 37.7227 22.4141 37.7227 20.3633V11.4102C37.7227 9.35938 36.7266 8.39844 34.7227 8.39844H18.9492C16.9453 8.39844 15.9375 9.35938 15.9375 11.4102V20.3633Z"
                            fill="none"
                          />
                          <path
                            d="M15.9375 20.3633C15.9375 22.4141 16.9453 23.3633 18.9492 23.3633H34.7227C36.7266 23.3633 37.7227 22.4141 37.7227 20.3633V11.4102C37.7227 9.35938 36.7266 8.39844 34.7227 8.39844H18.9492C16.9453 8.39844 15.9375 9.35938 15.9375 11.4102V20.3633ZM17.8242 20.3281V11.4453C17.8242 10.6133 18.1758 10.2852 18.9844 10.2852H34.6875C35.4844 10.2852 35.8359 10.6133 35.8359 11.4453V20.3281C35.8359 21.1484 35.4844 21.4766 34.6875 21.4766H18.9844C18.1758 21.4766 17.8242 21.1484 17.8242 20.3281ZM23.7305 25.0625H29.9414V22.25H23.7305V25.0625ZM23.6602 26.4336H30C30.5273 26.4336 30.9492 26.0117 30.9492 25.4844C30.9492 24.957 30.5273 24.5352 30 24.5352H23.6602C23.1445 24.5352 22.7109 24.957 22.7109 25.4844C22.7109 26.0117 23.1445 26.4336 23.6602 26.4336Z"
                            fill="black"
                            fill-opacity="0.85"
                          />
                        </g>
                        <defs>
                          <clipPath id="clip0_201_87177">
                            <rect
                              width="37.7227"
                              height="24.4336"
                              fill="white"
                              transform="translate(0 2)"
                            />
                          </clipPath>
                        </defs>
                      </svg>
                    </span>
                    显示设置
                  </span>
                  <span class="chevron">
                    <svg
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      width="16"
                      height="16"
                    >
                      <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                  </span>
                </summary>
                <div class="section-content">
                  <div class="toggle-row">
                    <span>显示聊天头像</span>
                    <label class="switch">
                      <input type="checkbox" id="show-avatars-toggle" checked />
                      <span class="slider round"></span>
                    </label>
                  </div>
                  <div class="form-group" style="margin-bottom: 0">
                    <label for="avatar-radius-input"
                      >头像圆角 (e.g. 50%):</label
                    >
                    <input
                      type="text"
                      id="avatar-radius-input"
                      class="form-input"
                      value="50%"
                    />
                  </div>
                  <div class="toggle-row">
                    <span>显示消息时间</span>
                    <label class="switch">
                      <input type="checkbox" id="show-timestamps-toggle" />
                      <span class="slider round"></span>
                    </label>
                  </div>

                  <div class="toggle-row">
                    <span>显示内心独白</span>
                    <label class="switch">
                      <input
                        type="checkbox"
                        id="enable-monologue-toggle"
                        checked
                      />
                      <span class="slider round"></span>
                    </label>
                  </div>
                  <div class="toggle-row">
                    <span>双语折叠气泡</span>
                    <label class="switch">
                      <input
                        type="checkbox"
                        id="enable-bilingual-bubble-toggle"
                      />
                      <span class="slider round"></span>
                    </label>
                  </div>
                </div>
              </details>

              <!-- 4. 气泡样式 -->
              <details class="settings-section">
                <summary>
                  <span>
                    <span class="section-icon">
                      <svg
                        width="28"
                        height="28"
                        viewBox="0 0 28 28"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <g clip-path="url(#clip0_201_82444)">
                          <path
                            d="M8.20703 26.7461C8.78125 26.7461 9.17969 26.4414 9.89453 25.8086L13.9375 22.2109H21.4609C24.9531 22.2109 26.8281 20.2773 26.8281 16.8438V7.86719C26.8281 4.43359 24.9531 2.5 21.4609 2.5H6.36719C2.875 2.5 1 4.42188 1 7.86719V16.8438C1 20.2891 2.875 22.2109 6.36719 22.2109H6.92969V25.2578C6.92969 26.1602 7.38672 26.7461 8.20703 26.7461ZM8.6875 24.6016V21.2031C8.6875 20.5703 8.44141 20.3242 7.80859 20.3242H6.36719C4 20.3242 2.88672 19.1172 2.88672 16.832V7.86719C2.88672 5.58203 4 4.38672 6.36719 4.38672H21.4609C23.8164 4.38672 24.9414 5.58203 24.9414 7.86719V16.832C24.9414 19.1172 23.8164 20.3242 21.4609 20.3242H13.8672C13.2109 20.3242 12.8828 20.418 12.4375 20.875L8.6875 24.6016Z"
                            fill="black"
                            fill-opacity="0.85"
                          />
                          <path
                            d="M10.0703 17.875C10.4922 17.875 10.7852 17.6758 10.9727 17.125L11.8281 14.6289H16.0117L16.8672 17.125C17.0547 17.6641 17.3477 17.875 17.7812 17.875C18.2969 17.875 18.6367 17.5469 18.6367 17.0664C18.6367 16.8789 18.6016 16.7148 18.5078 16.457L15.2266 7.60938C15.0039 7 14.5469 6.68359 13.9141 6.68359C13.2812 6.68359 12.8359 7 12.6133 7.60938L9.33204 16.457C9.23829 16.7148 9.20312 16.8789 9.20312 17.0547C9.20312 17.5469 9.54297 17.875 10.0703 17.875ZM12.2969 13.2227L13.8555 8.6875H13.9844L15.543 13.2227H12.2969Z"
                            fill="black"
                            fill-opacity="0.85"
                          />
                        </g>
                        <defs>
                          <clipPath id="clip0_201_82444">
                            <rect
                              width="25.8281"
                              height="25.7461"
                              fill="white"
                              transform="translate(1 1)"
                            />
                          </clipPath>
                        </defs>
                      </svg>
                    </span>
                    气泡样式
                  </span>
                  <span class="chevron">
                    <svg
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      width="16"
                      height="16"
                    >
                      <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                  </span>
                </summary>
                <div class="section-content">
                  <textarea
                    id="bubble-css-input"
                    class="form-textarea code"
                    placeholder=".user-bubble { background-color: #007AFF; } ..."
                  ></textarea>
                  <div class="button-row">
                    <button
                      type="button"
                      id="select-bubble-preset-btn"
                      class="form-button-secondary"
                    >
                      选择预设
                    </button>
                    <button
                      type="button"
                      id="save-bubble-preset-btn"
                      class="form-button-secondary"
                    >
                      存为预设
                    </button>
                    <button
                      type="button"
                      id="restore-bubble-css-btn"
                      class="form-button-secondary"
                    >
                      恢复默认
                    </button>
                  </div>
                </div>
              </details>

              <!-- 5. 头像挂件 -->
              <details class="settings-section">
                <summary>
                  <span>
                    <span class="section-icon">
                      <svg
                        width="30"
                        height="28"
                        viewBox="0 0 30 28"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <g clip-path="url(#clip0_201_78602)">
                          <path
                            d="M11.9531 25.6289C18.4922 25.6289 23.9062 20.2031 23.9062 13.6758C23.9062 7.13672 18.4805 1.72266 11.9414 1.72266C5.41406 1.72266 0 7.13672 0 13.6758C0 20.2031 5.42578 25.6289 11.9531 25.6289ZM11.9531 23.6367C6.42188 23.6367 2.00391 19.207 2.00391 13.6758C2.00391 8.14453 6.41016 3.71484 11.9414 3.71484C17.4727 3.71484 21.9141 8.14453 21.9141 13.6758C21.9141 19.207 17.4844 23.6367 11.9531 23.6367Z"
                            fill="black"
                            fill-opacity="0.85"
                          />
                          <path
                            d="M22.3711 27.3633C26.4961 27.3633 29.9297 23.9297 29.9297 19.8047C29.9297 15.6562 26.5195 12.2461 22.3711 12.2461C18.2344 12.2461 14.8242 15.6562 14.8242 19.8047C14.8242 23.9648 18.2227 27.3633 22.3711 27.3633Z"
                            fill="white"
                          />
                          <path
                            d="M22.3711 25.7578C25.6055 25.7578 28.3242 23.0625 28.3242 19.8047C28.3242 16.5352 25.6406 13.8516 22.3711 13.8516C19.1133 13.8516 16.418 16.5469 16.418 19.8047C16.418 23.0859 19.1133 25.7578 22.3711 25.7578Z"
                            fill="black"
                            fill-opacity="0.85"
                          />
                          <path
                            d="M22.3711 23.5312C21.9375 23.5312 21.6562 23.25 21.6562 22.8164V20.5195H19.3594C18.9375 20.5195 18.6445 20.2383 18.6445 19.8047C18.6445 19.3711 18.9375 19.0898 19.3594 19.0898H21.6562V16.793C21.6562 16.3711 21.9375 16.0781 22.3711 16.0781C22.8047 16.0781 23.0859 16.3711 23.0859 16.793V19.0898H25.3828C25.8047 19.0898 26.0977 19.3711 26.0977 19.8047C26.0977 20.2383 25.8047 20.5195 25.3828 20.5195H23.0859V22.8164C23.0859 23.25 22.8047 23.5312 22.3711 23.5312Z"
                            fill="white"
                          />
                        </g>
                        <defs>
                          <clipPath id="clip0_201_78602">
                            <rect
                              width="29.9297"
                              height="27.3633"
                              fill="white"
                            />
                          </clipPath>
                        </defs>
                      </svg>
                    </span>
                    头像挂件
                  </span>
                  <span class="chevron">
                    <svg
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      width="16"
                      height="16"
                    >
                      <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                  </span>
                </summary>
                <div class="section-content">
                  <div class="form-group">
                    <label>角色 (Char) 挂件</label>
                    <textarea
                      id="ai-pendant-url-input"
                      class="form-textarea code"
                      rows="1"
                      placeholder="图片URL"
                    ></textarea>
                    <textarea
                      id="ai-pendant-css-input"
                      class="form-textarea code"
                      style="margin-top: 4px"
                      rows="2"
                      placeholder="CSS样式..."
                    ></textarea>
                    <button
                      id="restore-ai-pendant-btn"
                      class="form-button-secondary"
                      style="width: 100%; margin-top: 4px"
                    >
                      清除设定
                    </button>
                  </div>
                  <div class="form-group" style="margin-bottom: 0">
                    <label>用户 (User) 挂件</label>
                    <textarea
                      id="user-pendant-url-input"
                      class="form-textarea code"
                      rows="1"
                      placeholder="图片URL"
                    ></textarea>
                    <textarea
                      id="user-pendant-css-input"
                      class="form-textarea code"
                      style="margin-top: 4px"
                      rows="2"
                      placeholder="CSS样式..."
                    ></textarea>
                    <button
                      id="restore-user-pendant-btn"
                      class="form-button-secondary"
                      style="width: 100%; margin-top: 4px"
                    >
                      清除设定
                    </button>
                  </div>
                </div>
              </details>

              <!-- 6. 聊天背景 (修复版) -->
              <details class="settings-section">
                <summary>
                  <span>
                    <span class="section-icon">
                      <svg
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <g clip-path="url(#clip0_201_56693)">
                          <path
                            d="M0.75 23.25H23.25V0.75H0.75V23.25ZM21.75 21.75H20.5606L15.6856 16.875L18.2596 14.301L21.75 17.7914V21.75ZM2.25 2.25H21.75V15.6703L18.2596 12.18L14.625 15.8144L9.375 10.5644L2.25 17.6894V2.25ZM2.25 19.8106L9.375 12.6856L18.4394 21.75H2.25V19.8106Z"
                            fill="black"
                          />
                          <path
                            d="M5.625 3.75H3.75V5.625C4.24728 5.625 4.72419 5.42746 5.07583 5.07583C5.42746 4.72419 5.625 4.24728 5.625 3.75Z"
                            fill="black"
                          />
                          <path
                            d="M3.75 7.67161V9.21563C5.08917 8.92451 6.3164 8.2545 7.28545 7.28545C8.2545 6.3164 8.92451 5.08917 9.21563 3.75H7.67161C7.4105 4.6858 6.91237 5.5384 6.22539 6.22539C5.5384 6.91237 4.6858 7.4105 3.75 7.67161Z"
                            fill="black"
                          />
                        </g>
                        <defs>
                          <clipPath id="clip0_201_56693">
                            <rect width="24" height="24" fill="white" />
                          </clipPath>
                        </defs>
                      </svg>
                    </span>
                    聊天背景
                  </span>
                  <span class="chevron">
                    <svg
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      width="16"
                      height="16"
                    >
                      <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                  </span>
                </summary>
                <div class="section-content">
                  <div class="wallpaper-buttons">
                    <button
                      id="upload-chat-bg-btn"
                      class="form-button-secondary"
                    >
                      选择图片
                    </button>
                    <button
                      id="reset-chat-bg-btn"
                      class="form-button-secondary"
                    >
                      恢复默认
                    </button>
                  </div>
                </div>
              </details>

              <!-- 7. 危险操作 -->
              <details class="settings-section danger-section">
                <summary>
                  <span>
                    <span class="section-icon">
                      <svg
                        width="28"
                        height="28"
                        viewBox="0 0 28 28"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <g clip-path="url(#clip0_201_80719)">
                          <path
                            d="M5.19922 25.2656H23.3633C25.3555 25.2656 26.5625 23.8828 26.5625 22.0898C26.5625 21.5391 26.3984 20.9648 26.1055 20.4492L17.0117 4.60547C16.4023 3.53906 15.3594 3 14.2812 3C13.2031 3 12.1484 3.53906 11.5508 4.60547L2.45703 20.4492C2.14062 20.9766 2 21.5391 2 22.0898C2 23.8828 3.20703 25.2656 5.19922 25.2656ZM5.21094 23.4258C4.39062 23.4258 3.89844 22.793 3.89844 22.0781C3.89844 21.8555 3.94531 21.5742 4.07422 21.3281L13.1562 5.49609C13.4023 5.0625 13.8477 4.875 14.2812 4.875C14.7148 4.875 15.1484 5.0625 15.3945 5.49609L24.4766 21.3398C24.6055 21.5859 24.6641 21.8555 24.6641 22.0781C24.6641 22.793 24.1484 23.4258 23.3398 23.4258H5.21094Z"
                            fill="black"
                            fill-opacity="0.85"
                          />
                          <path
                            d="M14.2812 17.3672C14.8438 17.3672 15.1719 17.0391 15.1836 16.4297L15.3477 10.2539C15.3594 9.65625 14.8906 9.21094 14.2695 9.21094C13.6367 9.21094 13.1914 9.64453 13.2031 10.2422L13.3555 16.4297C13.3672 17.0273 13.6953 17.3672 14.2812 17.3672ZM14.2812 21.1758C14.9609 21.1758 15.5469 20.6367 15.5469 19.957C15.5469 19.2656 14.9727 18.7383 14.2812 18.7383C13.5898 18.7383 13.0156 19.2773 13.0156 19.957C13.0156 20.625 13.6016 21.1758 14.2812 21.1758Z"
                            fill="black"
                            fill-opacity="0.85"
                          />
                        </g>
                        <defs>
                          <clipPath id="clip0_201_80719">
                            <rect
                              width="24.5625"
                              height="22.3945"
                              fill="white"
                              transform="translate(2 3)"
                            />
                          </clipPath>
                        </defs>
                      </svg>
                    </span>
                    危险操作
                  </span>
                  <span class="chevron">
                    <svg
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      width="16"
                      height="16"
                    >
                      <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                  </span>
                </summary>
                <div class="section-content">
                  <div class="button-row">
                    <button
                      id="block-contact-btn"
                      class="danger-button"
                      style="flex: 1"
                    >
                      拉黑联系人
                    </button>
                    <button
                      id="clear-history-btn"
                      class="danger-button"
                      style="flex: 1"
                    >
                      清除记录
                    </button>
                  </div>
                </div>
              </details>
            </div>

            <div class="modal-footer">
              <button id="save-chat-settings-btn" class="save-button">
                保存设置
              </button>
            </div>

            <!-- 隐藏的文件上传输入框 -->
            <input
              type="file"
              id="chat-bg-upload-input"
              accept="image/*"
              style="display: none"
            />
          </div>
        </div>

        <!-- 隐藏的文件选择框，用于导入字体 -->
        <input
          type="file"
          id="font-import-input"
          accept=".ttf,.otf"
          style="display: none"
        />
        <input
          type="file"
          id="chat-image-upload-input"
          accept="image/*"
          style="display: none"
        />
        <div
          id="add-worldbook-modal"
          class="modal-overlay"
          style="display: none"
        >
          <div class="modal-content">
            <div class="modal-header">
              <h2>新建世界书</h2>
              <button id="worldbook-modal-close-btn" class="modal-close-button">
                &times;
              </button>
            </div>
            <div class="modal-body" style="gap: 15px; padding: 15px 0">
              <div class="form-group">
                <label for="worldbook-name-input">世界书名称</label>
                <input
                  type="text"
                  id="worldbook-name-input"
                  class="form-input"
                  placeholder="例如：艾泽拉斯编年史"
                />
              </div>
              <div class="form-group">
                <label for="worldbook-content-input">世界书内容</label>
                <textarea
                  id="worldbook-content-input"
                  class="form-textarea"
                  placeholder="输入关于这个世界的设定..."
                  style="height: 200px"
                ></textarea>
              </div>
            </div>
            <div class="modal-footer">
              <button id="save-worldbook-btn" class="save-button">保存</button>
            </div>
          </div>
        </div>

        <div id="beautify-screen" class="screen">
          <div class="settings-header">
            <button id="beautify-back-button" class="header-icon-button">
              <svg viewBox="0 0 24 24">
                <path
                  d="M15 18l-6-6 6-6"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </button>
            <h1>美化</h1>
          </div>

          <div class="settings-content">
            <div class="beautify-grid">
              <div class="beautify-card" id="change-icon-button">
                <div class="card-icon-bg">
                  <svg
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M21.2069 9.98669C20.7096 8.71206 19.9173 7.72469 18.9138 7.12366C18.6823 7.56861 18.4062 7.98886 18.0896 8.37789C18.0914 8.37892 18.0932 8.37981 18.095 8.38084C19.5894 9.23974 20.4586 11.4347 20.2086 13.7185C19.7946 17.5023 18.6453 20.0956 16.9726 21.0205C15.8851 21.6218 14.5288 21.5361 12.9413 20.7663L12.7862 20.6912H11.643L11.488 20.7663C9.90048 21.5362 8.54424 21.6218 7.45674 21.0205C5.78401 20.0956 4.63487 17.5023 4.22068 13.7185C3.97074 11.4347 4.83995 9.23969 6.33432 8.38084C6.81569 8.10591 7.36156 7.96405 7.91588 7.96985C9.04759 7.96985 10.3518 8.50005 11.769 9.54747L11.8195 9.58497C11.8195 9.58497 13.8625 9.33658 14.6718 8.96913C17.1103 7.86208 17.6484 6.10244 17.7438 5.86347C18.0251 5.16535 18.1657 4.41852 18.1575 3.66591C18.1493 2.91329 17.9924 2.16971 17.696 1.47789L17.5051 1.00122L16.9918 1.00638C16.1802 1.01527 15.3797 1.19574 14.6427 1.53593C13.9058 1.87612 13.2492 2.36834 12.7159 2.98027C12.1827 3.59221 11.7849 4.31001 11.5488 5.08655C11.3126 5.86309 11.2433 6.6808 11.3455 7.486C10.4596 6.98959 9.59813 6.67305 8.77285 6.54194C7.60365 6.35608 6.53171 6.53725 5.58685 7.08035C4.54913 7.67678 3.73149 8.68178 3.22239 9.9866C2.75954 11.1729 2.58451 12.5561 2.72954 13.8816C3.20495 18.226 4.58856 21.1485 6.73084 22.3332C7.43474 22.7237 8.22743 22.9262 9.0324 22.9211C9.95045 22.9211 10.9369 22.6777 11.9844 22.1911H12.4451C14.4324 23.1142 16.1991 23.1622 17.6985 22.3332C19.8407 21.1486 21.2244 18.2261 21.6999 13.8816C21.8448 12.5562 21.6698 11.173 21.2069 9.98669ZM15.3759 2.85128C15.7303 2.69869 16.104 2.59517 16.4865 2.5436C16.6564 3.13118 16.6977 3.74848 16.6075 4.35345C16.5173 4.95843 16.2978 5.53686 15.9639 6.04935C15.63 6.56184 15.1896 6.99634 14.6727 7.32326C14.1557 7.65019 13.5744 7.86185 12.9682 7.94383C12.6805 6.94739 12.7663 5.88019 13.2096 4.94254C13.6529 4.0049 14.4232 3.26129 15.3759 2.85128Z"
                      fill="black"
                    />
                  </svg>
                </div>
                <span class="card-label">更换图标</span>
              </div>

              <div class="beautify-card" id="manage-presets-button">
                <div class="card-icon-bg">
                  <svg
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M22.9065 10.3896C22.8016 10.2544 22.6671 10.1451 22.5134 10.0701C22.3597 9.99505 22.1908 9.95632 22.0197 9.95685H18.9166V7.49994C18.9163 7.21272 18.802 6.93736 18.5989 6.73427C18.3958 6.53117 18.1204 6.41694 17.8332 6.41661H11.4442L10.6111 4.4165C10.5291 4.21888 10.3903 4.05004 10.2123 3.93137C10.0343 3.81271 9.82506 3.74956 9.61111 3.74994H1.83333C1.54611 3.75028 1.27076 3.86452 1.06767 4.06761C0.864579 4.2707 0.750335 4.54606 0.75 4.83327V21.9166H20.4706L23.1111 11.3547C23.1531 11.1889 23.1565 11.0157 23.121 10.8483C23.0855 10.681 23.0121 10.524 22.9065 10.3896ZM2.25 20.4166V5.24994H9.33333L10.4443 7.91661H17.4167V9.95685H6.44939C6.1984 9.95652 5.95453 10.0403 5.75668 10.1947C5.55883 10.3492 5.41841 10.5654 5.35781 10.809L2.95608 20.4166H2.25ZM19.2995 20.4166H4.50225L6.74217 11.4568H21.5394L19.2995 20.4166Z"
                      fill="black"
                    />
                  </svg>
                </div>
                <span class="card-label">图标预设</span>
              </div>

              <div class="beautify-card" id="global-beautify-btn">
                <div class="card-icon-bg">
                  <svg
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M17.945 14.2764C17.586 12.9753 16.8101 11.8278 15.7362 11.01C14.6623 10.1923 13.3498 9.74942 12 9.74942C10.6502 9.74942 9.33772 10.1923 8.26384 11.01C7.18997 11.8278 6.41404 12.9753 6.0551 14.2764L5.19972 17.3772C5.04614 17.934 5.02323 18.5187 5.13277 19.0857C5.24231 19.6528 5.48134 20.1868 5.83123 20.6463C6.18112 21.1058 6.63241 21.4783 7.14991 21.7347C7.66741 21.991 8.23714 22.1244 8.81468 22.1244H15.1854C15.7629 22.1244 16.3326 21.991 16.8501 21.7347C17.3676 21.4783 17.8189 21.1058 18.1688 20.6463C18.5187 20.1868 18.7577 19.6528 18.8673 19.0857C18.9768 18.5187 18.9539 17.934 18.8003 17.3772L17.945 14.2764ZM16.9755 19.7374C16.7665 20.0141 16.4959 20.2383 16.1852 20.3923C15.8744 20.5462 15.5321 20.6257 15.1854 20.6244H8.81468C8.46815 20.6245 8.12631 20.5444 7.8158 20.3906C7.50529 20.2367 7.23451 20.0133 7.02458 19.7376C6.81464 19.4619 6.67122 19.1414 6.60549 18.8012C6.53977 18.461 6.55352 18.1101 6.64568 17.7761L7.50105 14.6754C7.77269 13.6907 8.3599 12.8223 9.17258 12.2034C9.98527 11.5846 10.9785 11.2494 12 11.2494C13.0215 11.2494 14.0148 11.5846 14.8275 12.2034C15.6402 12.8223 16.2274 13.6907 16.499 14.6754L17.3544 17.7761C17.4479 18.11 17.4623 18.4611 17.3965 18.8016C17.3308 19.142 17.1866 19.4625 16.9755 19.7376V19.7374Z"
                      fill="black"
                    />
                    <path
                      d="M6.84846 10.7957C6.97896 9.98011 6.8059 9.10697 6.36096 8.33653C5.91603 7.5661 5.24628 6.97964 4.47485 6.68485C3.64873 6.36933 2.8061 6.41958 2.10139 6.82627C0.700433 7.63514 0.331761 9.62869 1.27971 11.2703C1.72451 12.0407 2.39431 12.6273 3.16573 12.9219C3.50745 13.0551 3.87068 13.1246 4.23743 13.1268C4.69434 13.1285 5.14352 13.009 5.5392 12.7805C6.2435 12.3737 6.7085 11.6689 6.84846 10.7957ZM5.36721 10.5586C5.30018 10.9772 5.09487 11.3049 4.7891 11.4814C4.48334 11.658 4.0969 11.6718 3.70081 11.5207C3.2502 11.3486 2.85167 10.9933 2.57857 10.5203C2.05357 9.61088 2.17835 8.514 2.85139 8.12532C3.02058 8.0293 3.21219 7.97984 3.40671 7.98197C3.58919 7.98386 3.76978 8.01908 3.93959 8.08589C4.3902 8.25807 4.78873 8.61333 5.06182 9.08635C5.33492 9.55936 5.44334 10.0823 5.36721 10.5586Z"
                      fill="black"
                    />
                    <path
                      d="M7.01091 7.68889C7.5435 8.11466 8.1517 8.33638 8.76675 8.33633C8.95098 8.33627 9.13467 8.31646 9.31467 8.27722C10.8954 7.93358 11.8539 6.14708 11.4512 4.29482C11.2623 3.42547 10.803 2.66277 10.158 2.1471C9.46734 1.59491 8.64919 1.38589 7.85428 1.55877C6.27356 1.90236 5.31511 3.68886 5.71772 5.54113C5.90667 6.41052 6.36596 7.17322 7.01091 7.68889ZM8.17284 3.02455C8.24573 3.00883 8.32009 3.00098 8.39466 3.00111C8.67347 3.00111 8.96025 3.11019 9.22139 3.31897C9.59812 3.62014 9.86948 4.07994 9.98545 4.61371C10.2086 5.64003 9.75548 6.64658 8.99606 6.81167C8.65102 6.88667 8.27864 6.78224 7.94761 6.51753C7.57088 6.21632 7.29952 5.75652 7.18355 5.2228C6.96038 4.19619 7.41347 3.18964 8.17284 3.02455Z"
                      fill="black"
                    />
                    <path
                      d="M21.8986 6.82627C21.1942 6.41958 20.3511 6.36933 19.5252 6.68485C18.7537 6.97955 18.084 7.5661 17.6392 8.33654C17.1944 9.10698 17.0213 9.98031 17.1517 10.7957C17.2914 11.6689 17.7563 12.3738 18.4609 12.7805C18.8566 13.009 19.3058 13.1285 19.7627 13.1268C20.1294 13.1246 20.4927 13.0551 20.8344 12.922C21.6058 12.6273 22.2756 12.0407 22.7204 11.2703C23.6682 9.6287 23.2996 7.63515 21.8986 6.82627ZM21.4214 10.5203C21.1483 10.9933 20.7498 11.3486 20.2992 11.5207C19.9033 11.672 19.5168 11.6581 19.211 11.4814C18.9052 11.3048 18.7001 10.9772 18.6329 10.5587C18.5567 10.0824 18.6651 9.55956 18.9382 9.08677C19.2113 8.61399 19.6098 8.25849 20.0604 8.08632C20.2302 8.01944 20.4108 7.98416 20.5933 7.98221C20.7878 7.98008 20.9794 8.02954 21.1486 8.12555C21.8217 8.51391 21.9466 9.61065 21.4214 10.5203Z"
                      fill="black"
                    />
                    <path
                      d="M14.6854 8.27697C14.8654 8.31621 15.049 8.33603 15.2333 8.33608C15.8483 8.33608 16.4567 8.11441 16.9891 7.68865C17.6341 7.17302 18.0934 6.41027 18.2823 5.54093C18.6849 3.68866 17.7265 1.90216 16.1457 1.55857C15.3509 1.38579 14.5327 1.59466 13.842 2.1469C13.197 2.66252 12.7377 3.42527 12.5488 4.29457C12.1461 6.14683 13.1046 7.93333 14.6854 8.27697ZM14.0146 4.61322C14.1305 4.07946 14.4019 3.61947 14.7786 3.31849C15.0398 3.10971 15.3266 3.00063 15.6054 3.00063C15.6799 3.00049 15.7543 3.00835 15.8272 3.02407C16.5866 3.18916 17.0396 4.19594 16.8166 5.22204C16.7005 5.7558 16.4291 6.21579 16.0525 6.51682C15.7215 6.78147 15.3494 6.88591 15.0041 6.81096C14.2445 6.6461 13.7914 5.63941 14.0146 4.61322Z"
                      fill="black"
                    />
                  </svg>
                </div>
                <span class="card-label">全局美化</span>
              </div>

              <div class="beautify-card" id="theme-presets-btn">
                <div class="card-icon-bg">
                  <svg
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M23.0482 12.0326L20.4721 9.71414L21.2412 9.08573C21.5854 8.80291 21.8768 8.46135 22.102 8.07689C22.9526 6.60309 22.7051 4.79367 21.4858 3.57445C20.2666 2.35523 18.4571 2.10769 16.9834 2.95842C16.599 3.18354 16.2575 3.47495 15.9747 3.81914L15.3462 4.58822L13.0277 2.01216L13.0006 1.98352C12.7894 1.77286 12.5033 1.65456 12.2051 1.65456C11.9068 1.65456 11.6207 1.77286 11.4096 1.98352L8.33457 5.05875L8.39036 6.16969L9.94229 7.43794C10.1495 7.60726 10.3253 7.81178 10.4616 8.04211C10.9682 8.9197 10.8165 10.0015 10.084 10.734C9.35153 11.4664 8.26993 11.6181 7.39215 11.1117C7.16164 10.9753 6.95695 10.7994 6.78746 10.592L5.51964 9.04045L4.4087 8.98472L1.06839 12.325C0.963914 12.4295 0.881042 12.5535 0.824502 12.69C0.767962 12.8265 0.738861 12.9728 0.738861 13.1205C0.738861 13.2683 0.767962 13.4146 0.824502 13.5511C0.881042 13.6876 0.963914 13.8116 1.06839 13.9161L9.28825 22.136C9.63647 22.4842 10.0499 22.7605 10.5048 22.9489C10.9598 23.1374 11.4475 23.2344 11.9399 23.2344C12.4324 23.2344 12.92 23.1374 13.375 22.9489C13.83 22.7605 14.2434 22.4842 14.5916 22.136L23.0767 13.6508C23.2873 13.4396 23.4056 13.1535 23.4056 12.8553C23.4056 12.557 23.2873 12.271 23.0767 12.0598L23.0482 12.0326ZM13.5309 21.0754C13.322 21.2843 13.0739 21.4501 12.8009 21.5631C12.528 21.6762 12.2354 21.7344 11.9399 21.7344C11.6444 21.7344 11.3518 21.6762 11.0788 21.5631C10.8059 21.4501 10.5578 21.2843 10.3489 21.0754L2.39396 13.1204L4.88303 10.6316L5.62881 11.5444L5.6335 11.55C5.9163 11.8942 6.25784 12.1856 6.64229 12.4107C8.11609 13.2615 9.92546 13.0139 11.1447 11.7946C12.364 10.5753 12.6115 8.766 11.7608 7.29225C11.5357 6.9078 11.2443 6.56626 10.9 6.28345L9.98172 5.53298L12.1907 3.32405L14.8165 6.24159L15.9547 6.21445L17.1295 4.7768C17.2988 4.56957 17.5033 4.39379 17.7336 4.25752C18.6112 3.75094 19.693 3.90272 20.4255 4.63514C21.1579 5.36756 21.3097 6.4492 20.8031 7.32698C20.6669 7.55732 20.4911 7.76184 20.2838 7.93116L18.8462 9.10589L18.819 10.2441L21.7366 12.87L13.5309 21.0754Z"
                      fill="black"
                    />
                  </svg>
                </div>
                <span class="card-label">主题预设</span>
              </div>

              <div class="beautify-card" id="bubble-presets-btn">
                <div class="card-icon-bg">
                  <svg
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <g clip-path="url(#clip0_201_55708)">
                      <path
                        d="M23.25 23.25H22.5C19.4173 23.2498 16.4379 22.1384 14.1082 20.1196L13.3194 19.436C12.8819 19.4785 12.4395 19.5 12 19.5C9.02217 19.5 6.21633 18.5423 4.09931 16.8033C1.93945 15.0292 0.75 12.6574 0.75 10.125C0.75 7.59258 1.93945 5.2208 4.09931 3.44667C6.21633 1.7077 9.02217 0.75 12 0.75C14.9778 0.75 17.7837 1.7077 19.9007 3.44667C22.0605 5.2208 23.25 7.59258 23.25 10.125C23.2489 11.4712 22.9092 12.7954 22.262 13.9758C21.7002 15.0039 20.9521 15.9185 20.0558 16.6729C20.7257 18.3761 21.738 19.9237 23.0303 21.2197L23.25 21.4394V23.25ZM13.8026 17.8698L15.0906 18.9861C16.867 20.5255 19.0788 21.4735 21.4187 21.6982C20.1277 20.2552 19.1307 18.574 18.4836 16.749L18.2775 16.1648L18.7092 15.8335C20.6701 14.3287 21.75 12.3014 21.75 10.125C21.75 5.78269 17.3761 2.25 12 2.25C6.62386 2.25 2.25 5.78269 2.25 10.125C2.25 14.4673 6.62386 18 12 18C12.492 17.9999 12.9835 17.97 13.4719 17.9103L13.8026 17.8698Z"
                        fill="black"
                      />
                    </g>
                    <defs>
                      <clipPath id="clip0_201_55708">
                        <rect width="24" height="24" fill="white" />
                      </clipPath>
                    </defs>
                  </svg>
                </div>
                <span class="card-label">气泡预设</span>
              </div>

              <div class="beautify-card" id="change-clock-button">
                <div class="card-icon-bg">
                  <svg
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <g clip-path="url(#clip0_201_56152)">
                      <path
                        d="M12.0117 0.75C9.06048 0.751574 6.22804 1.91278 4.125 3.9833V0.75H2.625V6.75H8.625V5.25H4.9822C5.89145 4.30228 6.9828 3.54802 8.19075 3.0325C9.39871 2.51698 10.6984 2.25082 12.0117 2.25C17.3813 2.25 21.75 6.61875 21.75 11.9883C21.75 17.3578 17.3813 21.7266 12.0117 21.7266C6.64219 21.7266 2.27344 17.3578 2.27344 11.9883H0.773438C0.773435 14.211 1.43255 16.3838 2.66742 18.2319C3.9023 20.0801 5.65748 21.5205 7.71101 22.3711C9.76454 23.2217 12.0242 23.4443 14.2042 23.0106C16.3842 22.577 18.3867 21.5067 19.9584 19.935C21.5301 18.3633 22.6004 16.3608 23.0341 14.1808C23.4677 12.0007 23.2451 9.7411 22.3946 7.68758C21.5439 5.63405 20.1035 3.87887 18.2554 2.64399C16.4073 1.40911 14.2344 0.749997 12.0117 0.75Z"
                        fill="black"
                      />
                      <path
                        d="M11.2499 5.24756L11.2248 13.4999H17.2499V11.9999H12.7294L12.7499 5.25215L11.2499 5.24756Z"
                        fill="black"
                      />
                    </g>
                    <defs>
                      <clipPath id="clip0_201_56152">
                        <rect width="24" height="24" fill="white" />
                      </clipPath>
                    </defs>
                  </svg>
                </div>
                <span class="card-label">时钟样式</span>
              </div>

              <div class="beautify-card" id="motto-settings-btn">
                <div class="card-icon-bg">
                  <svg
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M22.8736 7.30506C22.8813 7.14808 22.8561 6.99123 22.7996 6.84458C22.7431 6.69793 22.6565 6.56472 22.5455 6.45353L17.6309 1.53892C17.5198 1.42777 17.3866 1.34114 17.2399 1.28463C17.0932 1.22811 16.9364 1.20295 16.7794 1.21078C16.6224 1.2186 16.4688 1.25924 16.3285 1.33006C16.1882 1.40089 16.0642 1.50033 15.9647 1.62198L11.7489 6.77457L5.64878 8.01742C5.43746 8.05988 5.24042 8.15542 5.0762 8.29504C4.91199 8.43466 4.786 8.61377 4.7101 8.81551L0.838275 19.0232C0.751237 19.2532 0.732382 19.5034 0.783972 19.7438C0.835562 19.9842 0.955406 20.2047 1.12913 20.3787L3.62621 22.8758C3.8002 23.0495 4.02062 23.1694 4.26103 23.221C4.50144 23.2726 4.75164 23.2537 4.9816 23.1667L15.1938 19.2932C15.3926 19.2182 15.5695 19.0946 15.7083 18.9336C15.8471 18.7727 15.9434 18.5796 15.9883 18.3719L17.3055 12.3391L22.4625 8.1197C22.584 8.02008 22.6834 7.89614 22.7542 7.75585C22.825 7.61555 22.8657 7.462 22.8736 7.30506ZM14.5486 17.9335L4.58471 21.713L3.96868 21.0969L8.62618 16.4394C9.17657 16.7486 9.81987 16.8493 10.4384 16.7231C11.057 16.5969 11.6094 16.2523 11.9947 15.7522C12.3801 15.2522 12.5725 14.6302 12.5368 13.9999C12.5012 13.3696 12.2398 12.7732 11.8006 12.3198C11.3614 11.8664 10.7736 11.5863 10.1447 11.5306C9.5159 11.475 8.88806 11.6476 8.37604 12.0169C7.86402 12.3861 7.50204 12.9274 7.3563 13.5416C7.21057 14.1558 7.29081 14.802 7.58237 15.3619L2.90799 20.0363L2.29192 19.4202L6.06892 9.46262L11.915 8.27153L15.8081 12.1645L14.5486 17.9335ZM8.78532 14.151C8.78532 13.9285 8.8513 13.711 8.97492 13.526C9.09854 13.341 9.27424 13.1968 9.4798 13.1116C9.68537 13.0265 9.91157 13.0042 10.1298 13.0476C10.348 13.091 10.5485 13.1982 10.7058 13.3555C10.8632 13.5128 10.9703 13.7133 11.0137 13.9315C11.0571 14.1498 11.0348 14.376 10.9497 14.5815C10.8645 14.7871 10.7203 14.9628 10.5353 15.0864C10.3503 15.21 10.1328 15.276 9.91032 15.276C9.61195 15.276 9.32581 15.1575 9.11483 14.9465C8.90385 14.7355 8.78532 14.4494 8.78532 14.151ZM16.6787 10.9136L13.1706 7.4057L16.8632 2.89257L21.1918 7.22115L16.6787 10.9136Z"
                      fill="black"
                    />
                  </svg>
                </div>
                <span class="card-label">签名样式</span>
              </div>

              <div class="beautify-card" id="app-name-settings-btn">
                <div class="card-icon-bg">
                  <svg
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M21.9508 4.97434C18.5101 2.67976 15.2582 1.54398 12.0096 1.50203C8.71987 1.46148 5.4749 2.4722 2.08771 4.59723C1.75595 4.80342 1.51824 5.13144 1.42559 5.51091C1.33294 5.89038 1.39274 6.29104 1.59215 6.62692L10.7134 22.1669C10.8441 22.3922 11.0318 22.5793 11.2576 22.7093C11.4834 22.8393 11.7394 22.9076 11.9999 22.9076H12.0074C12.2666 22.9088 12.5217 22.8423 12.7473 22.7145C12.9728 22.5868 13.1611 22.4023 13.2934 22.1793L22.4043 6.99423C22.6032 6.66389 22.667 6.26958 22.5825 5.89335C22.4981 5.51712 22.2718 5.18795 21.9508 4.97434ZM21.1181 6.22234L12.007 21.4076L2.88492 5.86787C5.95809 3.93971 8.88056 3.0009 11.8127 3.0009C11.8719 3.0009 11.9311 3.00128 11.9902 3.00203C14.9403 3.04009 17.9262 4.09351 21.1185 6.22234H21.1181Z"
                      fill="black"
                    />
                    <path
                      d="M10.4802 10.8518C10.4357 10.5985 10.3171 10.3642 10.1394 10.1784C9.96171 9.99259 9.7329 9.86365 9.48192 9.80788C9.23094 9.75211 8.96906 9.77202 8.7294 9.8651C8.48974 9.95817 8.28306 10.1202 8.1355 10.3308C7.98794 10.5413 7.90613 10.7909 7.90041 11.0479C7.89469 11.3049 7.96532 11.5579 8.10337 11.7748C8.24142 11.9917 8.44069 12.1628 8.67598 12.2664C8.91127 12.3701 9.172 12.4016 9.42521 12.357C9.76472 12.2973 10.0666 12.1052 10.2644 11.8229C10.4623 11.5406 10.5399 11.1913 10.4802 10.8518Z"
                      fill="black"
                    />
                    <path
                      d="M15.2716 14.2869C15.8165 13.8194 15.8792 12.9988 15.4118 12.4539C14.9443 11.9091 14.1237 11.8463 13.5788 12.3138C13.0339 12.7812 12.9712 13.6019 13.4386 14.1467C13.9061 14.6916 14.7267 14.7544 15.2716 14.2869Z"
                      fill="black"
                    />
                    <path
                      d="M10.98 14.8002L10.0197 15.9525L12.2696 17.8275L13.23 16.6752L10.98 14.8002Z"
                      fill="black"
                    />
                    <path
                      d="M14.7365 7.92446L11.7365 9.04945L12.2632 10.4539L15.2632 9.32895L14.7365 7.92446Z"
                      fill="black"
                    />
                    <path
                      d="M5.64844 8.51169C7.20881 7.53271 9.61153 6.37555 12.2493 6.37555C12.2878 6.37555 12.3265 6.3758 12.3652 6.3763C14.5625 6.40443 16.5782 7.07943 18.7087 8.50035L19.541 7.2524C17.1585 5.66366 14.8845 4.90865 12.3845 4.8764C9.3352 4.83866 6.60539 6.14076 4.85156 7.24105L5.64844 8.51169Z"
                      fill="black"
                    />
                  </svg>
                </div>
                <span class="card-label">图标名称</span>
              </div>

              <div class="beautify-card" id="manage-font-urls-btn">
                <div class="card-icon-bg">
                  <svg
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M10.7906 16.726L11.4668 15.2891C10.7988 14.6231 10.1664 13.9225 9.57206 13.1902C10.0683 12.5208 10.5308 11.834 10.9593 11.1296C12.1486 9.17709 13.0696 7.07332 13.6974 4.875H16.125V3.375H9.375V0.75H7.875V3.375H0.75V4.875H3.55172C4.28444 7.44072 5.41451 9.87584 6.90084 12.0918C7.22011 11.6978 7.54331 11.2747 7.86487 10.8248C6.68099 8.97637 5.75592 6.97451 5.11547 4.875H12.1344C10.7409 9.44672 8.1713 12.8066 6.19814 14.865C3.90159 17.2606 1.88789 18.4678 1.86783 18.4797L1.94381 18.608L2.25 19.125L2.63156 19.7707C2.71936 19.7188 4.81003 18.4709 7.24355 15.9419C7.72417 15.4425 8.18417 14.9279 8.62355 14.3983C9.30203 15.2139 10.0255 15.991 10.7906 16.726Z"
                      fill="black"
                    />
                    <path
                      d="M15.6432 9.375L15.375 9.96169L9.81461 22.125H11.4639L13.1782 18.375H19.8218L21.536 22.125H23.1853L17.3567 9.375H15.6432ZM15.375 16.875H13.8639L15.375 13.5696L16.5 11.1086L19.136 16.875H15.375Z"
                      fill="black"
                    />
                  </svg>
                </div>
                <span class="card-label">字体URL</span>
              </div>
            </div>
          </div>
        </div>

        <div id="icon-settings-screen" class="screen">
          <div class="settings-header">
            <button id="icon-settings-back-button" class="header-icon-button">
              <svg viewBox="0 0 24 24">
                <path
                  d="M15 18l-6-6 6-6"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </button>
            <h1>更换图标</h1>
            <div class="header-actions">
              <button id="save-preset-button" class="header-button">
                <svg
                  class="icon-filled"
                  width="29"
                  height="31"
                  viewBox="0 0 29 31"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <g clip-path="url(#clip0_201_88499)">
                    <path
                      d="M6.26953 22.9453H22.3359C25.9805 22.9453 28.6055 20.7305 28.6055 17.25C28.6055 13.7695 25.9805 11.5547 22.3359 11.5547H6.26953C2.625 11.5547 0 13.7695 0 17.25C0 20.7305 2.625 22.9453 6.26953 22.9453ZM22.3359 21.0586H6.26953C3.77344 21.0586 1.88672 19.5703 1.88672 17.25C1.88672 14.9297 3.77344 13.4414 6.26953 13.4414H22.3359C24.8203 13.4414 26.7188 14.9297 26.7188 17.25C26.7188 19.5703 24.8203 21.0586 22.3359 21.0586ZM6.26953 27.5859H22.3359C26.1562 27.5859 28.6055 25.043 28.6055 21.0703V17.25H26.7188V21.0703C26.7188 23.8828 24.9961 25.6992 22.3359 25.6992H6.26953C3.60938 25.6992 1.88672 23.8828 1.88672 21.0703V17.25H0V21.0703C0 25.043 2.44922 27.5859 6.26953 27.5859Z"
                      fill="black"
                      fill-opacity="0.85"
                    />
                    <path
                      d="M16.0665 14.9062L19.2071 11.3789C20.6485 9.79688 19.6524 7.33594 17.4259 7.33594H16.711V2.40234C16.711 1.06641 15.6446 0 14.3087 0C12.9728 0 11.9063 1.06641 11.9063 2.40234V7.33594H11.1681C9.00006 7.33594 7.93365 9.76172 9.38678 11.3672L12.5274 14.9062C13.5118 16.0078 15.0704 16.0078 16.0665 14.9062Z"
                      fill="white"
                    />
                    <path
                      d="M15.1758 14.0977L18.3164 10.5469C19.043 9.73828 18.5977 8.54297 17.4258 8.54297H15.5039V2.40234C15.5039 1.73438 14.9766 1.20703 14.3086 1.20703C13.6406 1.20703 13.1133 1.73438 13.1133 2.40234V8.54297H11.168C10.043 8.54297 9.53907 9.70312 10.2773 10.5469L13.418 14.0977C13.9219 14.6719 14.6602 14.6836 15.1758 14.0977Z"
                      fill="black"
                      fill-opacity="0.85"
                    />
                  </g>
                  <defs>
                    <clipPath id="clip0_201_88499">
                      <rect width="28.6055" height="30.668" fill="white" />
                    </clipPath>
                  </defs>
                </svg>
              </button>
            </div>
          </div>

          <div class="settings-content">
            <div id="icon-list-container"></div>
          </div>
        </div>

        <div id="clock-settings-screen" class="screen">
          <div class="settings-header">
            <button id="clock-settings-back-button" class="header-icon-button">
              <svg viewBox="0 0 24 24">
                <path
                  d="M15 18l-6-6 6-6"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </button>
            <h1>更换时钟</h1>
          </div>

          <div class="settings-content" style="padding-top: 90px">
            <div class="form-group">
              <label for="clock-color-input"
                >时钟颜色 (输入颜色代码或点右侧色块)</label
              >
              <div
                style="
                  display: flex;
                  align-items: center;
                  width: 93%;
                  gap: 10px;
                "
              >
                <input
                  type="text"
                  id="clock-color-input"
                  class="form-input"
                  placeholder="#000000"
                />
                <input
                  type="color"
                  id="clock-color-picker"
                  style="
                    height: 40px;
                    width: 50px;
                    border-radius: 8px;
                    border: 1px solid #d1d1d6;
                    cursor: pointer;
                  "
                />
              </div>
            </div>
            <div class="form-group">
              <label
                style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                "
              >
                <span>启用高斯模糊背景</span>
                <label class="switch">
                  <input type="checkbox" id="clock-blur-toggle" />
                  <span class="slider round"></span>
                </label>
              </label>
            </div>
          </div>
        </div>

        <div id="transfer-modal" class="modal-overlay" style="display: none">
          <div class="modal-content">
            <div class="modal-header">
              <h2>发起转账</h2>
              <button id="transfer-modal-close-btn" class="modal-close-button">
                &times;
              </button>
            </div>
            <div class="modal-body" style="gap: 15px; padding: 15px 0">
              <div class="form-group">
                <label for="transfer-amount-input">转账金额 (¥)</label>
                <input
                  type="number"
                  id="transfer-amount-input"
                  class="form-input"
                  placeholder="0.00"
                />
              </div>
              <div class="form-group">
                <label for="transfer-remark-input">备注</label>
                <input
                  type="text"
                  id="transfer-remark-input"
                  class="form-input"
                  placeholder="最多20个字"
                />
              </div>
            </div>
            <div class="modal-footer" style="align-items: center">
              <button id="confirm-transfer-btn" class="save-button">
                确认转账
              </button>
            </div>
          </div>
        </div>

        <div id="search-modal" class="modal-overlay" style="display: none">
          <div class="modal-content large">
            <div class="modal-header">
              <h2>搜索聊天记录</h2>
              <button id="search-modal-close-btn" class="modal-close-button">
                &times;
              </button>
            </div>
            <div class="modal-body" style="padding: 15px">
              <input
                type="search"
                id="search-input"
                class="form-input"
                placeholder="输入关键词..."
                style="width: 100%; box-sizing: border-box; margin-bottom: 15px"
              />
              <div id="search-results-container"></div>
            </div>
          </div>
        </div>
        <div id="invite-modal" class="modal-overlay" style="display: none">
          <div class="modal-content">
            <div class="modal-header">
              <h2>一起听</h2>
              <button id="invite-modal-close-btn" class="modal-close-button">
                &times;
              </button>
            </div>
            <div class="modal-body" id="invite-contact-list-container"></div>
          </div>
        </div>

        <div
          id="shopper-select-modal"
          class="modal-overlay"
          style="display: none"
        >
          <div class="modal-content">
            <div class="modal-header">
              <h2>选择身份</h2>
              <button id="shopper-modal-close-btn" class="modal-close-button">
                &times;
              </button>
            </div>
            <div class="modal-body" id="shopper-list-container"></div>
          </div>
        </div>

        <div id="add-emoji-modal" class="modal-overlay" style="display: none">
          <div class="modal-content">
            <div class="modal-header">
              <h2>批量添加表情</h2>
              <button id="emoji-modal-close-btn" class="modal-close-button">
                &times;
              </button>
            </div>
            <div class="modal-body">
              <p style="font-size: 13px; color: #555; margin-top: 0">
                请输入一个或多个图片URL，用英文逗号 (,)
                分隔。格式如下：[备注1:url1],[备注2:url2]，注意冒号是英文冒号
              </p>
              <textarea
                id="emoji-urls-textarea"
                class="form-textarea"
                placeholder="示例：[好饿:https://i.postimg.cc/8zyrPYVy.png],[咋啦:https://i.postimg.cc/7Y5fdyLZ/47ee5e40ea3.jpg]"
                style="height: 150px"
              ></textarea>
            </div>
            <div class="modal-footer">
              <button id="save-emoji-btn" class="save-button">确认添加</button>
            </div>
          </div>
        </div>

        <div id="shop-screen" class="screen">
          <div class="settings-header">
            <button id="shop-back-button" class="header-icon-button">
              <svg viewBox="0 0 24 24">
                <path
                  d="M15 18l-6-6 6-6"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </button>
            <h1 id="shop-title" style="color: #007aff !important">7 SHOP</h1>
            <div class="header-actions">
              <button
                id="shopper-avatar-button"
                class="header-icon-button"
                style="overflow: hidden; padding: 0"
              >
                <img
                  id="shopper-avatar-img"
                  src=""
                  style="width: 100%; height: 100%; object-fit: cover"
                />
              </button>
            </div>
          </div>

          <div id="shop-main-content">
            <div id="shopping-content-panel" class="shop-content-panel active">
              <div
                id="shopping-content-panel"
                class="shop-content-panel active"
              >
                <div class="category-tabs">
                  <button class="category-tab active" data-category="takeout">
                    外卖
                  </button>
                  <button class="category-tab" data-category="milktea">
                    奶茶
                  </button>
                  <button class="category-tab" data-category="electronics">
                    电子设备
                  </button>
                  <button class="category-tab" data-category="brands">
                    贵
                  </button>
                  <button class="category-tab" data-category="daily">
                    日常用品
                  </button>
                  <button class="category-tab" data-category="sports">
                    运动户外
                  </button>
                  <button class="category-tab" data-category="beautyCare">
                    美妆个护
                  </button>
                  <button class="category-tab" data-category="foodSnacks">
                    食品零食
                  </button>
                  <button class="category-tab" data-category="gifts">
                    礼物专区
                  </button>
                </div>

                <div id="product-grid" class="product-grid-shop"></div>
              </div>
            </div>

            <div id="my-account-content-panel" class="shop-content-panel">
              <div class="my-account-list">
                <div class="my-account-item" id="my-orders-button">
                  <span>我的订单</span>
                  <svg
                    class="chevron-icon"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M9 18L15 12L9 6"
                      stroke="#C7C7CC"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </div>
                <div class="my-account-item" id="my-cart-button">
                  <span>我的购物车</span>
                  <svg
                    class="chevron-icon"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M9 18L15 12L9 6"
                      stroke="#C7C7CC"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </div>
              </div>
            </div>
          </div>

          <div class="shop-bottom-bar">
            <div class="glass-segment-control" id="shop-segment-control">
              <button class="segment-btn active" data-target="shopping">
                购物
              </button>
              <button class="segment-btn" data-target="my">我的</button>
              <div class="segment-indicator"></div>
            </div>
          </div>
        </div>

        <!-- ▼▼▼ START: 在这里粘贴新的摸鱼App HTML代码 ▼▼▼ -->

        <div id="slacking-off-screen" class="screen">
          <!-- 1. 顶部栏 -->
          <div class="settings-header">
            <button id="slacking-off-back-button" class="header-icon-button">
              <svg viewBox="0 0 24 24">
                <path
                  d="M15 18l-6-6 6-6"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </button>
            <h1 id="slacking-off-title">游戏</h1>
          </div>

          <!-- 2. 中间内容区域 -->
          <div id="slacking-off-main-content">
            <!-- 游戏面板 -->
            <div
              id="games-content-panel"
              class="slacking-off-content-panel active"
            >
              <div
                id="games-content-panel"
                class="slacking-off-content-panel active"
              >
                <div id="games-grid"></div>
              </div>
              <!-- 这里将来放游戏内容 -->
            </div>

            <!-- 储蓄面板 -->
            <div id="savings-content-panel" class="slacking-off-content-panel">
              <div class="savings-card">
                <button
                  id="apply-unlock-btn"
                  class="apply-unlock-button"
                  style="display: none"
                >
                  申请解除
                </button>
                <h2 class="card-title">当前储蓄</h2>
                <div id="balance-display" class="card-balance">¥0.00</div>
              </div>
              <div id="transaction-history-card" class="details-card">
                <span>收支明细</span>
                <svg
                  class="chevron-icon"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M9 18L15 12L9 6"
                    stroke="#C7C7CC"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </svg>
              </div>
            </div>
          </div>

          <!-- 3. 底部标签栏 -->
          <div class="game-bottom-bar">
            <div class="glass-segment-control" id="game-segment-control">
              <button class="segment-btn active" data-target="games">
                游戏
              </button>
              <button class="segment-btn" data-target="savings">储蓄</button>
              <div class="segment-indicator"></div>
            </div>
          </div>
        </div>

        <div id="transactions-screen" class="screen">
          <div class="settings-header">
            <button id="transactions-back-button" class="header-icon-button">
              <svg viewBox="0 0 24 24">
                <path
                  d="M15 18l-6-6 6-6"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </button>
            <h1>收支明细</h1>
          </div>
          <div
            id="transactions-list-container"
            class="transactions-page-content"
          ></div>
        </div>

        <div
          id="number-guess-modal"
          class="modal-overlay"
          style="display: none; opacity: 0"
        >
          <div class="modal-content" style="transform: scale(0.95)">
            <div class="modal-header">
              <h2>数字大师</h2>
            </div>
            <div class="modal-body" style="text-align: center">
              <p style="margin: 0 0 20px 0; color: #555">
                从 1, 2, 3 中选择一个数字
              </p>
              <div class="game-choices">
                <button class="game-choice-btn" data-choice="1">1</button>
                <button class="game-choice-btn" data-choice="2">2</button>
                <button class="game-choice-btn" data-choice="3">3</button>
              </div>
            </div>
          </div>
        </div>

        <div
          id="coin-flip-modal"
          class="modal-overlay"
          style="display: none; opacity: 0"
        >
          <div class="modal-content" style="transform: scale(0.95)">
            <div class="modal-header">
              <h2>幸运硬币</h2>
            </div>
            <div class="modal-body" style="text-align: center">
              <p style="margin: 0 0 20px 0; color: #555">
                猜猜硬币是正面还是反面？
              </p>
              <div class="game-choices">
                <button class="game-choice-btn" data-choice="heads">
                  正面
                </button>
                <button class="game-choice-btn" data-choice="tails">
                  反面
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- ▼▼▼ START: 【新增】买彩票游戏弹窗 ▼▼▼ -->
        <div id="lottery-modal" class="modal-overlay" style="display: none">
          <div class="modal-content">
            <div class="modal-header">
              <h2>买彩票</h2>
              <button class="modal-close-button">&times;</button>
            </div>
            <div class="modal-body" style="text-align: center">
              <p style="margin: 0 0 20px 0; color: #555">
                请选择您要购买的彩票金额：
              </p>
              <div
                class="game-choices"
                style="flex-wrap: wrap; justify-content: center"
              >
                <button class="game-choice-btn" data-cost="10">¥10</button>
                <button class="game-choice-btn" data-cost="20">¥20</button>
                <button class="game-choice-btn" data-cost="50">¥50</button>
                <button class="game-choice-btn" data-cost="100">¥100</button>
                <button class="game-choice-btn" data-cost="200">¥200</button>
              </div>
            </div>
          </div>
        </div>
        <!-- ▲▲▲ END: 【新增】买彩票游戏弹窗 ▲▲▲ -->

        <div
          id="blacklist-modal"
          class="modal-overlay"
          style="display: none; opacity: 0"
        >
          <div class="modal-content" style="transform: scale(0.95)">
            <div class="modal-header">
              <h2>系统通知</h2>
            </div>
            <div
              class="modal-body"
              style="text-align: center; padding: 20px 15px"
            >
              <p style="margin: 0 0 25px 0; color: #333; line-height: 1.5">
                您因欠款已被七七银行拉黑，请联系七七总裁申请解除限制。
              </p>
              <button id="go-to-savings-btn" class="save-button">
                去储蓄页面申请解除
              </button>
            </div>
          </div>
        </div>

        <div
          id="unlock-modal"
          class="modal-overlay"
          style="display: none; opacity: 0"
        >
          <div class="modal-content" style="transform: scale(0.95)">
            <div class="modal-header">
              <h2>申请解除限制</h2>
              <button id="unlock-modal-close-btn" class="modal-close-button">
                &times;
              </button>
            </div>
            <div class="modal-body" style="gap: 15px; padding: 15px 0">
              <div class="form-group">
                <label for="unlock-code-input">请输入解锁码</label>
                <input
                  type="text"
                  id="unlock-code-input"
                  class="form-input"
                  placeholder="输入七七总裁给的解锁码"
                />
              </div>
            </div>
            <div class="modal-footer">
              <button id="confirm-unlock-btn" class="save-button">
                确认解锁
              </button>
            </div>
          </div>
        </div>

        <div id="gacha-post-modal" class="modal-overlay" style="display: none">
          <div class="modal-content">
            <div class="modal-header">
              <h2>创建新分享</h2>
              <button
                id="gacha-post-modal-close-btn"
                class="modal-close-button"
              >
                &times;
              </button>
            </div>
            <div class="modal-body">
              <textarea
                id="gacha-post-text-input"
                class="form-textarea"
                placeholder="分享你的想法..."
                style="height: 120px"
              ></textarea>
              <input
                type="text"
                id="gacha-post-image-desc-input"
                class="form-input"
                placeholder="[可选] 为图片添加文字描述..."
              />
            </div>
            <div class="modal-footer">
              <button id="gacha-confirm-post-btn" class="save-button">
                分享
              </button>
            </div>
          </div>
        </div>

        <div
          id="visibility-settings-modal"
          class="modal-overlay"
          style="display: none"
        >
          <div class="modal-content">
            <div class="modal-header">
              <h2>设置帖子可见范围</h2>
              <button
                id="visibility-modal-close-btn"
                class="modal-close-button"
              >
                &times;
              </button>
            </div>
            <div
              class="modal-body"
              id="worldbook-visibility-list"
              style="max-height: 300px; overflow-y: auto; padding: 15px"
            ></div>
            <div class="modal-footer">
              <button id="save-visibility-btn" class="save-button">保存</button>
            </div>
          </div>
        </div>

        <div id="summon-ai-modal" class="modal-overlay" style="display: none">
          <div class="modal-content">
            <div class="modal-header">
              <h2>选择要召唤的AI</h2>
              <button id="summon-ai-modal-close-btn" class="modal-close-button">
                &times;
              </button>
            </div>
            <div
              class="modal-body"
              id="summon-ai-list-container"
              style="max-height: 400px; overflow-y: auto; padding: 10px 0"
            ></div>
          </div>
        </div>

        <div id="cart-screen" class="screen">
          <div class="settings-header">
            <button id="cart-back-button" class="header-icon-button">
              <svg viewBox="0 0 24 24">
                <path
                  d="M15 18l-6-6 6-6"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </button>
            <h1>我的购物车</h1>
          </div>
          <div id="cart-content" class="cart-page-content">
            <div id="cart-items-container"></div>
            <div class="cart-footer">
              <button id="select-recipient-btn" class="select-recipient-btn">
                收货人: <span id="recipient-name-display">未选择</span>
              </button>
              <button id="confirm-purchase-btn" class="save-button">
                购买
              </button>
            </div>
          </div>
        </div>

        <div id="orders-screen" class="screen">
          <div class="settings-header">
            <button id="orders-back-button" class="header-icon-button">
              <svg viewBox="0 0 24 24">
                <path
                  d="M15 18l-6-6 6-6"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </button>
            <h1>我的订单</h1>
          </div>
          <div id="orders-list-container" class="orders-page-content"></div>
        </div>

        <div
          id="recipient-select-modal"
          class="modal-overlay"
          style="display: none"
        >
          <div class="modal-content">
            <div class="modal-header">
              <h2>选择收货人</h2>
              <button id="recipient-modal-close-btn" class="modal-close-button">
                &times;
              </button>
            </div>
            <div class="modal-body" id="recipient-list-container"></div>
          </div>
        </div>

        <div id="gacha-screen" class="screen">
          <!-- 1. 顶部栏 -->
          <div class="settings-header">
            <button id="gacha-back-button" class="header-icon-button">
              <svg viewBox="0 0 24 24">
                <path
                  d="M15 18l-6-6 6-6"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </button>
            <h1 id="gacha-title">SHARE</h1>
            <div class="header-actions">
              <button
                id="gacha-avatar-button"
                class="header-icon-button"
                style="overflow: hidden; padding: 0"
              >
                <img
                  id="gacha-avatar-img"
                  src=""
                  style="width: 100%; height: 100%; object-fit: cover"
                />
              </button>
            </div>
          </div>

          <!-- 2. 中间内容区域 -->
          <div id="gacha-main-content">
            <!-- “SHARE” 面板 -->
            <div id="share-content-panel" class="gacha-content-panel active">
              <div id="gacha-posts-container"></div>
            </div>

            <!-- “FORUM” 面板 -->
            <div id="forum-content-panel" class="gacha-content-panel">
              <!-- 在这里放入 FORUM 页面的具体内容 -->
              <p style="text-align: center; padding-top: 100px">
                停止使用，请转移到哇呜
              </p>
            </div>
          </div>

          <!-- 3. 底部标签栏 -->
          <div class="gacha-bottom-bar">
            <div class="glass-segment-control" id="gacha-segment-control">
              <button class="segment-btn active" data-target="share">
                SHARE
              </button>
              <button class="segment-btn" data-target="forum">FORUM</button>
              <div class="segment-indicator"></div>
            </div>
          </div>
          <button id="gacha-new-post-btn" class="floating-action-button">
            <svg
              width="20"
              height="20"
              viewBox="0 0 20 20"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M4.5174 2.70926C2.88281 2.70926 1.55772 4.03435 1.55772 5.66893V15.0153C1.55772 16.6498 2.88281 17.9749 4.5174 17.9749H13.8637C15.4983 17.9749 16.8234 16.6498 16.8234 15.0153V10.3421C16.8234 9.91195 17.1721 9.56324 17.6023 9.56324C18.0324 9.56324 18.3811 9.91195 18.3811 10.3421V15.0153C18.3811 17.5102 16.3586 19.5327 13.8637 19.5327H4.5174C2.02251 19.5327 0 17.5102 0 15.0153V5.66893C0 3.17404 2.02251 1.15154 4.5174 1.15154H9.81365C10.2438 1.15154 10.5925 1.50024 10.5925 1.9304C10.5925 2.36055 10.2438 2.70926 9.81365 2.70926H4.5174Z"
                fill="white"
              />
              <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M5.02381 11.5474C5.0255 11.3431 5.10742 11.1476 5.2519 11.0031L15.484 0.771034C15.9098 0.345203 16.6002 0.345204 17.026 0.771034L19.229 2.97399C19.6548 3.39982 19.6548 4.09022 19.229 4.51605L8.99692 14.7481C8.85243 14.8926 8.65695 14.9745 8.45262 14.9762L5.78705 14.9982C5.57825 15 5.37751 14.9178 5.22987 14.7701C5.08223 14.6225 5.00005 14.4218 5.00177 14.213L5.02381 11.5474ZM6.57884 11.8791L6.56599 13.434L8.12091 13.4212L17.7971 3.74502L16.255 2.20295L6.57884 11.8791Z"
                fill="white"
              />
            </svg>
          </button>
        </div>

        <div id="api-library-modal" class="modal-overlay" style="display: none">
          <div class="modal-content">
            <div class="modal-header">
              <h2>我的 API 库</h2>
              <button
                id="api-library-modal-close-btn"
                class="modal-close-button"
              >
                &times;
              </button>
            </div>
            <div
              class="modal-body"
              id="api-library-list-container"
              style="max-height: 400px; overflow-y: auto; padding: 15px 0"
            ></div>
            <div class="modal-footer" style="padding-top: 15px">
              <button
                id="api-library-delete-selected-btn"
                class="danger-button"
                style="width: 100%; padding: 8px"
              >
                删除所选
              </button>
            </div>
          </div>
        </div>

        <div id="worldbook-groups-screen" class="screen">
          <div class="settings-header">
            <button
              id="worldbook-groups-back-button"
              class="header-icon-button"
            >
              <svg viewBox="0 0 24 24">
                <path
                  d="M15 18l-6-6 6-6"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </button>
            <h1>分组</h1>

            <div id="group-header-actions-normal" class="header-actions">
              <button id="add-worldbook-group-btn" class="header-icon-button">
                <svg
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <line x1="12" y1="5" x2="12" y2="19"></line>
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
              </button>

              <button id="groups-multiselect-btn" class="header-icon-button">
                <svg
                  class="icon-select"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M8 6h13M8 12h13M8 18h13M3 6h.01M3 12h.01M3 18h.01" />
                </svg>
              </button>
            </div>

            <div
              id="group-header-actions-select"
              class="header-actions"
              style="display: none"
            >
              <button
                id="delete-groups-btn"
                class="header-icon-button"
                style="color: #ff3b30"
              >
                <svg viewBox="0 0 24 24">
                  <polyline points="3 6 5 6 21 6" />
                  <path
                    d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"
                  />
                </svg>
              </button>

              <button id="groups-cancel-select-btn" class="header-icon-button">
                <svg
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M18 6L6 18M6 6l12 12" />
                </svg>
              </button>
            </div>
          </div>
          <div class="music-content" style="padding-top: 0">
            <div class="scrollable-list-container">
              <div
                id="worldbook-groups-list"
                class="contact-list"
                style="margin-top: 0"
              ></div>
            </div>
          </div>
        </div>

        <div id="worldbook-group-detail-screen" class="screen">
          <div class="settings-header">
            <button id="group-detail-back-button" class="header-icon-button">
              <svg viewBox="0 0 24 24">
                <path
                  d="M15 18l-6-6 6-6"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </button>

            <h1 id="group-detail-title">分组名称</h1>

            <div id="group-detail-header-actions-normal" class="header-actions">
              <button id="add-book-in-group-btn" class="header-icon-button">
                <svg viewBox="0 0 24 24">
                  <line
                    x1="12"
                    y1="5"
                    x2="12"
                    y2="19"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                  <line
                    x1="5"
                    y1="12"
                    x2="19"
                    y2="12"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </svg>
              </button>
              <button
                id="group-detail-multiselect-btn"
                class="header-icon-button"
              >
                <svg viewBox="0 0 24 24">
                  <path
                    d="M8 6h13M8 12h13M8 18h13M3 6h.01M3 12h.01M3 18h.01"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </svg>
              </button>
            </div>

            <div
              id="group-detail-header-actions-select"
              class="header-actions"
              style="display: none"
            >
              <button id="move-books-in-group-btn" class="header-icon-button">
                <svg
                  class="icon-filled"
                  width="28"
                  height="28"
                  viewBox="0 0 28 28"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <g clip-path="url(#clip0_201_75713)">
                    <path
                      d="M10.6953 19.332H17.9375C19.5781 19.332 20.4453 18.3711 20.4453 16.8242V14.8203H24.8867C25.8594 14.8203 26.6328 14.2461 26.6328 13.3438C26.6328 12.793 26.3516 12.3594 25.8242 11.9023L15.7695 3.03125C15.2773 2.60938 14.8438 2.32812 14.3164 2.32812C13.7891 2.32812 13.3555 2.60938 12.8633 3.03125L2.80859 11.9141C2.25781 12.3945 2 12.793 2 13.3438C2 14.2461 2.77344 14.8203 3.74609 14.8203H8.1875V16.8242C8.1875 18.3711 9.05469 19.332 10.6953 19.332ZM10.8828 17.5625C10.4492 17.5625 10.1445 17.2695 10.1445 16.8242V13.4492C10.1445 13.168 10.0391 13.0508 9.74609 13.0508H4.64844C4.56641 13.0508 4.51953 13.0156 4.51953 12.957C4.51953 12.9102 4.54297 12.8633 4.58984 12.8164L14.0703 4.58984C14.1641 4.49609 14.2344 4.46094 14.3164 4.46094C14.3984 4.46094 14.4688 4.49609 14.5625 4.58984L24.043 12.8164C24.0898 12.8633 24.1133 12.9102 24.1133 12.957C24.1133 13.0156 24.0664 13.0508 23.9844 13.0508H18.8867C18.6055 13.0508 18.4883 13.168 18.4883 13.4492V16.8242C18.4883 17.2578 18.1719 17.5625 17.75 17.5625H10.8828ZM10.1914 26.8555H18.3359C19.6953 26.8555 20.4688 26.1055 20.4688 24.7461V23.0703C20.4688 21.6992 19.6953 20.9258 18.3359 20.9258H10.1914C8.84375 20.9258 8.07031 21.7109 8.07031 23.0703V24.7461C8.07031 26.0938 8.84375 26.8555 10.1914 26.8555ZM10.4609 25.2031C10.0508 25.2031 9.83984 24.9922 9.83984 24.582V23.2344C9.83984 22.8242 10.0508 22.5781 10.4609 22.5781H18.0664C18.4766 22.5781 18.6992 22.8242 18.6992 23.2344V24.582C18.6992 24.9922 18.4766 25.2031 18.0664 25.2031H10.4609Z"
                      fill="black"
                      fill-opacity="0.85"
                    />
                  </g>
                  <defs>
                    <clipPath id="clip0_201_75713">
                      <rect
                        width="24.6328"
                        height="24.8555"
                        fill="white"
                        transform="translate(2 2)"
                      />
                    </clipPath>
                  </defs>
                </svg>
              </button>
              <button
                id="delete-books-in-group-btn"
                class="header-icon-button"
                style="color: #ff3b30"
              >
                <svg viewBox="0 0 24 24">
                  <polyline points="3 6 5 6 21 6" />
                  <path
                    d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"
                  />
                </svg>
              </button>
              <button
                id="group-detail-cancel-select-btn"
                class="header-icon-button"
              >
                <svg viewBox="0 0 24 24">
                  <path
                    d="M18 6L6 18M6 6l12 12"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </svg>
              </button>
            </div>
          </div>

          <div class="music-content" style="padding-top: 0">
            <div class="scrollable-list-container">
              <div
                id="books-in-group-list"
                class="contact-list"
                style="margin-top: 0"
              ></div>
            </div>
          </div>
        </div>

        <div
          id="move-to-group-modal"
          class="modal-overlay"
          style="display: none"
        >
          <div class="modal-content">
            <div class="modal-header">
              <h2>移动到分组</h2>
              <button
                id="move-to-group-modal-close-btn"
                class="modal-close-button"
              >
                &times;
              </button>
            </div>
            <div
              class="modal-body"
              id="group-selection-list"
              style="max-height: 400px; overflow-y: auto; padding: 10px 0"
            ></div>
          </div>
        </div>
        <div id="preset-management-screen" class="screen">
          <div class="settings-header">
            <button id="preset-back-button" class="header-icon-button">
              <svg viewBox="0 0 24 24">
                <path
                  d="M15 18l-6-6 6-6"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </button>
            <h1>图标包预设</h1>
            <div class="header-actions">
              <button id="import-preset-button" class="header-button">
                <svg
                  class="icon-filled"
                  width="28"
                  height="31"
                  viewBox="0 0 28 31"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <g clip-path="url(#clip0_201_72165)">
                    <path
                      d="M3.67969 27.7148H23.9531C26.4141 27.7148 27.6328 26.4961 27.6328 24.082V17.1445C27.6328 16.0781 27.4922 15.5508 26.9648 14.918L22.9219 9.90234C21.5508 8.21484 20.707 7.23047 18.6328 7.23047H9.01172C6.92578 7.23047 6.09375 8.21484 4.72266 9.90234L0.667969 14.918C0.152344 15.5508 0 16.0781 0 17.1445V24.082C0 26.4961 1.23047 27.7148 3.67969 27.7148ZM2.40234 15.5977L6.55078 10.3594C7.125 9.63281 8.01562 8.88281 8.87109 8.88281H18.7617C19.6172 8.88281 20.5078 9.63281 21.082 10.3594L25.2422 15.5977C25.7109 16.1953 25.5469 16.4297 24.9023 16.4297H17.4375C16.8281 16.4297 16.5469 16.8984 16.5469 17.3789V17.4258C16.5469 18.7852 15.4805 20.2148 13.8164 20.2148C12.1641 20.2148 11.0977 18.7852 11.0977 17.4258V17.3789C11.0977 16.8984 10.8047 16.4297 10.1953 16.4297H2.75391C2.07422 16.4297 1.94531 16.1602 2.40234 15.5977ZM3.70312 25.8281C2.53125 25.8281 1.88672 25.1953 1.88672 23.9766V18.1523H9.31641C9.59766 20.3438 11.4375 21.9609 13.8164 21.9609C16.1953 21.9609 18.0352 20.332 18.3164 18.1523H25.7461V23.9766C25.7461 25.1953 25.0898 25.8281 23.9297 25.8281H3.70312Z"
                      fill="black"
                      fill-opacity="0.85"
                    />
                    <path
                      d="M13.8164 0C12.3281 0 11.0859 1.21875 11.0859 2.69531V15.3867C11.0859 16.8633 12.3281 18.0938 13.8164 18.0938C15.3047 18.0938 16.5469 16.8633 16.5469 15.3867V2.69531C16.5469 1.21875 15.3047 0 13.8164 0Z"
                      fill="white"
                    />
                    <path
                      d="M13.8164 16.2891C14.0625 16.2891 14.2617 16.2188 14.4961 15.9844L18.457 12.1641C18.6328 11.9883 18.7266 11.7891 18.7266 11.543C18.7266 11.0625 18.3633 10.7227 17.8828 10.7227C17.6484 10.7227 17.4023 10.8164 17.2383 11.0039L15.4688 12.8906L14.6719 13.7227L14.7539 11.9648V2.69531C14.7539 2.20312 14.3203 1.79297 13.8164 1.79297C13.3125 1.79297 12.8906 2.20312 12.8906 2.69531V11.9648L12.9609 13.7227L12.1641 12.8906L10.3945 11.0039C10.2188 10.8164 9.97266 10.7227 9.73828 10.7227C9.25781 10.7227 8.90625 11.0625 8.90625 11.543C8.90625 11.7891 9 11.9883 9.17578 12.1641L13.1367 15.9844C13.3711 16.2188 13.582 16.2891 13.8164 16.2891Z"
                      fill="black"
                      fill-opacity="0.85"
                    />
                  </g>
                  <defs>
                    <clipPath id="clip0_201_72165">
                      <rect width="27.6328" height="30.7148" fill="white" />
                    </clipPath>
                  </defs>
                </svg>
              </button>
            </div>
          </div>
          <div class="settings-content">
            <div
              id="preset-list-container"
              style="width: 100%; padding: 0 15px; box-sizing: border-box"
            ></div>
          </div>
        </div>

        <div id="motto-settings-screen" class="screen">
          <div class="settings-header">
            <button id="motto-settings-back-button" class="header-icon-button">
              <svg viewBox="0 0 24 24">
                <path
                  d="M15 18l-6-6 6-6"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </button>
            <h1>签名美化</h1>
          </div>
          <div class="settings-content">
            <div class="form-group" style="width: 90%">
              <label for="motto-color-input">颜色</label>
              <div style="display: flex; align-items: center; gap: 10px">
                <input
                  type="text"
                  id="motto-color-input"
                  class="form-input"
                  placeholder="#8a8a8e"
                />
                <input
                  type="color"
                  id="motto-color-picker"
                  style="
                    height: 40px;
                    width: 50px;
                    border-radius: 8px;
                    border: 1px solid #d1d1d6;
                    cursor: pointer;
                  "
                />
              </div>
              <label
                style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-top: 25px;
                "
              >
                <span>高斯模糊背景</span>
                <label class="switch">
                  <input type="checkbox" id="motto-blur-toggle" />
                  <span class="slider round"></span>
                </label>
              </label>
            </div>
          </div>
        </div>

        <div id="appname-settings-screen" class="screen">
          <div class="settings-header">
            <button
              id="appname-settings-back-button"
              class="header-icon-button"
            >
              <svg viewBox="0 0 24 24">
                <path
                  d="M15 18l-6-6 6-6"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </button>
            <h1>图标名称美化</h1>
          </div>
          <div class="settings-content">
            <div class="form-group" style="width: 90%">
              <label for="app-name-color-input">颜色</label>
              <div style="display: flex; align-items: center; gap: 10px">
                <input
                  type="text"
                  id="app-name-color-input"
                  class="form-input"
                  placeholder="#111111"
                />
                <input
                  type="color"
                  id="app-name-color-picker"
                  style="
                    height: 40px;
                    width: 50px;
                    border-radius: 8px;
                    border: 1px solid #d1d1d6;
                    cursor: pointer;
                  "
                />
              </div>
              <label
                style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-top: 25px;
                "
              >
                <span>高斯模糊背景</span>
                <label class="switch">
                  <input type="checkbox" id="app-name-blur-toggle" />
                  <span class="slider round"></span>
                </label>
              </label>
            </div>
          </div>
        </div>

        <div id="font-url-settings-screen" class="screen">
          <div class="settings-header">
            <button id="font-url-back-button" class="header-icon-button">
              <svg viewBox="0 0 24 24">
                <path
                  d="M15 18l-6-6 6-6"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </button>
            <h1>字体URL</h1>
            <div class="header-actions">
              <button id="add-font-url-btn" class="header-button">
                <svg
                  width="28"
                  height="31"
                  viewBox="0 0 28 31"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <g clip-path="url(#clip0_201_72165)">
                    <path
                      d="M3.67969 27.7148H23.9531C26.4141 27.7148 27.6328 26.4961 27.6328 24.082V17.1445C27.6328 16.0781 27.4922 15.5508 26.9648 14.918L22.9219 9.90234C21.5508 8.21484 20.707 7.23047 18.6328 7.23047H9.01172C6.92578 7.23047 6.09375 8.21484 4.72266 9.90234L0.667969 14.918C0.152344 15.5508 0 16.0781 0 17.1445V24.082C0 26.4961 1.23047 27.7148 3.67969 27.7148ZM2.40234 15.5977L6.55078 10.3594C7.125 9.63281 8.01562 8.88281 8.87109 8.88281H18.7617C19.6172 8.88281 20.5078 9.63281 21.082 10.3594L25.2422 15.5977C25.7109 16.1953 25.5469 16.4297 24.9023 16.4297H17.4375C16.8281 16.4297 16.5469 16.8984 16.5469 17.3789V17.4258C16.5469 18.7852 15.4805 20.2148 13.8164 20.2148C12.1641 20.2148 11.0977 18.7852 11.0977 17.4258V17.3789C11.0977 16.8984 10.8047 16.4297 10.1953 16.4297H2.75391C2.07422 16.4297 1.94531 16.1602 2.40234 15.5977ZM3.70312 25.8281C2.53125 25.8281 1.88672 25.1953 1.88672 23.9766V18.1523H9.31641C9.59766 20.3438 11.4375 21.9609 13.8164 21.9609C16.1953 21.9609 18.0352 20.332 18.3164 18.1523H25.7461V23.9766C25.7461 25.1953 25.0898 25.8281 23.9297 25.8281H3.70312Z"
                      fill="black"
                      fill-opacity="0.85"
                    />
                    <path
                      d="M13.8164 0C12.3281 0 11.0859 1.21875 11.0859 2.69531V15.3867C11.0859 16.8633 12.3281 18.0938 13.8164 18.0938C15.3047 18.0938 16.5469 16.8633 16.5469 15.3867V2.69531C16.5469 1.21875 15.3047 0 13.8164 0Z"
                      fill="white"
                    />
                    <path
                      d="M13.8164 16.2891C14.0625 16.2891 14.2617 16.2188 14.4961 15.9844L18.457 12.1641C18.6328 11.9883 18.7266 11.7891 18.7266 11.543C18.7266 11.0625 18.3633 10.7227 17.8828 10.7227C17.6484 10.7227 17.4023 10.8164 17.2383 11.0039L15.4688 12.8906L14.6719 13.7227L14.7539 11.9648V2.69531C14.7539 2.20312 14.3203 1.79297 13.8164 1.79297C13.3125 1.79297 12.8906 2.20312 12.8906 2.69531V11.9648L12.9609 13.7227L12.1641 12.8906L10.3945 11.0039C10.2188 10.8164 9.97266 10.7227 9.73828 10.7227C9.25781 10.7227 8.90625 11.0625 8.90625 11.543C8.90625 11.7891 9 11.9883 9.17578 12.1641L13.1367 15.9844C13.3711 16.2188 13.582 16.2891 13.8164 16.2891Z"
                      fill="black"
                      fill-opacity="0.85"
                    />
                  </g>
                  <defs>
                    <clipPath id="clip0_201_72165">
                      <rect width="27.6328" height="30.7148" fill="white" />
                    </clipPath>
                  </defs>
                </svg>
              </button>
            </div>
          </div>

          <div class="settings-content">
            <div id="font-url-list-container" style="width: 100%"></div>
          </div>
        </div>

        <div
          id="image-preview-modal"
          class="modal-overlay"
          style="display: none"
        >
          <span id="image-preview-close-btn" class="modal-close-button"
            >&times;</span
          >
          <img id="preview-image-element" src="" alt="图片预览" />
        </div>

        <div
          id="ai-file-viewer-modal"
          class="modal-overlay"
          style="display: none; z-index: 2000"
        >
          <div
            class="modal-content"
            style="
              height: 80%;
              max-height: 800px;
              display: flex;
              flex-direction: column;
            "
          >
            <div class="modal-header">
              <h2 id="ai-file-viewer-title">文件预览</h2>
              <button id="ai-file-viewer-close-btn" class="modal-close-button">
                &times;
              </button>
            </div>
            <div
              class="modal-body"
              style="
                flex: 1;
                overflow-y: auto;
                padding: 20px;
                background-color: #fff;
              "
            >
              <div
                id="ai-file-viewer-content"
                style="
                  font-family: 'SimSun', 'Songti SC', serif;
                  font-size: 16px;
                  line-height: 1.8;
                  color: #000;
                  white-space: pre-wrap;
                  text-align: justify;
                "
              ></div>
            </div>
            <div class="modal-footer">
              <button
                class="form-button-secondary"
                onclick="document.getElementById('ai-file-viewer-close-btn').click()"
              >
                关闭
              </button>
            </div>
          </div>
        </div>

        <div id="voice-call-screen" class="screen">
          <div id="calling-state" class="call-state-container active">
            <div id="calling-avatar" class="call-avatar"></div>
            <div id="calling-name" class="call-name"></div>
            <div id="calling-status" class="call-status">正在呼叫...</div>
            <button id="cancel-call-button" class="call-hang-up-button">
              <svg
                width="40"
                height="18"
                viewBox="0 0 46 20"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M45.7693 13.3442L45.2549 15.7096C44.7713 17.9271 42.6494 19.3694 40.2974 19.0804L35.6123 18.5035C33.5729 18.2515 31.8676 16.7522 31.3974 14.7981L30.091 9.35493C27.9688 8.41918 25.6157 7.95632 23.0326 7.96448C20.5451 7.95228 18.0805 8.43931 15.7846 9.39675L14.7564 14.4349C14.3654 16.3421 12.744 17.7319 10.7363 17.8792L6.05622 18.2281C3.71963 18.4008 1.52623 16.8598 0.9222 14.6231L0.273957 12.2273C-0.370076 9.84126 0.324847 7.36474 2.1002 5.72975C6.29148 1.8646 13.1542 0.0539878 22.6925 0.290492C32.2453 0.527857 39.2208 2.69193 43.6105 6.78029C45.4581 8.50025 46.2808 10.9968 45.7693 13.3442V13.3442Z"
                  fill="white"
                />
              </svg>
            </button>
          </div>

          <div id="connected-state" class="call-state-container">
            <div class="connected-header">
              <div id="connected-name" class="call-name small"></div>
              <div id="call-timer" class="call-status">00:00</div>
            </div>

            <div id="ai-speech-bubble-container"></div>

            <div class="connected-footer">
              <button
                id="connected-hang-up-button"
                class="call-control-button hang-up"
              >
                <svg
                  width="40"
                  height="18"
                  viewBox="0 0 46 20"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M45.7693 13.3442L45.2549 15.7096C44.7713 17.9271 42.6494 19.3694 40.2974 19.0804L35.6123 18.5035C33.5729 18.2515 31.8676 16.7522 31.3974 14.7981L30.091 9.35493C27.9688 8.41918 25.6157 7.95632 23.0326 7.96448C20.5451 7.95228 18.0805 8.43931 15.7846 9.39675L14.7564 14.4349C14.3654 16.3421 12.744 17.7319 10.7363 17.8792L6.05622 18.2281C3.71963 18.4008 1.52623 16.8598 0.9222 14.6231L0.273957 12.2273C-0.370076 9.84126 0.324847 7.36474 2.1002 5.72975C6.29148 1.8646 13.1542 0.0539878 22.6925 0.290492C32.2453 0.527857 39.2208 2.69193 43.6105 6.78029C45.4581 8.50025 46.2808 10.9968 45.7693 13.3442V13.3442Z"
                    fill="white"
                  />
                </svg>
              </button>

              <button id="user-speak-button" class="call-control-button speak">
                <svg
                  width="40"
                  height="40"
                  viewBox="0 0 40 40"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M19.9995 5C18.3419 5 16.7522 5.65848 15.5801 6.83058C14.408 8.00269 13.7495 9.5924 13.7495 11.25V20C13.7495 21.6576 14.408 23.2473 15.5801 24.4194C16.7522 25.5915 18.3419 26.25 19.9995 26.25C21.6571 26.25 23.2468 25.5915 24.4189 24.4194C25.591 23.2473 26.2495 21.6576 26.2495 20V11.25C26.2495 9.5924 25.591 8.00269 24.4189 6.83058C23.2468 5.65848 21.6571 5 19.9995 5V5ZM9.99951 18.75C10.331 18.75 10.649 18.8817 10.8834 19.1161C11.1178 19.3505 11.2495 19.6685 11.2495 20C11.2495 22.3206 12.1714 24.5462 13.8123 26.1872C15.4533 27.8281 17.6789 28.75 19.9995 28.75C22.3202 28.75 24.5458 27.8281 26.1867 26.1872C27.8276 24.5462 28.7495 22.3206 28.7495 20C28.7495 19.6685 28.8812 19.3505 29.1156 19.1161C29.35 18.8817 29.668 18.75 29.9995 18.75C30.331 18.75 30.649 18.8817 30.8834 19.1161C31.1178 19.3505 31.2495 19.6685 31.2495 20C31.25 22.7676 30.2304 25.4383 28.3855 27.5014C26.5406 29.5644 24 30.875 21.2495 31.1825V33.75C21.2495 34.0815 21.1178 34.3995 20.8834 34.6339C20.649 34.8683 20.331 35 19.9995 35C19.668 35 19.35 34.8683 19.1156 34.6339C18.8812 34.3995 18.7495 34.0815 18.7495 33.75V31.1825C15.999 30.875 13.4584 29.5644 11.6135 27.5014C9.76866 25.4383 8.74898 22.7676 8.74951 20C8.74951 19.6685 8.88121 19.3505 9.11563 19.1161C9.35005 18.8817 9.66799 18.75 9.99951 18.75Z"
                    fill="white"
                  />
                </svg>
              </button>
            </div>
          </div>
        </div>

        <div
          id="voice-call-input-modal"
          class="modal-overlay"
          style="display: none"
        >
          <div class="modal-content">
            <div class="modal-body">
              <textarea
                id="voice-call-textarea"
                class="form-textarea"
                placeholder="输入你想说的话..."
              ></textarea>
            </div>
            <div class="modal-footer">
              <button id="send-call-text-button" class="save-button">
                发送
              </button>
            </div>
          </div>
        </div>

        <!-- 井字棋游戏悬浮窗 -->
        <div
          id="tic-tac-toe-modal"
          class="game-floating-window"
          style="display: none"
        >
          <div class="game-header">
            <span class="game-title">井字棋</span>
            <button id="ttt-close-btn" class="game-close-btn">
              <svg
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </div>
          <div class="game-players">
            <div class="player ai-player">
              <img id="ttt-ai-avatar" class="player-avatar" src="" alt="AI" />
              <div id="ttt-ai-bubble" class="player-bubble">等待开始...</div>
            </div>
            <div class="player user-player">
              <div id="ttt-user-bubble" class="player-bubble">准备好了！</div>
              <img
                id="ttt-user-avatar"
                class="player-avatar"
                src=""
                alt="User"
              />
            </div>
          </div>
          <div id="ttt-status" class="game-status">选择先手开始游戏</div>
          <div id="ttt-board" class="game-board">
            <div class="board-cell" data-index="0"></div>
            <div class="board-cell" data-index="1"></div>
            <div class="board-cell" data-index="2"></div>
            <div class="board-cell" data-index="3"></div>
            <div class="board-cell" data-index="4"></div>
            <div class="board-cell" data-index="5"></div>
            <div class="board-cell" data-index="6"></div>
            <div class="board-cell" data-index="7"></div>
            <div class="board-cell" data-index="8"></div>
          </div>
          <div class="game-controls">
            <div id="ttt-start-panel" class="start-panel">
              <button id="ttt-user-first-btn" class="game-btn">我先手</button>
              <button id="ttt-ai-first-btn" class="game-btn">TA先手</button>
            </div>
            <!-- 井字棋聊天输入框 -->
            <div
              id="ttt-chat-input-container"
              class="game-chat-input-container"
              style="display: none"
            >
              <input
                type="text"
                id="ttt-chat-input"
                class="game-chat-input"
                placeholder="说点什么..."
              />
              <button id="ttt-send-chat-inline-btn" class="game-send-btn">
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <line x1="22" y1="2" x2="11" y2="13"></line>
                  <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                </svg>
              </button>
            </div>
            <button id="ttt-restart-btn" class="game-btn" style="display: none">
              再来一局
            </button>
          </div>
        </div>

        <!-- 井字棋聊天输入弹窗 -->
        <div id="ttt-chat-modal" class="modal-overlay" style="display: none">
          <div class="modal-content">
            <div class="modal-header">
              <h2>说点什么</h2>
              <button id="ttt-chat-modal-close-btn" class="modal-close-button">
                &times;
              </button>
            </div>
            <div class="modal-body">
              <textarea
                id="ttt-chat-textarea"
                class="form-textarea"
                placeholder="输入你想对TA说的话..."
              ></textarea>
            </div>
            <div class="modal-footer">
              <button id="ttt-send-chat-btn" class="save-button">发送</button>
            </div>
          </div>
        </div>

        <div id="summary-list-screen" class="screen">
          <div class="settings-header">
            <button id="summary-list-back-button" class="header-icon-button">
              <svg
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M15 18l-6-6 6-6" />
              </svg>
            </button>
            <h1>通话摘要</h1>
          </div>
          <div class="settings-content" style="padding: 90px 15px 15px 15px">
            <div id="summary-list-container"></div>
          </div>
        </div>

        <div id="summary-detail-screen" class="screen">
          <div class="settings-header">
            <button id="summary-detail-back-button" class="header-icon-button">
              <svg
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M15 18l-6-6 6-6" />
              </svg>
            </button>
            <h1>摘要详情</h1>
          </div>
          <div class="settings-content" style="padding: 100px 20px 20px 20px">
            <div id="summary-detail-container"></div>
          </div>
        </div>

        <div id="incoming-call-screen" class="screen">
          <div class="call-state-container active" style="padding-top: 100px">
            <div id="incoming-call-avatar" class="call-avatar"></div>
            <div id="incoming-call-name" class="call-name"></div>
            <div class="call-status">正在呼叫您...</div>

            <div id="incoming-call-reason" class="call-status"></div>

            <div class="incoming-call-footer">
              <div class="call-action">
                <button
                  id="decline-call-button"
                  class="call-control-button hang-up"
                >
                  <svg
                    width="46"
                    height="20"
                    viewBox="0 0 46 20"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M45.7693 13.3442L45.2549 15.7096C44.7713 17.9271 42.6494 19.3694 40.2974 19.0804L35.6123 18.5035C33.5729 18.2515 31.8676 16.7522 31.3974 14.7981L30.091 9.35493C27.9688 8.41918 25.6157 7.95632 23.0326 7.96448C20.5451 7.95228 18.0805 8.43931 15.7846 9.39675L14.7564 14.4349C14.3654 16.3421 12.744 17.7319 10.7363 17.8792L6.05622 18.2281C3.71963 18.4008 1.52623 16.8598 0.9222 14.6231L0.273957 12.2273C-0.370076 9.84126 0.324847 7.36474 2.1002 5.72975C6.29148 1.8646 13.1542 0.0539878 22.6925 0.290492C32.2453 0.527857 39.2208 2.69193 43.6105 6.78029C45.4581 8.50025 46.2808 10.9968 45.7693 13.3442V13.3442Z"
                      fill="white"
                    />
                  </svg>
                </button>
                <span>拒绝</span>
              </div>
              <div class="call-action">
                <button
                  id="accept-call-button"
                  class="call-control-button speak"
                >
                  <svg
                    width="31"
                    height="44"
                    viewBox="0 0 31 44"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M5.1217 1.2162L7.42746 0.479047C9.58964 -0.210966 11.8997 0.905483 12.8254 3.08695L14.6683 7.43275C15.4698 9.32493 15.024 11.5514 13.5669 12.9357L9.50607 16.7886C9.75679 19.0944 10.5325 21.3637 11.8311 23.5966C13.0643 25.757 14.7184 27.6479 16.6955 29.1574L21.5727 27.5288C23.4199 26.9138 25.4342 27.6231 26.5657 29.2882L29.2079 33.1668C30.5257 35.104 30.2879 37.774 28.6529 39.4155L26.9021 41.1748C25.1578 42.9256 22.6656 43.562 20.362 42.842C14.919 41.1448 9.91965 36.1069 5.35528 27.7281C0.784479 19.3365 -0.829123 12.2136 0.516617 6.36773C1.08234 3.90768 2.83309 1.94693 5.1217 1.2162V1.2162Z"
                      fill="white"
                    />
                  </svg>
                </button>
                <span>接听</span>
              </div>
            </div>
          </div>
        </div>

        <div id="dating-screen" class="screen">
          <div id="dating-loader-1" class="dating-loader">
            <span>正在进入约会界面……</span>
          </div>

          <div id="dating-loader-2" class="dating-loader">
            <span>正在赴约……</span>
          </div>

          <div id="dating-setup-screen" class="dating-setup-container">
            <div class="dating-setup-header">
              <button id="dating-setup-back-btn" class="vn-setup-back-btn">
                返回
              </button>
            </div>
            <h2>约会设置</h2>
            <div class="setup-section">
              <label>角色立绘</label>
              <div class="upload-box" id="char-upload-box">点击上传</div>
              <input
                type="file"
                id="char-upload-input"
                accept="image/*"
                style="display: none"
              />
            </div>
            <div class="setup-section">
              <label>场景背景 (至少设置一个默认场景)</label>
              <div class="upload-box" id="bg-upload-box">点击上传</div>
              <input
                type="file"
                id="bg-upload-input"
                accept="image/*"
                style="display: none"
              />
              <div id="bg-previews-container"></div>
            </div>
            <button id="start-dating-btn" class="save-button">完成设置</button>
          </div>

          <div id="vn-screen">
            <div id="vn-background"></div>
            <div id="vn-character"></div>

            <div id="vn-top-bar">
              <button id="vn-exit-btn">退出</button>
              <button id="vn-settings-btn">设置</button>
            </div>

            <div id="vn-dialog-box">
              <div id="vn-char-name-container">
                <span id="vn-char-name">角色名</span>
              </div>
              <div id="vn-dialog-text"></div>
              <button
                id="vn-regenerate-btn"
                class="vn-action-btn"
                title="重新生成"
              >
                <svg
                  width="20"
                  height="20"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path d="M2.5 2v6h6M21.5 22v-6h-6" />
                  <path
                    d="M22 11.5A10 10 0 003.2 7.2M2 12.5a10 10 0 0018.8 4.2"
                    stroke="white"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </svg>
              </button>
            </div>

            <div id="vn-choices-container"></div>
          </div>
        </div>

        <div id="dating-settings-screen" class="screen">
          <div id="dating-settings-main">
            <div class="settings-header">
              <button id="dating-settings-back-btn" class="vn-back-button">
                返回约会
              </button>
              <h1>约会设置</h1>
            </div>
            <div class="settings-menu-container">
              <button class="menu-button" data-target="portrait-settings">
                立绘设置
              </button>
              <button class="menu-button" data-target="background-settings">
                背景图设置
              </button>
              <button class="menu-button" data-target="font-settings">
                字体与显示
              </button>
              <button class="menu-button" data-target="writing-style-settings">
                文笔偏好
              </button>
            </div>
          </div>

          <div id="portrait-settings" class="settings-submenu">
            <div class="settings-header">
              <button
                class="submenu-back-btn vn-back-button"
                data-target="dating-settings-main"
              >
                返回
              </button>
              <h1>立绘设置</h1>
            </div>
            <div
              id="portrait-settings-content"
              class="settings-content-area"
            ></div>
          </div>

          <div id="background-settings" class="settings-submenu">
            <div class="settings-header">
              <button
                class="submenu-back-btn vn-back-button"
                data-target="dating-settings-main"
              >
                返回
              </button>
              <h1>背景图设置</h1>
            </div>
            <div
              id="background-settings-content"
              class="settings-content-area"
            ></div>
          </div>
          <div id="font-settings" class="settings-submenu">
            <div class="settings-header">
              <button
                class="submenu-back-btn vn-back-button"
                data-target="dating-settings-main"
              >
                返回
              </button>
              <h1>字体与显示</h1>
            </div>
            <div id="font-settings-content" class="settings-content-area">
              <p style="text-align: center; color: #888; margin-top: 50px">
                字体设置功能待开发...
              </p>
            </div>
          </div>
          <div id="writing-style-settings" class="settings-submenu">
            <div class="settings-header">
              <button
                class="submenu-back-btn vn-back-button"
                data-target="dating-settings-main"
              >
                返回
              </button>
              <h1>文笔偏好</h1>
              <div class="header-actions">
                <button id="add-style-preset-btn" class="vn-back-button">
                  添加
                </button>
              </div>
            </div>
            <div
              id="style-presets-container"
              class="settings-content-area"
            ></div>
          </div>

          <div id="style-preset-modal" class="vn-modal-overlay">
            <div class="modal-content">
              <div class="modal-header">
                <h2 id="style-preset-modal-title">添加偏好</h2>
                <button
                  id="style-preset-modal-close-btn"
                  class="modal-close-button"
                >
                  &times;
                </button>
              </div>
              <div class="modal-body">
                <textarea
                  id="style-preset-input"
                  class="form-textarea"
                  placeholder="例如：多一些对话，减少旁白描述。或者：请使用华丽的辞藻进行环境描写。"
                  style="height: 150px"
                ></textarea>
              </div>
              <div class="modal-footer">
                <button id="save-style-preset-btn" class="save-button">
                  保存
                </button>
              </div>
            </div>
          </div>
        </div>

        <div id="dating-history-screen" class="screen">
          <div class="settings-header">
            <button id="dating-history-back-button" class="header-icon-button">
              <svg
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M15 18l-6-6 6-6" />
              </svg>
            </button>
            <h1>约会记录</h1>
          </div>
          <div id="dating-history-container" class="settings-content"></div>
        </div>

        <div id="text-edit-modal" class="modal-overlay" style="display: none">
          <div class="modal-content">
            <div class="modal-header">
              <h2 id="text-edit-modal-title">编辑内容</h2>
              <button id="text-edit-modal-close-btn" class="modal-close-button">
                &times;
              </button>
            </div>
            <div class="modal-body">
              <textarea
                id="text-edit-textarea"
                class="form-textarea"
                style="height: 250px"
              ></textarea>
            </div>
            <div class="modal-footer">
              <button id="text-edit-save-btn" class="save-button">保存</button>
            </div>
          </div>
        </div>

        <div
          id="custom-choice-modal"
          class="vn-custom-modal-overlay"
          style="display: none"
        >
          <div class="vn-modal-content">
            <div class="modal-header">
              <h2>你的选择是？</h2>
              <button id="custom-choice-close-btn" class="modal-close-button">
                &times;
              </button>
            </div>
            <div class="modal-body">
              <input
                type="text"
                id="custom-choice-input"
                class="form-input"
                placeholder="输入你的行动或对话..."
              />
            </div>
            <div class="modal-footer">
              <button
                id="custom-choice-confirm-btn"
                class="save-button vn-confirm-button"
              >
                确定
              </button>
            </div>
          </div>
        </div>

        <div id="ai-thought-bubble" class="thought-bubble">
          <p id="thought-bubble-status"></p>
          <p id="thought-bubble-monologue"></p>
        </div>
        <div id="text-image-modal" class="modal-overlay" style="display: none">
          <div class="modal-content">
            <div class="modal-header">
              <h2>生成文图卡片</h2>
              <button
                id="text-image-modal-close-btn"
                class="modal-close-button"
              >
                &times;
              </button>
            </div>
            <div class="modal-body">
              <textarea
                id="text-image-input"
                class="form-textarea"
                placeholder="在这里输入文字，它将出现在卡片上..."
                style="height: 120px"
              ></textarea>
            </div>
            <div class="modal-footer">
              <button id="send-text-image-btn" class="save-button">
                生成并发送
              </button>
            </div>
          </div>
        </div>

        <div id="about-device-screen" class="screen">
          <div class="settings-header">
            <button id="about-device-back-button" class="header-icon-button">
              <svg viewBox="0 0 24 24">
                <path
                  d="M15 18l-6-6 6-6"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </button>
            <h1>关于本机</h1>
          </div>

          <div
            class="settings-content"
            style="padding-top: 110px; padding-bottom: 40px"
          >
            <div
              class="device-hero-card"
              style="
                background-image: url('https://i.postimg.cc/KcDp1KS6/Group-21.png');
              "
            ></div>

            <div class="device-info-grid">
              <div class="info-card">
                <div class="info-label">手机名称</div>
                <div class="info-value">7PHONE</div>
              </div>
              <div class="info-card">
                <div class="info-progress-bar">
                  <div class="progress" style="width: 40%"></div>
                </div>
                <div class="info-label">存储空间</div>
                <div class="info-value">209 GB / 512 GB</div>
              </div>

              <div class="info-list-card">
                <div class="info-row">
                  <span class="label">作者</span>
                  <span class="value">7%</span>
                </div>
                <div class="info-row">
                  <span class="label">联系方式</span>
                  <span class="value">小红书@7%</span>
                </div>
                <div class="info-row">
                  <span class="label">教程</span>
                  <span class="value"
                    >请查看 <span class="tag">群公告和群精华</span></span
                  >
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="qilang-screen" class="screen">
          <div id="qilang-sidebar-overlay" class="qilang-overlay"></div>
          <div id="qilang-sidebar" class="qilang-sidebar">
            <div class="sidebar-header">
              <h2>七浪 Menu</h2>
            </div>
            <div class="sidebar-identity-section">
              <div class="sidebar-section-title">当前身份</div>
              <div
                id="qilang-identity-list"
                class="sidebar-identity-list"
              ></div>
            </div>
            <div class="sidebar-menu">
              <div class="sidebar-item" id="qilang-menu-home">
                <span class="sidebar-icon">🏠</span> 首页
              </div>
              <div class="sidebar-item" id="qilang-menu-fav">
                <span class="sidebar-icon">⭐</span> 收藏
              </div>
              <div
                class="sidebar-item"
                id="qilang-menu-exit"
                style="
                  color: #ff3b30;
                  margin-top: 20px;
                  border-top: 1px solid rgba(0, 0, 0, 0.05);
                  padding-top: 20px;
                "
              >
                <span class="sidebar-icon">🚪</span> 退出七浪
              </div>
            </div>
          </div>

          <div class="settings-header">
            <button id="qilang-menu-btn" class="header-icon-button">
              <svg
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <line x1="3" y1="12" x2="21" y2="12"></line>
                <line x1="3" y1="6" x2="21" y2="6"></line>
                <line x1="3" y1="18" x2="21" y2="18"></line>
              </svg>
            </button>

            <h1>七浪</h1>

            <div class="header-actions">
              <button id="qilang-search-btn" class="header-icon-button">
                <svg
                  width="20"
                  height="20"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <circle cx="11" cy="11" r="8"></circle>
                  <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                </svg>
              </button>
              <button id="qilang-refresh-btn" class="header-icon-button">
                <svg
                  width="20"
                  height="20"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M23 4v6h-6"></path>
                  <path d="M1 20v-6h6"></path>
                  <path
                    d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"
                  ></path>
                </svg>
              </button>
            </div>
          </div>

          <div
            id="qilang-content"
            class="settings-content"
            style="padding-top: 100px; padding-bottom: 80px"
          >
            <div id="qilang-waterfall-grid" class="qilang-waterfall">
              <div class="qilang-card">
                <div
                  class="q-card-title"
                  style="font-family: 'Songti SC', serif"
                >
                  今天好累
                </div>
                <div class="q-card-footer">
                  <span class="q-author">@打工人</span>
                  <span class="q-likes">♥ 12</span>
                </div>
              </div>
              <div class="qilang-card">
                <div
                  class="q-card-title"
                  style="font-family: sans-serif; font-weight: 900"
                >
                  外星人偷袜子?
                </div>
                <div class="q-card-footer">
                  <span class="q-author">@神秘学</span>
                  <span class="q-likes">♥ 99+</span>
                </div>
              </div>
            </div>
          </div>

          <button
            id="qilang-post-btn"
            class="floating-action-button"
            style="bottom: 40px; right: 20px"
          >
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="white"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
          </button>

          <button id="qilang-back-btn" style="display: none"></button>

          <div id="qilang-detail-view" class="qilang-sub-screen">
            <div class="settings-header">
              <button id="qilang-detail-back-btn" class="header-icon-button">
                <svg
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M15 18l-6-6 6-6" />
                </svg>
              </button>
              <h1>帖子详情</h1>
              <div class="header-actions">
                <button class="header-icon-button">
                  <svg
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <circle cx="12" cy="12" r="1"></circle>
                    <circle cx="19" cy="12" r="1"></circle>
                    <circle cx="5" cy="12" r="1"></circle>
                  </svg>
                </button>
              </div>
            </div>
            <div
              id="qilang-action-menu"
              class="q-action-menu"
              style="display: none"
            >
              <div class="q-menu-item" id="q-action-fav">
                <svg
                  width="20"
                  height="20"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <polygon
                    points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"
                  ></polygon>
                </svg>
                <span id="q-fav-text">收藏</span>
              </div>
              <div class="q-menu-item delete" id="q-action-delete">
                <svg
                  width="20"
                  height="20"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <polyline points="3 6 5 6 21 6"></polyline>
                  <path
                    d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"
                  ></path>
                </svg>
                <span>删除</span>
              </div>
            </div>

            <div
              class="settings-content"
              style="padding-top: 60px; padding-bottom: 60px"
            >
              <div class="q-detail-main">
                <div class="q-detail-author-row">
                  <div
                    class="q-avatar-placeholder"
                    style="background-color: #5e5ce6"
                  ></div>
                  <div class="q-author-info">
                    <div class="q-name" id="q-detail-author-name">@用户名</div>
                    <div class="q-time">刚刚</div>
                  </div>
                  <button class="q-follow-btn">关注</button>
                </div>
                <div class="q-detail-title" id="q-detail-title">标题占位</div>
                <div class="q-detail-body" id="q-detail-content">
                  内容占位...
                </div>
                <div class="q-detail-tags" id="q-detail-tags">#标签</div>
              </div>

              <div class="q-comments-section">
                <div class="q-comments-header">评论区 (AI对战中...)</div>
                <div id="q-comments-list">
                  <div class="q-comment-item">
                    <div class="q-comment-row">
                      <span class="q-comment-user">@路人甲(躺平派)</span>:
                      <span class="q-comment-text"
                        >这确实挺累的，歇会儿吧。</span
                      >
                    </div>
                    <div class="q-comment-actions">
                      <span>⇧ 12</span> · <span>⇩</span> · <span>回复</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="q-detail-footer">
              <input
                type="text"
                id="q-detail-input"
                placeholder="输入评论，加入战斗..."
              />
              <button id="q-detail-send-btn">发送</button>
            </div>
          </div>
          <div id="qilang-post-modal" class="qilang-modal-overlay">
            <div class="qilang-modal-content">
              <div class="qilang-modal-header">
                <button id="qilang-post-cancel-btn">取消</button>
                <h3>发布浪潮</h3>
                <button id="qilang-post-confirm-btn" class="primary-btn">
                  发布
                </button>
              </div>
              <div class="qilang-modal-body">
                <input
                  type="text"
                  id="qilang-post-title-input"
                  class="q-input-title"
                  placeholder="加个响亮的标题..."
                />
                <textarea
                  id="qilang-post-content-input"
                  class="q-input-body"
                  placeholder="分享你的新鲜事..."
                ></textarea>
                <div class="q-input-tags-row">
                  <span class="q-tag-icon">#</span>
                  <input
                    type="text"
                    id="qilang-post-tags-input"
                    placeholder="话题 (用空格分隔)"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="global-beautify-screen" class="screen">
          <div class="settings-header">
            <button id="global-beautify-back-button" class="header-icon-button">
              <svg viewBox="0 0 24 24">
                <path
                  d="M15 18l-6-6 6-6"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </button>
            <h1>全局样式代码</h1>
            <div class="header-actions">
              <button
                id="save-as-theme-preset-btn"
                class="header-icon-button"
                title="保存为预设"
              >
                <svg
                  width="22"
                  height="22"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                  <polyline
                    points="17 21 17 13 7 13 7 21"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                  <polyline
                    points="7 3 7 8 15 8"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </svg>
              </button>
              <button
                id="reset-global-css-btn"
                class="header-icon-button"
                style="color: #ff3b30 !important"
              >
                <svg
                  class="icon-filled"
                  width="21"
                  height="29"
                  viewBox="0 0 21 29"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <g clip-path="url(#clip0_201_100457)">
                    <path
                      d="M0 14.8594C0 20.6133 4.61719 25.2305 10.3594 25.2305C16.1016 25.2305 20.707 20.6133 20.707 14.8594C20.707 9.11719 16.1016 4.51172 10.3594 4.51172C9.63281 4.51172 8.94141 4.59375 8.33203 4.71094L11.4492 1.62891C11.625 1.44141 11.707 1.20703 11.707 0.960938C11.707 0.421875 11.3086 0 10.793 0C10.5 0 10.2656 0.09375 10.1016 0.28125L5.27344 5.17969C5.08594 5.36719 4.98047 5.625 4.98047 5.88281C4.98047 6.15234 5.07422 6.38672 5.27344 6.58594L10.1016 11.4375C10.2773 11.6133 10.5 11.707 10.7812 11.707C11.3086 11.707 11.707 11.3086 11.707 10.7695C11.707 10.5234 11.625 10.2891 11.4375 10.1016L7.94531 6.63281C8.625 6.46875 9.45703 6.39844 10.3594 6.39844C15.0586 6.39844 18.8203 10.1602 18.8203 14.8594C18.8203 19.5703 15.0586 23.3438 10.3594 23.3438C5.66016 23.3438 1.88672 19.5703 1.88672 14.8594C1.88672 14.2969 1.53516 13.8867 0.972656 13.8867C0.398438 13.8867 0 14.2969 0 14.8594Z"
                      fill="black"
                      fill-opacity="0.85"
                    />
                  </g>
                  <defs>
                    <clipPath id="clip0_201_100457">
                      <rect width="20.707" height="28.043" fill="white" />
                    </clipPath>
                  </defs>
                </svg>
              </button>
            </div>
          </div>

          <div class="settings-content">
            <div class="form-group" style="width: 90%">
              <label
                style="
                  margin-bottom: 10px;
                  display: block;
                  color: #666;
                  font-size: 13px;
                "
              >
                在这里输入 CSS 代码，可以覆盖七聊、七书等所有界面的样式。
              </label>
              <textarea
                id="global-css-input"
                class="form-textarea code"
                placeholder="/* 示例：修改消息气泡颜色 */&#10;.user-bubble {&#10;  background-color: #8A2BE2 !important;&#10;}"
                style="
                  height: 300px;
                  font-family: monospace;
                  background-color: #fff;
                  color: #333;
                  line-height: 1.5;
                "
              ></textarea>
            </div>

            <div class="form-group" style="width: 90%; margin-top: 20px">
              <button
                id="save-global-css-btn"
                class="save-button"
                style="width: 100%"
              >
                保存并应用
              </button>
            </div>
          </div>
        </div>

        <div id="theme-presets-screen" class="screen">
          <div class="settings-header">
            <button id="theme-presets-back-button" class="header-icon-button">
              <svg viewBox="0 0 24 24">
                <path
                  d="M15 18l-6-6 6-6"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </button>
            <h1>主题预设</h1>
            <div class="header-actions">
              <button
                id="import-theme-preset-btn"
                class="header-icon-button"
                title="导入预设"
              >
                <svg
                  class="icon-filled"
                  width="28"
                  height="31"
                  viewBox="0 0 28 31"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <g clip-path="url(#clip0_201_72165)">
                    <path
                      d="M3.67969 27.7148H23.9531C26.4141 27.7148 27.6328 26.4961 27.6328 24.082V17.1445C27.6328 16.0781 27.4922 15.5508 26.9648 14.918L22.9219 9.90234C21.5508 8.21484 20.707 7.23047 18.6328 7.23047H9.01172C6.92578 7.23047 6.09375 8.21484 4.72266 9.90234L0.667969 14.918C0.152344 15.5508 0 16.0781 0 17.1445V24.082C0 26.4961 1.23047 27.7148 3.67969 27.7148ZM2.40234 15.5977L6.55078 10.3594C7.125 9.63281 8.01562 8.88281 8.87109 8.88281H18.7617C19.6172 8.88281 20.5078 9.63281 21.082 10.3594L25.2422 15.5977C25.7109 16.1953 25.5469 16.4297 24.9023 16.4297H17.4375C16.8281 16.4297 16.5469 16.8984 16.5469 17.3789V17.4258C16.5469 18.7852 15.4805 20.2148 13.8164 20.2148C12.1641 20.2148 11.0977 18.7852 11.0977 17.4258V17.3789C11.0977 16.8984 10.8047 16.4297 10.1953 16.4297H2.75391C2.07422 16.4297 1.94531 16.1602 2.40234 15.5977ZM3.70312 25.8281C2.53125 25.8281 1.88672 25.1953 1.88672 23.9766V18.1523H9.31641C9.59766 20.3438 11.4375 21.9609 13.8164 21.9609C16.1953 21.9609 18.0352 20.332 18.3164 18.1523H25.7461V23.9766C25.7461 25.1953 25.0898 25.8281 23.9297 25.8281H3.70312Z"
                      fill="black"
                      fill-opacity="0.85"
                    />
                    <path
                      d="M13.8164 0C12.3281 0 11.0859 1.21875 11.0859 2.69531V15.3867C11.0859 16.8633 12.3281 18.0938 13.8164 18.0938C15.3047 18.0938 16.5469 16.8633 16.5469 15.3867V2.69531C16.5469 1.21875 15.3047 0 13.8164 0Z"
                      fill="white"
                    />
                    <path
                      d="M13.8164 16.2891C14.0625 16.2891 14.2617 16.2188 14.4961 15.9844L18.457 12.1641C18.6328 11.9883 18.7266 11.7891 18.7266 11.543C18.7266 11.0625 18.3633 10.7227 17.8828 10.7227C17.6484 10.7227 17.4023 10.8164 17.2383 11.0039L15.4688 12.8906L14.6719 13.7227L14.7539 11.9648V2.69531C14.7539 2.20312 14.3203 1.79297 13.8164 1.79297C13.3125 1.79297 12.8906 2.20312 12.8906 2.69531V11.9648L12.9609 13.7227L12.1641 12.8906L10.3945 11.0039C10.2188 10.8164 9.97266 10.7227 9.73828 10.7227C9.25781 10.7227 8.90625 11.0625 8.90625 11.543C8.90625 11.7891 9 11.9883 9.17578 12.1641L13.1367 15.9844C13.3711 16.2188 13.582 16.2891 13.8164 16.2891Z"
                      fill="black"
                      fill-opacity="0.85"
                    />
                  </g>
                  <defs>
                    <clipPath id="clip0_201_72165">
                      <rect width="27.6328" height="30.7148" fill="white" />
                    </clipPath>
                  </defs>
                </svg>
              </button>
            </div>
          </div>
          <div
            class="settings-content"
            id="theme-presets-container"
            style="padding-bottom: 50px"
          >
            <div id="theme-presets-list" style="width: 100%"></div>
            <div
              id="theme-presets-empty"
              style="text-align: center; padding: 60px 20px; color: #8e8e93"
            >
              <svg
                width="48"
                height="48"
                viewBox="0 0 24 24"
                fill="none"
                stroke="#c7c7cc"
                stroke-width="1.5"
                style="margin-bottom: 15px"
              >
                <rect x="3" y="3" width="18" height="18" rx="3" />
                <path d="M7 8H17M7 12H14M7 16H11" />
              </svg>
              <p style="margin: 0; font-size: 15px">暂无保存的主题预设</p>
              <p style="margin: 8px 0 0 0; font-size: 13px">
                在"全局美化"中输入CSS后点击保存按钮
              </p>
            </div>
          </div>
          <input
            type="file"
            id="theme-preset-import-input"
            accept=".json"
            style="display: none"
          />
        </div>

        <!-- 气泡预设管理界面 -->
        <div id="bubble-presets-screen" class="screen">
          <div class="settings-header">
            <button id="bubble-presets-back-button" class="header-icon-button">
              <svg viewBox="0 0 24 24">
                <path
                  d="M15 18l-6-6 6-6"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </button>
            <h1>气泡预设</h1>
          </div>
          <div
            class="settings-content"
            id="bubble-presets-container"
            style="padding-bottom: 50px"
          >
            <div id="bubble-presets-list" style="width: 100%"></div>
            <div
              id="bubble-presets-empty"
              style="text-align: center; padding: 60px 20px; color: #8e8e93"
            >
              <svg
                width="48"
                height="48"
                viewBox="0 0 24 24"
                fill="none"
                stroke="#c7c7cc"
                stroke-width="1.5"
                style="margin-bottom: 15px"
              >
                <circle cx="12" cy="12" r="9" />
                <path d="M8 12h8M12 8v8" />
              </svg>
              <p style="margin: 0; font-size: 15px">暂无保存的气泡预设</p>
              <p style="margin: 8px 0 0 0; font-size: 13px">
                在聊天设置中输入CSS后点击"保存为预设"
              </p>
            </div>
          </div>
        </div>

        <!-- iOS 特性调整页面 -->
        <div id="ios-settings-screen" class="screen">
          <div class="settings-header">
            <button id="ios-settings-back-button" class="header-icon-button">
              <svg viewBox="0 0 24 24">
                <path
                  d="M15 18l-6-6 6-6"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </button>
            <h1>iOS 特性</h1>
          </div>

          <div class="settings-content" id="ios-settings-scroll-container">
            <div class="settings-group-title">安全区适配</div>
            <div class="modal-section">
              <div
                class="modal-cell"
                style="
                  flex-direction: column;
                  align-items: stretch;
                  padding: 15px;
                  height: auto;
                "
              >
                <div
                  style="
                    display: flex;
                    justify-content: space-between;
                    margin-bottom: 8px;
                  "
                >
                  <label style="font-size: 16px; font-weight: 500">底部延伸距离</label>
                  <span
                    id="ios-margin-display"
                    style="color: #007aff; font-weight: 600; font-size: 16px"
                    >50px</span
                  >
                </div>
                <p style="font-size: 13px; color: #8e8e93; margin: 0 0 12px 0;">
                  调整此值以消除PWA底部白块，不同iPhone机型可能需要不同数值
                </p>
                <input
                  type="range"
                  id="ios-margin-slider"
                  class="settings-slider"
                  min="-300"
                  max="300"
                  value="0"
                  step="5"
                />
                <div
                  style="
                    display: flex;
                    justify-content: space-between;
                    margin-top: 8px;
                    font-size: 12px;
                    color: #8e8e93;
                  "
                >
                  <span>-300px</span>
                  <span>300px</span>
                </div>
              </div>
            </div>

            <div class="settings-group-title">快捷预设</div>
            <div class="modal-section">
              <div class="modal-cell" id="ios-preset-30" style="cursor: pointer;">
                <label style="flex-grow: 1; font-size: 16px; cursor: pointer;">iPhone SE / 8</label>
                <span style="color: #8e8e93; font-size: 14px;">30px</span>
              </div>
              <div class="modal-cell" id="ios-preset-50" style="cursor: pointer;">
                <label style="flex-grow: 1; font-size: 16px; cursor: pointer;">iPhone X / 11 / 12</label>
                <span style="color: #8e8e93; font-size: 14px;">50px</span>
              </div>
              <div class="modal-cell" id="ios-preset-60" style="cursor: pointer;">
                <label style="flex-grow: 1; font-size: 16px; cursor: pointer;">iPhone 13 / 14 / 15</label>
                <span style="color: #8e8e93; font-size: 14px;">60px</span>
              </div>
              <div class="modal-cell" id="ios-preset-70" style="cursor: pointer;">
                <label style="flex-grow: 1; font-size: 16px; cursor: pointer;">iPhone 14 Pro Max / 15 Pro Max</label>
                <span style="color: #8e8e93; font-size: 14px;">70px</span>
              </div>
            </div>

            <div class="settings-group-title">说明</div>
            <div class="modal-section">
              <div class="modal-cell" style="height: auto; padding: 15px;">
                <p style="font-size: 14px; color: #8e8e93; margin: 0; line-height: 1.5;">
                  此设置仅在 iOS PWA 模式下生效。<br><br>
                  如果你在添加到主屏幕后的 App 底部看到白色区域，请调大此数值直到白块消失。<br><br>
                  💡 提示：设置会自动保存，刷新后生效。
                </p>
              </div>
            </div>
          </div>
        </div>

        <div id="proactive-settings-screen" class="screen">
          <div class="settings-header">
            <button id="proactive-back-button" class="header-icon-button">
              <svg viewBox="0 0 24 24">
                <path
                  d="M15 18l-6-6 6-6"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </button>
            <h1>主动消息</h1>
          </div>

          <div class="settings-content" id="proactive-scroll-container">
            <div class="settings-group-title">功能开关</div>
            <div class="modal-section">
              <div class="modal-cell">
                <label style="flex-grow: 1; font-weight: 500; font-size: 16px"
                  >启用主动消息</label
                >
                <label class="switch">
                  <input type="checkbox" id="proactive-master-switch" />
                  <span class="slider round"></span>
                </label>
              </div>
            </div>

            <div class="settings-group-title">触发频率</div>
            <div class="modal-section">
              <div
                class="modal-cell"
                style="
                  flex-direction: column;
                  align-items: stretch;
                  padding: 15px;
                  height: auto;
                "
              >
                <div
                  style="
                    display: flex;
                    justify-content: space-between;
                    margin-bottom: 12px;
                  "
                >
                  <label style="font-size: 16px; font-weight: 500"
                    >无操作等待时间</label
                  >
                  <span
                    id="proactive-interval-display"
                    style="color: #007aff; font-weight: 600; font-size: 16px"
                    >10 分钟</span
                  >
                </div>
                <input
                  type="range"
                  id="proactive-interval-slider"
                  class="form-slider"
                  min="5"
                  max="60"
                  step="1"
                  value="10"
                  style="width: 100%"
                />
                <div
                  style="
                    font-size: 13px;
                    color: #8e8e93;
                    margin-top: 12px;
                    line-height: 1.5;
                  "
                >
                  当您离开某个角色的聊天窗口后，如果超过此时长未回去，AI
                  将尝试主动联系您。
                </div>
              </div>
            </div>

            <div class="settings-group-title">应用对象 (勾选生效)</div>
            <div class="modal-section">
              <div id="proactive-contact-list" style="padding-left: 0"></div>
            </div>

            <div style="height: 50px"></div>
          </div>
        </div>

        <div id="wow-screen" class="screen">
          <div class="wow-ambient-bg">
            <div class="wow-blob wow-blob-1"></div>
            <div class="wow-blob wow-blob-2"></div>
            <div class="wow-blob wow-blob-3"></div>
          </div>

          <div id="wow-identity-modal" class="wow-modal-overlay">
            <div class="wow-modal-card">
              <h3>我是谁？</h3>
              <p>请选择一个 User 身份进入哇呜世界</p>
              <div id="wow-identity-list" class="wow-identity-list">
                <div class="wow-loading">读取通讯录中...</div>
              </div>
            </div>
          </div>

          <div id="wow-detail-view" class="wow-detail-view">
            <div class="wow-detail-nav">
              <div id="wow-detail-back-btn" class="wow-icon-btn">
                <i class="fas fa-chevron-left"></i> 返回
              </div>
              <span style="font-weight: 600">详情</span>
              <div style="width: 40px"></div>
            </div>

            <div class="wow-detail-content">
              <div id="wow-detail-main-post"></div>
              <div class="wow-divider"></div>
              <h3 style="font-size: 14px; margin-bottom: 15px; color: #666">
                评论区
              </h3>
              <div id="wow-detail-comments"></div>
            </div>

            <div class="wow-detail-input-area">
              <input
                type="text"
                id="wow-detail-input"
                class="wow-main-input"
                placeholder="评论..."
              />
              <div id="wow-detail-send-btn" class="wow-send-btn">发送</div>
            </div>
          </div>

          <div class="wow-container">
            <header class="wow-header">
              <button id="wow-exit-btn" class="wow-icon-btn">
                <svg
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M15 18l-6-6 6-6" />
                </svg>
              </button>
              <div class="wow-logo"></div>

              <div style="display: flex; gap: 10px; align-items: center">
                <button
                  id="wow-world-sim-btn"
                  class="wow-icon-btn"
                  title="世界推演"
                >
                  <svg
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <circle
                      cx="12.5"
                      cy="9.5"
                      r="4.5"
                      stroke="black"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M17.3209 15.2453C16.5664 15.8784 15.6946 16.3567 14.7553 16.6529C13.816 16.949 12.8275 17.0573 11.8463 16.9715C10.8652 16.8856 9.91051 16.6074 9.03689 16.1526C8.16326 15.6978 7.38776 15.0754 6.75467 14.3209C6.12158 13.5664 5.64329 12.6946 5.34712 11.7553C5.05095 10.816 4.9427 9.8275 5.02854 8.84633C5.11438 7.86516 5.39264 6.91051 5.84742 6.03688C6.3022 5.16326 6.92461 4.38776 7.67909 3.75467"
                      stroke="black"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M12 17V20M12 20H9.5M12 20C12 20 12.8284 20 14 20"
                      stroke="black"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </button>
                <img id="wow-current-avatar" src="" class="wow-header-avatar" />
              </div>
            </header>

            <main class="wow-content-area">
              <div id="wow-home-page" class="wow-page active">
                <h1
                  style="
                    margin-bottom: 20px;
                    font-size: 24px;
                    padding-left: 5px;
                  "
                >
                  动态
                </h1>

                <div id="wow-feed-container"></div>
              </div>

              <div id="wow-notif-page" class="wow-page">
                <h1
                  style="
                    margin-bottom: 20px;
                    font-size: 24px;
                    padding-left: 5px;
                  "
                >
                  消息
                </h1>
                <div class="wow-glass-card">
                  <div class="wow-notif-item">
                    <div class="wow-notif-icon icon-like">♥</div>
                    <div class="wow-notif-content">
                      <div><strong>Jason</strong> 赞了你的动态</div>
                      <div class="wow-notif-time">5分钟前</div>
                    </div>
                  </div>
                  <div class="wow-notif-item">
                    <div class="wow-notif-icon icon-comment">💬</div>
                    <div class="wow-notif-content">
                      <div>
                        <strong>Sarah</strong> 评论了你：这个UI真的太通透了！
                      </div>
                      <div class="wow-notif-time">20分钟前</div>
                    </div>
                  </div>
                </div>
              </div>

              <div id="wow-profile-page" class="wow-page">
                <div class="wow-profile-header">
                  <img
                    id="wow-profile-avatar"
                    src=""
                    class="wow-profile-avatar-large"
                  />
                  <h2 id="wow-profile-name" style="margin-top: 10px">用户名</h2>
                  <p style="color: #666; margin-top: 5px; font-size: 12px">
                    @wow_user
                  </p>
                </div>

                <div class="wow-glass-card">
                  <div class="wow-stats-row">
                    <div>
                      <div class="wow-stat-num">20k</div>
                      <div class="wow-stat-label">粉丝</div>
                    </div>
                    <div>
                      <div class="wow-stat-num">231</div>
                      <div class="wow-stat-label">关注</div>
                    </div>
                    <div>
                      <div class="wow-stat-num">330k</div>
                      <div class="wow-stat-label">获赞</div>
                    </div>
                  </div>
                </div>

                <div class="wow-glass-card">
                  <h3 style="margin-bottom: 15px; font-size: 14px">我的收藏</h3>

                  <div
                    id="wow-collection-list"
                    style="display: flex; flex-direction: column; gap: 15px"
                  ></div>
                </div>

                <div class="wow-glass-card">
                  <h3 style="margin-bottom: 10px; font-size: 14px">
                    世界书设定
                  </h3>
                  <div id="wow-worldbook-list" class="wow-option-list"></div>
                </div>
              </div>
            </main>

            <div class="wow-dock-container">
              <nav class="wow-glass-dock">
                <button class="wow-nav-btn active" data-target="wow-home-page">
                  <svg
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M11.3861 1.21065C11.7472 0.929784 12.2528 0.929784 12.6139 1.21065L21.6139 8.21065C21.8575 8.4001 22 8.69141 22 9V20C22 20.7957 21.6839 21.5587 21.1213 22.1213C20.5587 22.6839 19.7957 23 19 23H5C4.20435 23 3.44129 22.6839 2.87868 22.1213C2.31607 21.5587 2 20.7957 2 20V9C2 8.69141 2.14247 8.4001 2.38606 8.21065L11.3861 1.21065ZM4 9.48908V20C4 20.2652 4.10536 20.5196 4.29289 20.7071C4.48043 20.8946 4.73478 21 5 21H19C19.2652 21 19.5196 20.8946 19.7071 20.7071C19.8946 20.5196 20 20.2652 20 20V9.48908L12 3.26686L4 9.48908Z"
                      fill="#484C52"
                    />
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M8 12C8 11.4477 8.44772 11 9 11H15C15.5523 11 16 11.4477 16 12V22C16 22.5523 15.5523 23 15 23C14.4477 23 14 22.5523 14 22V13H10V22C10 22.5523 9.55228 23 9 23C8.44772 23 8 22.5523 8 22V12Z"
                      fill="#484C52"
                    />
                  </svg>
                </button>
                <button class="wow-nav-btn" id="wow-publish-trigger-btn">
                  <svg
                    width="20"
                    height="20"
                    viewBox="0 0 20 20"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M6 0C2.68629 0 0 2.68629 0 6V14C0 17.3137 2.68629 20 6 20H14C17.3137 20 20 17.3137 20 14V6C20 2.68629 17.3137 0 14 0H6ZM2 6C2 3.79086 3.79086 2 6 2H14C16.2091 2 18 3.79086 18 6V14C18 16.2091 16.2091 18 14 18H6C3.79086 18 2 16.2091 2 14V6ZM11 6C11 5.44772 10.5523 5 10 5C9.44772 5 9 5.44772 9 6V9H6C5.44772 9 5 9.44772 5 10C5 10.5523 5.44772 11 6 11H9V14C9 14.5523 9.44772 15 10 15C10.5523 15 11 14.5523 11 14V11H14C14.5523 11 15 10.5523 15 10C15 9.44772 14.5523 9 14 9H11V6Z"
                      fill="black"
                    />
                  </svg>
                </button>
                <button class="wow-nav-btn" data-target="wow-profile-page">
                  <svg
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M4.46447 15.4645C5.40215 14.5268 6.67392 14 8 14H16C17.3261 14 18.5979 14.5268 19.5355 15.4645C20.4732 16.4021 21 17.6739 21 19V21C21 21.5523 20.5523 22 20 22C19.4477 22 19 21.5523 19 21V19C19 18.2044 18.6839 17.4413 18.1213 16.8787C17.5587 16.3161 16.7956 16 16 16H8C7.20435 16 6.44129 16.3161 5.87868 16.8787C5.31607 17.4413 5 18.2044 5 19V21C5 21.5523 4.55228 22 4 22C3.44772 22 3 21.5523 3 21V19C3 17.6739 3.52678 16.4021 4.46447 15.4645Z"
                      fill="#484C52"
                    />
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M12 4C10.3431 4 9 5.34315 9 7C9 8.65685 10.3431 10 12 10C13.6569 10 15 8.65685 15 7C15 5.34315 13.6569 4 12 4ZM7 7C7 4.23858 9.23858 2 12 2C14.7614 2 17 4.23858 17 7C17 9.76142 14.7614 12 12 12C9.23858 12 7 9.76142 7 7Z"
                      fill="#484C52"
                    />
                  </svg>
                </button>
              </nav>
            </div>
          </div>
        </div>

        <div id="wow-compose-modal" class="wow-compose-modal">
          <div class="wow-compose-header">
            <button id="wow-compose-cancel-btn">取消</button>
            <span>发布动态</span>
            <button id="wow-compose-publish-btn" class="wow-publish-btn">
              发布
            </button>
          </div>
          <textarea
            id="wow-compose-text"
            class="wow-compose-textarea"
            placeholder="分享你的新鲜事..."
          ></textarea>
        </div>

        <!-- ======================== -->
        <!-- 群聊设置 - 独立全屏页面 (放在content-mask内部) -->
        <!-- ======================== -->
        <div id="group-settings-page" class="chat-settings-page">
          <!-- 顶部导航栏 -->
          <div class="settings-page-header">
            <button id="group-settings-back-btn" class="settings-page-back-btn">
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M15 18l-6-6 6-6" />
              </svg>
            </button>
            <div class="settings-page-title">群聊设置</div>
            <div class="settings-page-header-right">
              <button
                id="save-group-settings-btn"
                class="settings-page-save-btn"
              >
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2.5"
                >
                  <polyline points="20 6 9 17 4 12" />
                </svg>
              </button>
            </div>
          </div>

          <!-- 滚动内容区 -->
          <div class="settings-page-content">
            <!-- 1. 群信息头部卡片 -->
            <div class="profile-header-card">
              <div class="profile-avatar-wrapper">
                <div id="group-settings-avatar" class="profile-avatar"></div>
                <input
                  type="file"
                  id="group-avatar-upload-input"
                  accept="image/*"
                  style="display: none"
                />
                <div class="profile-avatar-badge">
                  <svg
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path
                      d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"
                    />
                    <circle cx="12" cy="13" r="4" />
                  </svg>
                </div>
              </div>
              <div class="profile-info">
                <div class="profile-name-row">
                  <span id="group-settings-name" class="profile-name"
                    >群聊名称</span
                  >
                  <button id="edit-group-name-btn" class="profile-edit-btn">
                    <svg
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <path
                        d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"
                      />
                      <path
                        d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"
                      />
                    </svg>
                  </button>
                </div>
                <div class="profile-subtitle">在这里，发现更多~</div>
              </div>
            </div>

            <!-- 2. 成员区域卡片 -->
            <div class="members-section-card">
              <div class="members-section-header">
                <span class="members-section-title">群聊成员</span>
                <span id="group-member-count" class="members-section-count"
                  >删除群成员 ></span
                >
              </div>

              <!-- 成员网格 -->
              <div id="group-members-grid" class="members-grid-wrapper"></div>

              <!-- 我的群名片 -->
              <div id="group-user-card" class="my-card-wrapper">
                <div id="group-user-avatar" class="my-card-avatar"></div>
                <div class="my-card-info">
                  <div class="my-card-label">我的群名片</div>
                  <div id="group-user-name" class="my-card-name">我</div>
                </div>
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="#C7C7CC"
                  stroke-width="2"
                >
                  <path d="M9 18l6-6-6-6" />
                </svg>
              </div>
            </div>

            <!-- 3. 世界书设置 (可折叠) -->
            <div class="collapsible-section" data-section="worldbook">
              <div class="collapsible-header">
                <div class="collapsible-header-left">
                  <div class="collapsible-icon worldbook">
                    <svg
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="0"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <g clip-path="url(#clip0_203_26008)">
                        <path
                          d="M22.2 2.16297C21.6378 1.6929 20.9791 1.35236 20.2705 1.16554C19.5619 0.978712 18.8209 0.950181 18.1 1.08197L14.278 1.77597C13.3956 1.93802 12.5933 2.392 12 3.06497C11.4052 2.39084 10.6006 1.93675 9.716 1.77597L5.9 1.08197C5.17916 0.950066 4.43813 0.978222 3.72938 1.16445C3.02062 1.35067 2.36147 1.69042 1.79857 2.15963C1.23567 2.62884 0.782786 3.21604 0.471982 3.87968C0.161178 4.54332 4.88125e-05 5.26716 0 5.99997L0 16.793C5.74559e-05 17.9638 0.410977 19.0974 1.16113 19.9963C1.91129 20.8952 2.95311 21.5024 4.105 21.712L10.391 22.855C11.455 23.0483 12.545 23.0483 13.609 22.855L19.9 21.712C21.051 21.5014 22.0916 20.8938 22.8408 19.9949C23.5899 19.0961 24.0002 17.9631 24 16.793V5.99997C24.0005 5.26742 23.8394 4.54377 23.5283 3.88057C23.2171 3.21736 22.7636 2.63091 22.2 2.16297ZM11 20.928C10.916 20.916 10.832 20.902 10.748 20.887L4.463 19.745C3.77176 19.6192 3.14659 19.2548 2.69649 18.7154C2.24638 18.1759 1.99989 17.4956 2 16.793V5.99997C2 5.20432 2.31607 4.44126 2.87868 3.87865C3.44129 3.31604 4.20435 2.99997 5 2.99997C5.18109 3.0004 5.36179 3.0168 5.54 3.04897L9.36 3.74897C9.81961 3.83308 10.2353 4.07544 10.5348 4.43402C10.8344 4.79259 10.999 5.24473 11 5.71197V20.928ZM22 16.793C22.0001 17.4956 21.7536 18.1759 21.3035 18.7154C20.8534 19.2548 20.2282 19.6192 19.537 19.745L13.252 20.887C13.168 20.902 13.084 20.916 13 20.928V5.71197C12.9999 5.24358 13.1643 4.79003 13.4643 4.43038C13.7644 4.07073 14.1812 3.82781 14.642 3.74397L18.463 3.04397C18.8957 2.96524 19.3405 2.98262 19.7657 3.09488C20.191 3.20714 20.5863 3.41153 20.9238 3.69358C21.2613 3.97562 21.5326 4.32843 21.7186 4.727C21.9046 5.12556 22.0007 5.56015 22 5.99997V16.793Z"
                          fill="#374957"
                        />
                      </g>
                      <defs>
                        <clipPath id="clip0_203_26008">
                          <rect width="24" height="24" fill="white" />
                        </clipPath>
                      </defs>
                    </svg>
                  </div>
                  <span class="collapsible-title">世界书设置</span>
                </div>
                <svg
                  class="collapsible-chevron"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M6 9l6 6 6-6" />
                </svg>
              </div>
              <div class="collapsible-content">
                <div class="collapsible-inner">
                  <div
                    id="group-worldbook-select-container"
                    class="worldbook-multiselect-wrapper"
                  ></div>
                </div>
              </div>
            </div>

            <!-- 4. 显示设置 (可折叠) -->
            <div class="collapsible-section" data-section="display">
              <div class="collapsible-header">
                <div class="collapsible-header-left">
                  <div class="collapsible-icon display">
                    <svg
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="0"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        d="M19 3H5C3.6744 3.00159 2.40356 3.52888 1.46622 4.46622C0.528882 5.40356 0.00158786 6.6744 0 8L0 14C0.00158786 15.3256 0.528882 16.5964 1.46622 17.5338C2.40356 18.4711 3.6744 18.9984 5 19H11V20H8C7.73478 20 7.48043 20.1054 7.29289 20.2929C7.10536 20.4804 7 20.7348 7 21C7 21.2652 7.10536 21.5196 7.29289 21.7071C7.48043 21.8946 7.73478 22 8 22H16C16.2652 22 16.5196 21.8946 16.7071 21.7071C16.8946 21.5196 17 21.2652 17 21C17 20.7348 16.8946 20.4804 16.7071 20.2929C16.5196 20.1054 16.2652 20 16 20H13V19H19C20.3256 18.9984 21.5964 18.4711 22.5338 17.5338C23.4711 16.5964 23.9984 15.3256 24 14V8C23.9984 6.6744 23.4711 5.40356 22.5338 4.46622C21.5964 3.52888 20.3256 3.00159 19 3V3ZM22 14C22 14.7956 21.6839 15.5587 21.1213 16.1213C20.5587 16.6839 19.7956 17 19 17H5C4.20435 17 3.44129 16.6839 2.87868 16.1213C2.31607 15.5587 2 14.7956 2 14V8C2 7.20435 2.31607 6.44129 2.87868 5.87868C3.44129 5.31607 4.20435 5 5 5H19C19.7956 5 20.5587 5.31607 21.1213 5.87868C21.6839 6.44129 22 7.20435 22 8V14Z"
                        fill="#374957"
                      />
                    </svg>
                  </div>
                  <span class="collapsible-title">显示设置</span>
                </div>
                <svg
                  class="collapsible-chevron"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M6 9l6 6 6-6" />
                </svg>
              </div>
              <div class="collapsible-content">
                <div class="collapsible-inner">
                  <div class="setting-item-row">
                    <span class="setting-item-label">显示头像</span>
                    <div
                      id="group-show-avatars-toggle"
                      class="ios-switch active"
                    ></div>
                  </div>
                  <div class="setting-item-row">
                    <span class="setting-item-label">显示时间戳</span>
                    <div
                      id="group-show-timestamp-toggle"
                      class="ios-switch"
                    ></div>
                  </div>
                  <div class="setting-item-row">
                    <span class="setting-item-label">双语折叠气泡</span>
                    <div
                      id="group-bilingual-bubble-toggle"
                      class="ios-switch"
                    ></div>
                  </div>
                </div>
              </div>
            </div>

            <!-- 5. 聊天背景 (可折叠) -->
            <div class="collapsible-section" data-section="background">
              <div class="collapsible-header">
                <div class="collapsible-header-left">
                  <div class="collapsible-icon background">
                    <svg
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="0"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <g clip-path="url(#clip0_203_26717)">
                        <path
                          d="M19 0H5C3.6744 0.00158786 2.40356 0.528882 1.46622 1.46622C0.528882 2.40356 0.00158786 3.6744 0 5L0 19C0.00158786 20.3256 0.528882 21.5964 1.46622 22.5338C2.40356 23.4711 3.6744 23.9984 5 24H19C20.3256 23.9984 21.5964 23.4711 22.5338 22.5338C23.4711 21.5964 23.9984 20.3256 24 19V5C23.9984 3.6744 23.4711 2.40356 22.5338 1.46622C21.5964 0.528882 20.3256 0.00158786 19 0V0ZM5 2H19C19.7956 2 20.5587 2.31607 21.1213 2.87868C21.6839 3.44129 22 4.20435 22 5V19C21.9983 19.4455 21.8957 19.8848 21.7 20.285L12.537 11.122C12.0727 10.6576 11.5214 10.2892 10.9147 10.0378C10.308 9.78644 9.65772 9.65707 9.001 9.65707C8.34428 9.65707 7.69399 9.78644 7.08728 10.0378C6.48056 10.2892 5.92931 10.6576 5.465 11.122L2 14.586V5C2 4.20435 2.31607 3.44129 2.87868 2.87868C3.44129 2.31607 4.20435 2 5 2V2ZM5 22C4.20435 22 3.44129 21.6839 2.87868 21.1213C2.31607 20.5587 2 19.7956 2 19V17.414L6.878 12.536C7.1566 12.2572 7.4874 12.0361 7.85151 11.8852C8.21561 11.7343 8.60587 11.6566 9 11.6566C9.39413 11.6566 9.78439 11.7343 10.1485 11.8852C10.5126 12.0361 10.8434 12.2572 11.122 12.536L20.285 21.7C19.8848 21.8957 19.4455 21.9983 19 22H5Z"
                          fill="#374957"
                        />
                        <path
                          d="M16.0001 10.4997C16.6924 10.4997 17.369 10.2944 17.9446 9.9098C18.5202 9.52521 18.9688 8.97858 19.2337 8.33904C19.4986 7.6995 19.5679 6.99577 19.4329 6.31684C19.2978 5.6379 18.9645 5.01426 18.475 4.52478C17.9855 4.03529 17.3619 3.70195 16.6829 3.5669C16.004 3.43185 15.3003 3.50117 14.6607 3.76607C14.0212 4.03098 13.4746 4.47958 13.09 5.05516C12.7054 5.63073 12.5001 6.30742 12.5001 6.99965C12.5001 7.92791 12.8689 8.81815 13.5252 9.47452C14.1816 10.1309 15.0719 10.4997 16.0001 10.4997V10.4997ZM16.0001 5.49965C16.2968 5.49965 16.5868 5.58762 16.8335 5.75245C17.0802 5.91727 17.2724 6.15154 17.3859 6.42563C17.4995 6.69972 17.5292 7.00132 17.4713 7.29229C17.4134 7.58326 17.2706 7.85053 17.0608 8.06031C16.851 8.27009 16.5837 8.41295 16.2928 8.47083C16.0018 8.52871 15.7002 8.499 15.4261 8.38547C15.152 8.27194 14.9177 8.07968 14.7529 7.83301C14.5881 7.58633 14.5001 7.29632 14.5001 6.99965C14.5001 6.60183 14.6582 6.2203 14.9395 5.93899C15.2208 5.65769 15.6023 5.49965 16.0001 5.49965V5.49965Z"
                          fill="#374957"
                        />
                      </g>
                      <defs>
                        <clipPath id="clip0_203_26717">
                          <rect width="24" height="24" fill="white" />
                        </clipPath>
                      </defs>
                    </svg>
                  </div>
                  <span class="collapsible-title">聊天背景</span>
                </div>
                <svg
                  class="collapsible-chevron"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M6 9l6 6 6-6" />
                </svg>
              </div>
              <div class="collapsible-content">
                <div class="collapsible-inner">
                  <div class="bg-selector-wrapper">
                    <div
                      id="group-chat-bg-preview-box"
                      class="bg-preview-box"
                      onclick="document.getElementById('group-chat-bg-input').click()"
                    >
                      <img
                        id="group-chat-bg-preview"
                        src=""
                        style="
                          width: 100%;
                          height: 100%;
                          object-fit: cover;
                          display: none;
                          border-radius: 10px;
                        "
                      />
                      <div
                        id="group-chat-bg-placeholder"
                        class="bg-preview-placeholder"
                      >
                        <svg
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                        >
                          <rect
                            x="3"
                            y="3"
                            width="18"
                            height="18"
                            rx="2"
                            ry="2"
                          />
                          <circle cx="8.5" cy="8.5" r="1.5" />
                          <polyline points="21 15 16 10 5 21" />
                        </svg>
                        <span>点击选择背景图片</span>
                      </div>
                    </div>
                    <input
                      type="file"
                      id="group-chat-bg-input"
                      accept="image/*"
                      style="display: none"
                    />
                    <div class="bg-action-btns">
                      <button
                        id="group-upload-bg-btn"
                        class="bg-action-btn primary"
                        onclick="document.getElementById('group-chat-bg-input').click()"
                      >
                        选择图片
                      </button>
                      <button
                        id="group-clear-bg-btn"
                        class="bg-action-btn secondary"
                      >
                        恢复默认
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- 6. 危险操作 (可折叠) -->
            <div class="collapsible-section" data-section="danger">
              <div class="collapsible-header">
                <div class="collapsible-header-left">
                  <div class="collapsible-icon danger">
                    <svg
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <path
                        d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"
                      />
                      <line x1="12" y1="9" x2="12" y2="13" />
                      <line x1="12" y1="17" x2="12.01" y2="17" />
                    </svg>
                  </div>
                  <span class="collapsible-title">危险操作</span>
                </div>
                <svg
                  class="collapsible-chevron"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M6 9l6 6 6-6" />
                </svg>
              </div>
              <div class="collapsible-content">
                <div class="collapsible-inner">
                  <div class="danger-actions-wrapper">
                    <button id="group-clear-history-btn" class="danger-btn red">
                      清空聊天记录
                    </button>
                    <button id="group-delete-btn" class="danger-btn red">
                      解散该群聊
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ======================== -->
        <!-- 单聊设置 - 独立全屏页面 (放在content-mask内部) -->
        <!-- ======================== -->
        <div id="chat-settings-page" class="chat-settings-page">
          <!-- 顶部导航栏 -->
          <div class="settings-page-header">
            <button id="chat-settings-back-btn" class="settings-page-back-btn">
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M15 18l-6-6 6-6" />
              </svg>
            </button>
            <div class="settings-page-title">聊天设置</div>
            <button
              id="save-chat-settings-new-btn"
              class="settings-page-save-btn"
            >
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2.5"
              >
                <polyline points="20 6 9 17 4 12" />
              </svg>
            </button>
          </div>

          <!-- 滚动内容区 -->
          <div class="settings-page-content">
            <!-- 1. 角色信息头部卡片 -->
            <div class="profile-header-card">
              <div class="profile-avatar-wrapper">
                <div id="chat-settings-avatar" class="profile-avatar"></div>
                <input
                  type="file"
                  id="chat-avatar-upload-input"
                  accept="image/*"
                  style="display: none"
                />
                <div class="profile-avatar-badge">
                  <svg
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path
                      d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"
                    />
                    <circle cx="12" cy="13" r="4" />
                  </svg>
                </div>
              </div>
              <div class="profile-info">
                <div class="profile-name-row">
                  <span id="chat-settings-name" class="profile-name"
                    >角色名称</span
                  >
                  <button id="edit-chat-name-btn" class="profile-edit-btn">
                    <svg
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <path
                        d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"
                      />
                      <path
                        d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"
                      />
                    </svg>
                  </button>
                </div>
                <!-- 角色/用户切换 -->
                <div
                  class="role-tabs-wrapper"
                  style="margin-top: 8px; margin-bottom: 0"
                >
                  <button id="chat-role-tab-ai" class="role-tab-btn active">
                    角色
                  </button>
                  <button id="chat-role-tab-user" class="role-tab-btn">
                    用户
                  </button>
                </div>
              </div>
            </div>

            <!-- AI 角色编辑表单 -->
            <div id="chat-ai-form" class="collapsible-section expanded">
              <div class="collapsible-inner" style="padding-top: 16px">
                <div class="character-form-row">
                  <label class="character-form-label">角色名称</label>
                  <input
                    type="text"
                    id="chat-ai-name-input"
                    class="settings-input-field"
                    placeholder="输入角色名称"
                  />
                </div>
                <div class="character-form-row">
                  <label class="character-form-label">人设 (Persona)</label>
                  <textarea
                    id="chat-ai-persona-input"
                    class="settings-textarea-field"
                    placeholder="输入角色人设..."
                    rows="4"
                  ></textarea>
                </div>
                <div class="character-form-row">
                  <label class="character-form-label">上下文记忆条数</label>
                  <input
                    type="number"
                    id="chat-context-memory-input"
                    class="settings-input-field"
                    value="10"
                    min="0"
                    max="100"
                  />
                </div>
              </div>
            </div>

            <!-- 用户编辑表单 (初始隐藏) -->
            <div
              id="chat-user-form"
              class="collapsible-section"
              style="display: none"
            >
              <div class="collapsible-inner" style="padding-top: 16px">
                <div class="character-avatar-editor">
                  <div
                    id="chat-user-avatar-preview"
                    class="character-avatar-preview"
                  ></div>
                  <button
                    id="chat-user-avatar-btn"
                    class="character-avatar-upload-btn"
                  >
                    更换头像
                  </button>
                  <input
                    type="file"
                    id="chat-user-avatar-input"
                    accept="image/*"
                    style="display: none"
                  />
                </div>
                <div class="character-form-row">
                  <label class="character-form-label">用户昵称</label>
                  <input
                    type="text"
                    id="chat-user-name-input"
                    class="settings-input-field"
                    placeholder="输入你的名字"
                  />
                </div>
                <div class="character-form-row">
                  <label class="character-form-label"
                    >用户人设 (User Persona)</label
                  >
                  <textarea
                    id="chat-user-persona-input"
                    class="settings-textarea-field"
                    placeholder="输入你的人设..."
                    rows="4"
                  ></textarea>
                </div>
              </div>
            </div>

            <!-- 2. 世界书设置 (可折叠) -->
            <div class="collapsible-section" data-section="worldbook">
              <div class="collapsible-header">
                <div class="collapsible-header-left">
                  <div class="collapsible-icon worldbook">
                    <svg
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="0"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <g clip-path="url(#clip0_203_26008)">
                        <path
                          d="M22.2 2.16297C21.6378 1.6929 20.9791 1.35236 20.2705 1.16554C19.5619 0.978712 18.8209 0.950181 18.1 1.08197L14.278 1.77597C13.3956 1.93802 12.5933 2.392 12 3.06497C11.4052 2.39084 10.6006 1.93675 9.716 1.77597L5.9 1.08197C5.17916 0.950066 4.43813 0.978222 3.72938 1.16445C3.02062 1.35067 2.36147 1.69042 1.79857 2.15963C1.23567 2.62884 0.782786 3.21604 0.471982 3.87968C0.161178 4.54332 4.88125e-05 5.26716 0 5.99997L0 16.793C5.74559e-05 17.9638 0.410977 19.0974 1.16113 19.9963C1.91129 20.8952 2.95311 21.5024 4.105 21.712L10.391 22.855C11.455 23.0483 12.545 23.0483 13.609 22.855L19.9 21.712C21.051 21.5014 22.0916 20.8938 22.8408 19.9949C23.5899 19.0961 24.0002 17.9631 24 16.793V5.99997C24.0005 5.26742 23.8394 4.54377 23.5283 3.88057C23.2171 3.21736 22.7636 2.63091 22.2 2.16297ZM11 20.928C10.916 20.916 10.832 20.902 10.748 20.887L4.463 19.745C3.77176 19.6192 3.14659 19.2548 2.69649 18.7154C2.24638 18.1759 1.99989 17.4956 2 16.793V5.99997C2 5.20432 2.31607 4.44126 2.87868 3.87865C3.44129 3.31604 4.20435 2.99997 5 2.99997C5.18109 3.0004 5.36179 3.0168 5.54 3.04897L9.36 3.74897C9.81961 3.83308 10.2353 4.07544 10.5348 4.43402C10.8344 4.79259 10.999 5.24473 11 5.71197V20.928ZM22 16.793C22.0001 17.4956 21.7536 18.1759 21.3035 18.7154C20.8534 19.2548 20.2282 19.6192 19.537 19.745L13.252 20.887C13.168 20.902 13.084 20.916 13 20.928V5.71197C12.9999 5.24358 13.1643 4.79003 13.4643 4.43038C13.7644 4.07073 14.1812 3.82781 14.642 3.74397L18.463 3.04397C18.8957 2.96524 19.3405 2.98262 19.7657 3.09488C20.191 3.20714 20.5863 3.41153 20.9238 3.69358C21.2613 3.97562 21.5326 4.32843 21.7186 4.727C21.9046 5.12556 22.0007 5.56015 22 5.99997V16.793Z"
                          fill="#374957"
                        />
                      </g>
                      <defs>
                        <clipPath id="clip0_203_26008">
                          <rect width="24" height="24" fill="white" />
                        </clipPath>
                      </defs>
                    </svg>
                  </div>
                  <span class="collapsible-title">世界书设置</span>
                </div>
                <svg
                  class="collapsible-chevron"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M6 9l6 6 6-6" />
                </svg>
              </div>
              <div class="collapsible-content">
                <div class="collapsible-inner">
                  <div
                    id="chat-worldbook-select-container"
                    class="worldbook-multiselect-wrapper"
                  ></div>
                  <div class="setting-item-row" style="margin-top: 12px">
                    <span class="setting-item-label">读取世界书表情包</span>
                    <div id="chat-wb-stickers-toggle" class="ios-switch"></div>
                  </div>
                </div>
              </div>
            </div>

            <!-- 3. 显示设置 (可折叠) -->
            <div class="collapsible-section" data-section="display">
              <div class="collapsible-header">
                <div class="collapsible-header-left">
                  <div class="collapsible-icon display">
                    <svg
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="0"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        d="M19 3H5C3.6744 3.00159 2.40356 3.52888 1.46622 4.46622C0.528882 5.40356 0.00158786 6.6744 0 8L0 14C0.00158786 15.3256 0.528882 16.5964 1.46622 17.5338C2.40356 18.4711 3.6744 18.9984 5 19H11V20H8C7.73478 20 7.48043 20.1054 7.29289 20.2929C7.10536 20.4804 7 20.7348 7 21C7 21.2652 7.10536 21.5196 7.29289 21.7071C7.48043 21.8946 7.73478 22 8 22H16C16.2652 22 16.5196 21.8946 16.7071 21.7071C16.8946 21.5196 17 21.2652 17 21C17 20.7348 16.8946 20.4804 16.7071 20.2929C16.5196 20.1054 16.2652 20 16 20H13V19H19C20.3256 18.9984 21.5964 18.4711 22.5338 17.5338C23.4711 16.5964 23.9984 15.3256 24 14V8C23.9984 6.6744 23.4711 5.40356 22.5338 4.46622C21.5964 3.52888 20.3256 3.00159 19 3V3ZM22 14C22 14.7956 21.6839 15.5587 21.1213 16.1213C20.5587 16.6839 19.7956 17 19 17H5C4.20435 17 3.44129 16.6839 2.87868 16.1213C2.31607 15.5587 2 14.7956 2 14V8C2 7.20435 2.31607 6.44129 2.87868 5.87868C3.44129 5.31607 4.20435 5 5 5H19C19.7956 5 20.5587 5.31607 21.1213 5.87868C21.6839 6.44129 22 7.20435 22 8V14Z"
                        fill="#374957"
                      />
                    </svg>
                  </div>
                  <span class="collapsible-title">显示设置</span>
                </div>
                <svg
                  class="collapsible-chevron"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M6 9l6 6 6-6" />
                </svg>
              </div>
              <div class="collapsible-content">
                <div class="collapsible-inner">
                  <div class="setting-item-row">
                    <span class="setting-item-label">显示聊天头像</span>
                    <div
                      id="chat-show-avatars-toggle"
                      class="ios-switch active"
                    ></div>
                  </div>
                  <div class="setting-item-row">
                    <span class="setting-item-label">显示消息时间</span>
                    <div
                      id="chat-show-timestamp-toggle"
                      class="ios-switch"
                    ></div>
                  </div>

                  <div class="setting-item-row">
                    <span class="setting-item-label">显示内心独白</span>
                    <div
                      id="chat-monologue-toggle"
                      class="ios-switch active"
                    ></div>
                  </div>
                  <div class="setting-item-row">
                    <span class="setting-item-label">双语折叠气泡</span>
                    <div id="chat-bilingual-toggle" class="ios-switch"></div>
                  </div>
                  <div class="character-form-row" style="margin-top: 12px">
                    <label class="character-form-label">头像圆角[后缀%]</label>
                    <input
                      type="text"
                      id="chat-avatar-radius-input"
                      class="settings-input-field"
                      value="50%"
                      placeholder="例如: 50%"
                    />
                  </div>
                </div>
              </div>
            </div>

            <!-- 4. 气泡样式 (可折叠) -->
            <div class="collapsible-section" data-section="style">
              <div class="collapsible-header">
                <div class="collapsible-header-left">
                  <div class="collapsible-icon style">
                    <svg
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="0"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <g clip-path="url(#clip0_203_26155)">
                        <path
                          d="M14.4998 6.99994C13.5682 6.98545 12.6689 7.34155 11.9998 7.98994C11.4854 7.50956 10.8403 7.19211 10.1458 7.07756C9.45136 6.96301 8.73851 7.05648 8.09705 7.34621C7.45559 7.63594 6.91418 8.10897 6.54098 8.70575C6.16779 9.30253 5.9795 9.99638 5.99981 10.6999C5.99981 13.9559 10.8738 17.4359 11.4298 17.8209C11.5972 17.9371 11.7961 17.9993 11.9998 17.9993C12.2035 17.9993 12.4024 17.9371 12.5698 17.8209C13.1258 17.4359 17.9998 13.9559 17.9998 10.6999C18.0246 9.74565 17.6701 8.82044 17.0141 8.12695C16.3581 7.43345 15.454 7.0282 14.4998 6.99994ZM11.9998 15.7619C10.2588 14.4319 7.99981 12.2019 7.99981 10.6999C7.92381 8.69394 10.9128 8.29994 10.9998 10.4539V10.9999C10.9998 11.2652 11.1052 11.5195 11.2927 11.707C11.4802 11.8946 11.7346 11.9999 11.9998 11.9999C12.265 11.9999 12.5194 11.8946 12.7069 11.707C12.8945 11.5195 12.9998 11.2652 12.9998 10.9999V10.4539C13.0868 8.30194 16.0758 8.69394 15.9998 10.6999C15.9998 12.1999 13.7408 14.4319 11.9998 15.7619ZM12.8358 0.0279418C11.1215 -0.0918502 9.40154 0.157943 7.79216 0.760424C6.18278 1.3629 4.72158 2.30402 3.5074 3.52009C2.29322 4.73617 1.35439 6.19884 0.754421 7.80915C0.154453 9.41947 -0.0926559 11.1399 0.0298112 12.8539C0.469811 19.2079 6.08181 23.9999 13.0828 23.9999H18.9998C20.3254 23.9984 21.5963 23.4711 22.5336 22.5337C23.4709 21.5964 23.9982 20.3255 23.9998 18.9999V12.3399C24.0369 9.25745 22.9066 6.27503 20.8359 3.99136C18.7651 1.70769 15.9072 0.291807 12.8358 0.0279418ZM21.9998 18.9999C21.9998 19.7956 21.6837 20.5587 21.1211 21.1213C20.5585 21.6839 19.7955 21.9999 18.9998 21.9999H13.0828C7.04881 21.9999 2.39981 18.0999 2.02481 12.7159C1.92215 11.2869 2.12774 9.85257 2.62766 8.50995C3.12758 7.16732 3.91016 5.94779 4.92241 4.93392C5.93466 3.92006 7.15295 3.13554 8.49478 2.63348C9.83661 2.13142 11.2707 1.92355 12.6998 2.02394C15.2663 2.25098 17.6517 3.44085 19.3769 5.3545C21.1021 7.26814 22.0391 9.76376 21.9998 12.3399V18.9999Z"
                          fill="#374957"
                        />
                      </g>
                      <defs>
                        <clipPath id="clip0_203_26155">
                          <rect width="24" height="24" fill="white" />
                        </clipPath>
                      </defs>
                    </svg>
                  </div>
                  <span class="collapsible-title">气泡样式</span>
                </div>
                <svg
                  class="collapsible-chevron"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M6 9l6 6 6-6" />
                </svg>
              </div>
              <div class="collapsible-content">
                <div class="collapsible-inner">
                  <textarea
                    id="chat-bubble-css-input"
                    class="settings-textarea-field"
                    placeholder=".user-bubble { background-color: #007AFF; } ..."
                    rows="5"
                  ></textarea>
                  <div class="bg-action-btns" style="margin-top: 12px">
                    <button
                      id="chat-bubble-preset-btn"
                      class="bg-action-btn primary"
                    >
                      选择预设
                    </button>
                    <button
                      id="chat-bubble-save-btn"
                      class="bg-action-btn secondary"
                    >
                      存为预设
                    </button>
                  </div>
                  <button
                    id="chat-bubble-restore-btn"
                    class="bg-action-btn secondary"
                    style="width: 100%; margin-top: 8px"
                  >
                    恢复默认
                  </button>
                </div>
              </div>
            </div>

            <!-- 5. 头像挂件 (可折叠) -->
            <div class="collapsible-section" data-section="pendant">
              <div class="collapsible-header">
                <div class="collapsible-header-left">
                  <div class="collapsible-icon character">
                    <svg
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="0"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <g clip-path="url(#clip0_203_25925)">
                        <path
                          d="M17.246 6.19301C18.24 5.10476 18.8501 3.72086 18.983 2.25301C19.0215 1.95033 18.9903 1.64284 18.8917 1.35408C18.7931 1.06532 18.6298 0.80295 18.4142 0.587049C18.1986 0.371148 17.9364 0.207442 17.6478 0.108464C17.3592 0.0094849 17.0517 -0.0221426 16.749 0.0160022C15.8385 0.087504 14.9544 0.355535 14.1575 0.801628C13.3606 1.24772 12.6699 1.86127 12.133 2.60001C11.793 1.74937 11.3123 0.962039 10.711 0.271003C10.5244 0.0860312 10.2725 -0.0180701 10.0097 -0.018795C9.747 -0.0195199 9.49452 0.0831899 9.30691 0.267129C9.11929 0.451068 9.0116 0.701456 9.00712 0.964161C9.00265 1.22687 9.10174 1.48078 9.28298 1.671C10.2743 2.90543 10.8545 4.4192 10.942 6.00001H8.49998C6.18088 6.07088 3.98434 7.05774 2.39125 8.74455C0.798158 10.4314 -0.0616804 12.6807 -2.07468e-05 15C-0.161021 20.6 5.64398 25.773 10.75 23.385C11.1399 23.1371 11.5932 23.007 12.0553 23.0103C12.5174 23.0137 12.9687 23.1504 13.355 23.404C14.0078 23.7815 14.746 23.9866 15.5 24C25.764 23.716 27.066 8.58201 17.246 6.19301ZM14.223 3.16801C14.9987 2.4897 15.9727 2.08004 17 2V2C16.918 3.02517 16.5089 3.99689 15.833 4.77201C15.0566 5.44989 14.0825 5.85948 13.055 5.94001C13.1362 4.91448 13.5458 3.94243 14.223 3.16801V3.16801ZM15.5 22C15.0593 21.9831 14.6306 21.8518 14.256 21.619C13.5695 21.2226 12.7926 21.0094 12 21C11.2495 21.0175 10.5151 21.2212 9.86298 21.593C6.00498 23.261 1.89998 19.141 1.99998 15C1.93831 13.211 2.58745 11.4704 3.80548 10.1587C5.02351 8.84697 6.71135 8.07085 8.49998 8.00001H15.5C24.1 8.32101 24.1 21.682 15.5 22Z"
                          fill="#374957"
                        />
                      </g>
                      <defs>
                        <clipPath id="clip0_203_25925">
                          <rect width="24" height="24" fill="white" />
                        </clipPath>
                      </defs>
                    </svg>
                  </div>
                  <span class="collapsible-title">头像挂件</span>
                </div>
                <svg
                  class="collapsible-chevron"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M6 9l6 6 6-6" />
                </svg>
              </div>
              <div class="collapsible-content">
                <div class="collapsible-inner">
                  <div class="character-form-row">
                    <label class="character-form-label">角色 (Char) 挂件</label>
                    <input
                      type="text"
                      id="chat-ai-pendant-url"
                      class="settings-input-field"
                      placeholder="图片URL"
                    />
                    <textarea
                      id="chat-ai-pendant-css"
                      class="settings-textarea-field"
                      style="margin-top: 8px"
                      placeholder="CSS样式..."
                      rows="2"
                    ></textarea>
                    <button
                      id="chat-ai-pendant-clear"
                      class="bg-action-btn secondary"
                      style="width: 100%; margin-top: 8px"
                    >
                      清除设定
                    </button>
                  </div>
                  <div class="character-form-row" style="margin-top: 16px">
                    <label class="character-form-label">用户 (User) 挂件</label>
                    <input
                      type="text"
                      id="chat-user-pendant-url"
                      class="settings-input-field"
                      placeholder="图片URL"
                    />
                    <textarea
                      id="chat-user-pendant-css"
                      class="settings-textarea-field"
                      style="margin-top: 8px"
                      placeholder="CSS样式..."
                      rows="2"
                    ></textarea>
                    <button
                      id="chat-user-pendant-clear"
                      class="bg-action-btn secondary"
                      style="width: 100%; margin-top: 8px"
                    >
                      清除设定
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- 6. 聊天背景 (可折叠) -->
            <div class="collapsible-section" data-section="background">
              <div class="collapsible-header">
                <div class="collapsible-header-left">
                  <div class="collapsible-icon background">
                    <svg
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="0"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <g clip-path="url(#clip0_203_26717)">
                        <path
                          d="M19 0H5C3.6744 0.00158786 2.40356 0.528882 1.46622 1.46622C0.528882 2.40356 0.00158786 3.6744 0 5L0 19C0.00158786 20.3256 0.528882 21.5964 1.46622 22.5338C2.40356 23.4711 3.6744 23.9984 5 24H19C20.3256 23.9984 21.5964 23.4711 22.5338 22.5338C23.4711 21.5964 23.9984 20.3256 24 19V5C23.9984 3.6744 23.4711 2.40356 22.5338 1.46622C21.5964 0.528882 20.3256 0.00158786 19 0V0ZM5 2H19C19.7956 2 20.5587 2.31607 21.1213 2.87868C21.6839 3.44129 22 4.20435 22 5V19C21.9983 19.4455 21.8957 19.8848 21.7 20.285L12.537 11.122C12.0727 10.6576 11.5214 10.2892 10.9147 10.0378C10.308 9.78644 9.65772 9.65707 9.001 9.65707C8.34428 9.65707 7.69399 9.78644 7.08728 10.0378C6.48056 10.2892 5.92931 10.6576 5.465 11.122L2 14.586V5C2 4.20435 2.31607 3.44129 2.87868 2.87868C3.44129 2.31607 4.20435 2 5 2V2ZM5 22C4.20435 22 3.44129 21.6839 2.87868 21.1213C2.31607 20.5587 2 19.7956 2 19V17.414L6.878 12.536C7.1566 12.2572 7.4874 12.0361 7.85151 11.8852C8.21561 11.7343 8.60587 11.6566 9 11.6566C9.39413 11.6566 9.78439 11.7343 10.1485 11.8852C10.5126 12.0361 10.8434 12.2572 11.122 12.536L20.285 21.7C19.8848 21.8957 19.4455 21.9983 19 22H5Z"
                          fill="#374957"
                        />
                        <path
                          d="M16.0001 10.4997C16.6924 10.4997 17.369 10.2944 17.9446 9.9098C18.5202 9.52521 18.9688 8.97858 19.2337 8.33904C19.4986 7.6995 19.5679 6.99577 19.4329 6.31684C19.2978 5.6379 18.9645 5.01426 18.475 4.52478C17.9855 4.03529 17.3619 3.70195 16.6829 3.5669C16.004 3.43185 15.3003 3.50117 14.6607 3.76607C14.0212 4.03098 13.4746 4.47958 13.09 5.05516C12.7054 5.63073 12.5001 6.30742 12.5001 6.99965C12.5001 7.92791 12.8689 8.81815 13.5252 9.47452C14.1816 10.1309 15.0719 10.4997 16.0001 10.4997V10.4997ZM16.0001 5.49965C16.2968 5.49965 16.5868 5.58762 16.8335 5.75245C17.0802 5.91727 17.2724 6.15154 17.3859 6.42563C17.4995 6.69972 17.5292 7.00132 17.4713 7.29229C17.4134 7.58326 17.2706 7.85053 17.0608 8.06031C16.851 8.27009 16.5837 8.41295 16.2928 8.47083C16.0018 8.52871 15.7002 8.499 15.4261 8.38547C15.152 8.27194 14.9177 8.07968 14.7529 7.83301C14.5881 7.58633 14.5001 7.29632 14.5001 6.99965C14.5001 6.60183 14.6582 6.2203 14.9395 5.93899C15.2208 5.65769 15.6023 5.49965 16.0001 5.49965V5.49965Z"
                          fill="#374957"
                        />
                      </g>
                      <defs>
                        <clipPath id="clip0_203_26717">
                          <rect width="24" height="24" fill="white" />
                        </clipPath>
                      </defs>
                    </svg>
                  </div>
                  <span class="collapsible-title">聊天背景</span>
                </div>
                <svg
                  class="collapsible-chevron"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M6 9l6 6 6-6" />
                </svg>
              </div>
              <div class="collapsible-content">
                <div class="collapsible-inner">
                  <div class="bg-selector-wrapper">
                    <div
                      id="chat-bg-preview-box"
                      class="bg-preview-box"
                      onclick="document.getElementById('chat-bg-input').click()"
                    >
                      <img
                        id="chat-bg-preview"
                        src=""
                        style="
                          width: 100%;
                          height: 100%;
                          object-fit: cover;
                          display: none;
                          border-radius: 10px;
                        "
                      />
                      <div
                        id="chat-bg-placeholder"
                        class="bg-preview-placeholder"
                      >
                        <svg
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                        >
                          <rect
                            x="3"
                            y="3"
                            width="18"
                            height="18"
                            rx="2"
                            ry="2"
                          />
                          <circle cx="8.5" cy="8.5" r="1.5" />
                          <polyline points="21 15 16 10 5 21" />
                        </svg>
                        <span>点击选择背景图片</span>
                      </div>
                    </div>
                    <input
                      type="file"
                      id="chat-bg-input"
                      accept="image/*"
                      style="display: none"
                    />
                    <div class="bg-action-btns">
                      <button
                        id="chat-upload-bg-btn"
                        class="bg-action-btn primary"
                        onclick="document.getElementById('chat-bg-input').click()"
                      >
                        选择图片
                      </button>
                      <button
                        id="chat-clear-bg-btn"
                        class="bg-action-btn secondary"
                      >
                        恢复默认
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- 7. 其他设置 (可折叠) -->
            <div class="collapsible-section" data-section="other">
              <div class="collapsible-header">
                <div class="collapsible-header-left">
                  <div class="collapsible-icon other">
                    <svg
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="0"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <g clip-path="url(#clip0_203_26374)">
                        <path
                          d="M12.0001 16.0002C10.9392 16.0002 9.92178 15.5788 9.17163 14.8286C8.42148 14.0785 8.00006 13.0611 8.00006 12.0002C8.00006 10.9393 8.42148 9.92192 9.17163 9.17178C9.92178 8.42163 10.9392 8.0002 12.0001 8.0002C13.0609 8.0002 14.0783 8.42163 14.8285 9.17178C15.5786 9.92192 16.0001 10.9393 16.0001 12.0002C16.0001 13.0611 15.5786 14.0785 14.8285 14.8286C14.0783 15.5788 13.0609 16.0002 12.0001 16.0002ZM12.0001 10.0002C11.4696 10.0002 10.9609 10.2109 10.5858 10.586C10.2108 10.9611 10.0001 11.4698 10.0001 12.0002C10.0001 12.5306 10.2108 13.0393 10.5858 13.4144C10.9609 13.7895 11.4696 14.0002 12.0001 14.0002C12.5305 14.0002 13.0392 13.7895 13.4143 13.4144C13.7893 13.0393 14.0001 12.5306 14.0001 12.0002C14.0001 11.4698 13.7893 10.9611 13.4143 10.586C13.0392 10.2109 12.5305 10.0002 12.0001 10.0002ZM12.0001 24.0002C10.9092 23.9991 9.84859 23.6417 8.97946 22.9825C8.11034 22.3233 7.48026 21.3983 7.18506 20.3482C6.12973 20.5812 5.02756 20.4712 4.03912 20.0342C3.05067 19.5972 2.2276 18.8559 1.6898 17.9185C1.152 16.981 0.927569 15.8964 1.04921 14.8225C1.17085 13.7486 1.6322 12.7416 2.36606 11.9482C-1.03394 8.4372 2.37506 2.3482 7.20006 3.5992C7.51129 2.56836 8.14611 1.6651 9.01059 1.02308C9.87506 0.381066 10.9233 0.0344086 12.0001 0.0344086C13.0769 0.0344086 14.1251 0.381066 14.9895 1.02308C15.854 1.6651 16.4888 2.56836 16.8001 3.5992C21.7001 2.3832 25.0001 8.4122 21.6291 11.9912C25.0371 15.5292 21.6401 21.4332 16.8151 20.3482C16.5199 21.3983 15.8898 22.3233 15.0207 22.9825C14.1515 23.6417 13.0909 23.9991 12.0001 24.0002ZM8.00006 18.0002C8.26527 18.0002 8.51963 18.1056 8.70716 18.2931C8.8947 18.4806 9.00006 18.735 9.00006 19.0002C9.00006 19.7959 9.31613 20.5589 9.87874 21.1215C10.4413 21.6841 11.2044 22.0002 12.0001 22.0002C12.7957 22.0002 13.5588 21.6841 14.1214 21.1215C14.684 20.5589 15.0001 19.7959 15.0001 19.0002C15 18.824 15.0464 18.651 15.1347 18.4985C15.223 18.3461 15.35 18.2197 15.5029 18.1321C15.6557 18.0445 15.829 17.9989 16.0051 17.9998C16.1813 18.0006 16.3541 18.0481 16.5061 18.1372C19.9721 19.8122 22.9061 14.9552 19.5221 12.8782C19.3659 12.7909 19.2359 12.6635 19.1454 12.5091C19.0548 12.3548 19.0071 12.1791 19.0071 12.0002C19.0071 11.8213 19.0548 11.6456 19.1454 11.4913C19.2359 11.3369 19.3659 11.2095 19.5221 11.1222C22.8351 9.1132 20.0441 3.9032 16.5031 5.8682C16.3508 5.95681 16.1779 6.00362 16.0017 6.00392C15.8256 6.00422 15.6525 5.95798 15.4999 5.86989C15.3474 5.78179 15.2208 5.65497 15.1331 5.50226C15.0453 5.34954 14.9994 5.17635 15.0001 5.0002C15.0001 4.20455 14.684 3.44149 14.1214 2.87888C13.5588 2.31627 12.7957 2.0002 12.0001 2.0002C11.2044 2.0002 10.4413 2.31627 9.87874 2.87888C9.31613 3.44149 9.00006 4.20455 9.00006 5.0002C9.0004 5.17591 8.95445 5.3486 8.86682 5.5009C8.7792 5.65319 8.65299 5.77971 8.50091 5.86771C8.34884 5.95571 8.17626 6.00209 8.00055 6.00218C7.82485 6.00227 7.65222 5.95606 7.50006 5.8682C4.00006 3.9082 1.13806 9.0802 4.47806 11.0702C4.63419 11.1577 4.76418 11.2852 4.85466 11.4396C4.94514 11.594 4.99283 11.7697 4.99283 11.9487C4.99283 12.1277 4.94514 12.3034 4.85466 12.4578C4.76418 12.6122 4.63419 12.7397 4.47806 12.8272C1.13006 14.9402 3.96406 19.8002 7.49406 18.1372C7.64754 18.0474 7.82221 18.0001 8.00006 18.0002Z"
                          fill="#374957"
                        />
                      </g>
                      <defs>
                        <clipPath id="clip0_203_26374">
                          <rect width="24" height="24" fill="white" />
                        </clipPath>
                      </defs>
                    </svg>
                  </div>
                  <span class="collapsible-title">其他设置</span>
                </div>
                <svg
                  class="collapsible-chevron"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M6 9l6 6 6-6" />
                </svg>
              </div>
              <div class="collapsible-content">
                <div class="collapsible-inner">
                  <div class="character-form-row">
                    <label class="character-form-label"
                      >MiniMax TTS 音色ID</label
                    >
                    <input
                      type="text"
                      id="chat-tts-voice-input"
                      class="settings-input-field"
                      placeholder="例如: female-shaonv"
                    />
                    <small
                      style="
                        color: #999;
                        font-size: 12px;
                        margin-top: 6px;
                        display: block;
                        line-height: 1.4;
                      "
                    >
                      留空则使用默认音色。
                    </small>
                  </div>
                  <div class="character-form-row" style="margin-top: 12px">
                    <label class="character-form-label">MiniMax TTS 语种</label>
                    <select
                      id="chat-tts-language-input"
                      class="settings-input-field"
                      style="appearance: auto; padding-right: 30px"
                    >
                      <option value="">自动识别 (Auto)</option>
                      <option value="zh-CN">中文 (Chinese)</option>
                      <option value="zh-HK">粤语 (Cantonese)</option>
                      <option value="en-US">英文 (English)</option>
                      <option value="ja-JP">日语 (Japanese)</option>
                      <option value="ko-KR">韩语 (Korean)</option>
                      <option value="de-DE">德语 (German)</option>
                      <option value="fr-FR">法语 (French)</option>
                      <option value="es-ES">西班牙语 (Spanish)</option>
                      <option value="pt-BR">葡萄牙语 (Portuguese)</option>
                      <option value="ru-RU">俄语 (Russian)</option>
                      <option value="tr-TR">土耳其语 (Turkish)</option>
                      <option value="nl-NL">荷兰语 (Dutch)</option>
                      <option value="it-IT">意大利语 (Italian)</option>
                      <option value="vi-VN">越南语 (Vietnamese)</option>
                      <option value="id-ID">印尼语 (Indonesian)</option>
                      <option value="th-TH">泰语 (Thai)</option>
                      <option value="ms-MY">马来语 (Malay)</option>
                      <option value="ar-SA">阿拉伯语 (Arabic)</option>
                      <option value="hi-IN">印地语 (Hindi)</option>
                      <option value="pl-PL">波兰语 (Polish)</option>
                      <option value="sv-SE">瑞典语 (Swedish)</option>
                      <option value="fi-FI">芬兰语 (Finnish)</option>
                      <option value="da-DK">丹麦语 (Danish)</option>
                    </select>
                    <small
                      style="
                        color: #999;
                        font-size: 12px;
                        margin-top: 6px;
                        display: block;
                        line-height: 1.4;
                      "
                    >
                      指定TTS生成的语种，留空为自动识别。
                    </small>
                  </div>
                </div>
              </div>
            </div>

            <!-- 8. 危险操作 (可折叠) -->
            <div class="collapsible-section" data-section="danger">
              <div class="collapsible-header">
                <div class="collapsible-header-left">
                  <div class="collapsible-icon danger">
                    <svg
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <path
                        d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"
                      />
                      <line x1="12" y1="9" x2="12" y2="13" />
                      <line x1="12" y1="17" x2="12.01" y2="17" />
                    </svg>
                  </div>
                  <span class="collapsible-title">危险操作</span>
                </div>
                <svg
                  class="collapsible-chevron"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M6 9l6 6 6-6" />
                </svg>
              </div>
              <div class="collapsible-content">
                <div class="collapsible-inner">
                  <div class="danger-actions-wrapper">
                    <button id="chat-block-btn" class="danger-btn purple">
                      拉黑联系人
                    </button>
                    <button id="chat-clear-history-btn" class="danger-btn red">
                      清空聊天记录
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="notification-banner-container"></div>
      </div>

      <div id="msg-action-menu">
        <button class="action-menu-btn" id="menu-reply-btn">
          <svg
            width="20"
            height="20"
            viewBox="0 0 28 28"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <g clip-path="url(#clip0_201_73165)">
              <path
                d="M12.4492 24.4922C13.2461 24.4922 13.8203 23.9062 13.8203 23.1211V18.6445H14.1602C18.707 18.6445 21.5664 19.793 23.6172 23.625C24.0273 24.375 24.5664 24.4922 25.0586 24.4922C25.6797 24.4922 26.2656 23.9297 26.2656 22.9219C26.2656 14.2617 22.5977 8.85938 14.1602 8.85938H13.8203V4.42969C13.8203 3.64453 13.2461 3 12.4258 3C11.8516 3 11.4648 3.24609 10.8438 3.83203L1.59766 12.4805C1.14062 12.9141 1 13.3477 1 13.7461C1 14.1328 1.15234 14.5781 1.59766 15L10.8438 23.7305C11.4062 24.2578 11.875 24.4922 12.4492 24.4922ZM11.7812 21.9727C11.7109 21.9727 11.6406 21.9375 11.582 21.8672L3.22656 13.9688C3.13281 13.875 3.09766 13.8164 3.09766 13.7461C3.09766 13.6758 3.13281 13.6055 3.22656 13.5234L11.5703 5.51953C11.6289 5.47266 11.6992 5.42578 11.7695 5.42578C11.875 5.42578 11.9336 5.49609 11.9336 5.58984V10.2422C11.9336 10.5117 12.0625 10.6289 12.332 10.6289H13.9023C21.9414 10.6289 24.3672 16.207 24.6016 21.7383C24.6016 21.832 24.5664 21.8672 24.5078 21.8672C24.4609 21.8672 24.4375 21.832 24.4023 21.75C23.0195 18.8086 19.4688 16.875 13.9023 16.875H12.332C12.0625 16.875 11.9336 16.9922 11.9336 17.2617V21.7969C11.9336 21.9023 11.875 21.9727 11.7812 21.9727Z"
                fill="white"
                fill-opacity="0.85"
              />
            </g>
            <defs>
              <clipPath id="clip0_201_73165">
                <rect
                  width="25.2656"
                  height="21.5039"
                  fill="white"
                  transform="translate(1 3)"
                />
              </clipPath>
            </defs>
          </svg>

          <span>引用</span>
        </button>
        <button class="action-menu-btn" id="menu-select-btn">
          <svg
            width="20"
            height="20"
            viewBox="0 0 28 28"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <g clip-path="url(#clip0_201_97850)">
              <path
                d="M14.6055 21.5352H26.3711C26.8633 21.5352 27.2734 21.1484 27.2734 20.6562C27.2734 20.1523 26.8633 19.7656 26.3711 19.7656H14.6055C14.1133 19.7656 13.7148 20.1523 13.7148 20.6562C13.7148 21.1484 14.1133 21.5352 14.6055 21.5352Z"
                fill="white"
                fill-opacity="0.85"
              />
              <path
                d="M6.05078 25.707C8.80469 25.707 11.1016 23.4102 11.1016 20.6562C11.1016 17.8789 8.80469 15.5938 6.05078 15.5938C3.28516 15.5938 1 17.8906 1 20.6562C1 23.4102 3.29688 25.707 6.05078 25.707ZM6.05078 23.996C4.23438 23.996 2.71094 22.4609 2.71094 20.6562C2.71094 18.8398 4.24609 17.3047 6.05078 17.3047C7.85547 17.3047 9.39062 18.8398 9.39062 20.6562C9.39062 22.4609 7.85547 23.996 6.05078 23.996Z"
                fill="white"
                fill-opacity="0.85"
              />
              <path
                d="M14.6055 7.98828H26.3711C26.8633 7.98828 27.2734 7.60156 27.2734 7.09766C27.2734 6.60547 26.8633 6.21875 26.3711 6.21875H14.6055C14.1133 6.21875 13.7148 6.60547 13.7148 7.09766C13.7148 7.60156 14.1133 7.98828 14.6055 7.98828Z"
                fill="white"
                fill-opacity="0.85"
              />
              <path
                d="M6.05078 12.1367C8.80469 12.1367 11.1016 9.85156 11.1016 7.09766C11.1016 4.33203 8.80469 2.03516 6.05078 2.03516C3.28516 2.03516 1 4.33203 1 7.09766C1 9.85156 3.29688 12.1367 6.05078 12.1367ZM5.45312 9.80469C5.20703 9.80469 5.04297 9.67578 4.86719 9.47656L3.55469 7.89453C3.4375 7.76562 3.40234 7.625 3.40234 7.4375C3.40234 7.09766 3.66016 6.82812 3.97656 6.82812C4.19922 6.82812 4.36328 6.92188 4.51562 7.12109L5.42969 8.28125L7.51562 4.92969C7.65625 4.71875 7.83203 4.60156 8.04297 4.60156C8.37109 4.60156 8.65234 4.85938 8.65234 5.15234C8.65234 5.31641 8.60547 5.45703 8.5 5.63281L6.05078 9.47656C5.92188 9.6875 5.71094 9.80469 5.45312 9.80469Z"
                fill="white"
                fill-opacity="0.85"
              />
            </g>
            <defs>
              <clipPath id="clip0_201_97850">
                <rect
                  width="26.2734"
                  height="23.707"
                  fill="white"
                  transform="translate(1 2)"
                />
              </clipPath>
            </defs>
          </svg>

          <span>多选</span>
        </button>

        <button class="action-menu-btn" id="menu-copy-btn">
          <svg
            width="20"
            height="20"
            viewBox="0 0 28 30"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <g clip-path="url(#clip0_201_80501)">
              <path
                d="M20.1301 3.08969C19.7082 0.675623 18.302 -0.320471 15.9231 0.0896854L5.03637 2.01156C2.65746 2.43344 1.67309 3.83969 2.09496 6.26547L4.87231 22.0389C5.3059 24.4295 6.71215 25.4373 9.09106 25.0272L19.9778 23.1053C22.345 22.6834 23.3411 21.2655 22.9075 18.8514L20.1301 3.08969ZM18.2903 3.44125L21.0442 19.1444C21.2434 20.2928 20.7512 21.0545 19.5559 21.2655L8.85668 23.1522C7.66137 23.3631 6.93481 22.8241 6.72387 21.6756L3.95824 5.9725C3.75902 4.81234 4.26293 4.06234 5.45824 3.8514L16.1457 1.96469C17.3411 1.75375 18.0676 2.28109 18.2903 3.44125Z"
                fill="white"
                fill-opacity="0.85"
              />
              <path
                d="M26.7864 9.69898C26.7864 7.24976 25.5793 6.01929 23.1536 6.01929H12.1028C9.68872 6.01929 8.46997 7.24976 8.46997 9.69898V25.7068C8.46997 28.156 9.68872 29.3865 12.1028 29.3865H23.1536C25.5676 29.3865 26.7864 28.156 26.7864 25.7068V9.69898Z"
                fill="white"
              />
              <path
                d="M26.7864 9.69898C26.7864 7.24976 25.5793 6.01929 23.1536 6.01929H12.1028C9.68872 6.01929 8.46997 7.24976 8.46997 9.69898V25.7068C8.46997 28.156 9.68872 29.3865 12.1028 29.3865H23.1536C25.5676 29.3865 26.7864 28.156 26.7864 25.7068V9.69898ZM24.8996 9.73414V25.6833C24.8996 26.8318 24.2786 27.4997 23.0598 27.4997H12.2082C10.9895 27.4997 10.3567 26.8318 10.3567 25.6833V9.73414C10.3567 8.56226 10.9895 7.90601 12.2082 7.90601H23.0598C24.2786 7.90601 24.8996 8.56226 24.8996 9.73414Z"
                fill="white"
                fill-opacity="0.85"
              />
            </g>
            <defs>
              <clipPath id="clip0_201_80501">
                <rect
                  width="24.7864"
                  height="29.6286"
                  fill="white"
                  transform="translate(2)"
                />
              </clipPath>
            </defs>
          </svg>

          <span>复制</span>
        </button>
        <button class="action-menu-btn" id="menu-delete-btn">
          <svg
            width="20"
            height="20"
            viewBox="0 0 28 29"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <g clip-path="url(#clip0_201_71865)">
              <path
                d="M10.875 22.3242C11.3203 22.3242 11.6133 22.043 11.6016 21.6328L11.2383 9.09375C11.2266 8.68359 10.9336 8.41406 10.5117 8.41406C10.0664 8.41406 9.77344 8.69531 9.78516 9.10547L10.1367 21.6328C10.1484 22.0547 10.4414 22.3242 10.875 22.3242ZM14.3438 22.3242C14.7891 22.3242 15.1055 22.043 15.1055 21.6328V9.10547C15.1055 8.69531 14.7891 8.41406 14.3438 8.41406C13.8984 8.41406 13.5938 8.69531 13.5938 9.10547V21.6328C13.5938 22.043 13.8984 22.3242 14.3438 22.3242ZM17.8242 22.3242C18.2461 22.3242 18.5391 22.0547 18.5508 21.6328L18.9023 9.10547C18.9141 8.69531 18.6211 8.41406 18.1758 8.41406C17.7539 8.41406 17.4609 8.68359 17.4492 9.10547L17.0977 21.6328C17.0859 22.043 17.3789 22.3242 17.8242 22.3242ZM9.19922 5.35547H11.0625V2.84766C11.0625 2.17969 11.5312 1.74609 12.2344 1.74609H16.4297C17.1328 1.74609 17.6016 2.17969 17.6016 2.84766V5.35547H19.4648V2.73047C19.4648 1.03125 18.3633 0 16.5586 0H12.1055C10.3008 0 9.19922 1.03125 9.19922 2.73047V5.35547ZM3.87891 6.29297H24.8203C25.3008 6.29297 25.6875 5.88281 25.6875 5.40234C25.6875 4.92188 25.3008 4.52344 24.8203 4.52344H3.87891C3.41016 4.52344 3 4.92188 3 5.40234C3 5.89453 3.41016 6.29297 3.87891 6.29297ZM8.97656 26.0977H19.7227C21.3984 26.0977 22.5234 25.0078 22.6055 23.332L23.4258 6.07031H21.5391L20.7539 23.1328C20.7305 23.8359 20.2266 24.3281 19.5352 24.3281H9.14062C8.47266 24.3281 7.96875 23.8242 7.93359 23.1328L7.10156 6.07031H5.26172L6.09375 23.3438C6.17578 25.0195 7.27734 26.0977 8.97656 26.0977Z"
                fill="white"
                fill-opacity="1"
              />
            </g>
            <defs>
              <clipPath id="clip0_201_71865">
                <rect
                  width="22.6875"
                  height="28.1836"
                  fill="white"
                  transform="translate(3)"
                />
              </clipPath>
            </defs>
          </svg>
          <span>删除</span>
        </button>
      </div>
    </div>

    <!-- === 新增：语音输入弹出面板 === -->
    <div id="voice-input-panel" class="voice-panel-overlay">
      <div class="voice-panel-content">
        <div class="voice-panel-header">
          <!-- 动态波纹动画 -->
          <div class="voice-waveform-indicator">
            <div class="waveform-bar"></div>
            <div class="waveform-bar"></div>
            <div class="waveform-bar"></div>
            <div class="waveform-bar"></div>
            <div class="waveform-bar"></div>
          </div>
        </div>
        <!-- 用于显示实时转录文字的区域 -->
        <textarea
          id="voice-transcript-preview"
          placeholder="请在此输入文字..."
        ></textarea>
        <div class="voice-panel-footer">
          <button id="cancel-voice-input-btn" class="voice-panel-button cancel">
            取消
          </button>
          <button id="send-voice-input-btn" class="voice-panel-button send">
            发送
          </button>
        </div>
      </div>
    </div>

    <!-- 保留旧的 group-info-modal ID 用于兼容性 (隐藏的占位符) -->
    <div id="group-info-modal" style="display: none"></div>

    <div
      id="edit-member-modal"
      class="modal-overlay"
      style="display: none; z-index: 1100"
    >
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="edit-member-title">编辑信息</h2>
          <button id="edit-member-close-btn" class="modal-close-button">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <div class="avatar-uploader">
            <img src="" id="edit-member-preview" class="avatar-preview" />
            <input
              type="file"
              id="edit-member-avatar-input"
              class="avatar-input"
              accept="image/*"
            />
            <label for="edit-member-avatar-input" class="avatar-upload-label"
              >点击更换头像</label
            >
          </div>
          <div class="form-group">
            <label>名称</label>
            <input
              type="text"
              id="edit-member-name-input"
              class="form-input"
              placeholder="名称"
            />
          </div>
          <div class="form-group">
            <label>人设/备注</label>
            <textarea
              id="edit-member-persona-input"
              class="form-textarea"
              placeholder="输入人设或备注..."
              style="height: 100px"
            ></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button id="save-member-btn" class="save-button">保存</button>
        </div>
      </div>
    </div>

    <div
      id="add-group-member-modal"
      class="modal-overlay"
      style="display: none; z-index: 1100"
    >
      <div class="modal-content">
        <div class="modal-header">
          <h2>新建群角色</h2>
          <button id="add-member-close-btn" class="modal-close-button">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <div class="avatar-uploader">
            <img
              src="https://placehold.co/100x100/EFEFEF/AAAAAA?text=Char"
              id="new-member-avatar-preview"
              class="avatar-preview"
            />
            <input
              type="file"
              id="new-member-avatar-input"
              class="avatar-input"
              accept="image/*"
            />
            <label for="new-member-avatar-input" class="avatar-upload-label"
              >上传头像</label
            >
          </div>
          <div class="form-group">
            <label>角色名称</label>
            <input
              type="text"
              id="new-member-name"
              class="form-input"
              placeholder="角色名称"
            />
          </div>
          <div class="form-group">
            <label>角色人设</label>
            <textarea
              id="new-member-persona"
              class="form-textarea"
              placeholder="角色人设..."
              style="height: 100px"
            ></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button id="save-new-member-btn" class="save-button">确定</button>
        </div>
      </div>
    </div>

    <div
      id="edit-group-user-modal"
      class="modal-overlay"
      style="display: none; z-index: 1100"
    >
      <div class="modal-content">
        <div class="modal-header">
          <h2>修改我的群名片</h2>
          <button id="close-group-user-modal" class="modal-close-button">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <div class="avatar-uploader">
            <img src="" id="edit-group-user-preview" class="avatar-preview" />
            <input
              type="file"
              id="edit-group-user-avatar-input"
              class="avatar-input"
              accept="image/*"
            />
            <label
              for="edit-group-user-avatar-input"
              class="avatar-upload-label"
              >更换头像</label
            >
          </div>
          <div class="form-group">
            <label>我在本群的昵称</label>
            <input
              type="text"
              id="edit-group-user-name-input"
              class="form-input"
              placeholder="输入昵称"
            />
          </div>
          <div class="form-group">
            <label>我在本群的人设/备注</label>
            <textarea
              id="edit-group-user-persona-input"
              class="form-textarea"
              placeholder="例如：高冷、逗比..."
              style="height: 80px"
            ></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button id="save-group-user-btn" class="save-button">保存</button>
        </div>
      </div>
    </div>

    <div id="forward-target-modal" class="modal-overlay" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h2>选择转发对象</h2>
          <button id="forward-modal-close-btn" class="modal-close-button">
            &times;
          </button>
        </div>
        <div
          class="modal-body"
          id="forward-target-list"
          style="padding: 0; max-height: 400px; overflow-y: auto"
        ></div>
      </div>
    </div>
    <div
      id="history-detail-overlay"
      class="modal-overlay"
      style="display: none; background: #fff"
    >
      <div
        style="width: 100%; height: 100%; display: flex; flex-direction: column"
      >
        <div
          class="settings-header"
          style="
            background: #f5f5f7 !important;
            position: relative !important;
            top: 0;
            padding-top: 50px !important;
            height: auto !important;
            min-height: 44px;
            display: flex !important;
            align-items: center !important;
            justify-content: space-between !important;
            border-bottom: 1px solid #e5e5e5;
          "
        >
          <button id="history-detail-close-btn" class="header-icon-button">
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M15 18l-6-6 6-6" />
            </svg>
          </button>
          <h1
            id="history-detail-title"
            style="color: #000; font-size: 17px; font-weight: 600"
          >
            聊天记录
          </h1>
          <div style="width: 40px"></div>
        </div>

        <div
          id="history-detail-content"
          style="
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background-color: #f5f5f7;
          "
        ></div>
      </div>
    </div>

    <!-- 气泡预设快速选择弹窗 (在body层级) -->
    <div
      id="bubble-preset-select-modal"
      style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 99999;
        justify-content: center;
        align-items: center;
      "
    >
      <div
        style="
          max-height: 70%;
          max-width: 350px;
          width: 90%;
          background: #fff;
          border-radius: 14px;
          overflow: hidden;
          display: flex;
          flex-direction: column;
        "
      >
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
          "
        >
          <h2 style="margin: 0; font-size: 17px; font-weight: 600">
            选择气泡预设
          </h2>
          <button
            id="bubble-preset-select-close-btn"
            style="
              background: none;
              border: none;
              font-size: 24px;
              cursor: pointer;
              color: #999;
            "
          >
            &times;
          </button>
        </div>
        <div
          style="flex: 1; overflow-y: auto; padding: 10px 0; max-height: 300px"
        >
          <div id="bubble-preset-select-list"></div>
          <div
            id="bubble-preset-select-empty"
            style="text-align: center; padding: 40px 20px; color: #8e8e93"
          >
            <p style="margin: 0; font-size: 14px">暂无预设</p>
            <p style="margin: 8px 0 0 0; font-size: 12px">
              请先保存一些气泡样式预设
            </p>
          </div>
        </div>
      </div>
    </div>

    <div id="anywhere-door-modal" class="modal-overlay" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h2>任意门 (动作/旁白)</h2>
          <button id="anywhere-door-close-btn" class="modal-close-button">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <p style="font-size: 13px; color: #666; margin-bottom: 10px">
            输入一段动作描述、时间流逝或心理活动（不会显示为气泡）：
          </p>
          <input
            type="text"
            id="anywhere-door-input"
            class="form-input"
            placeholder="例如：过去了三天... / 轻轻抱住你..."
          />
        </div>
        <div class="modal-footer">
          <button id="send-action-msg-btn" class="save-button">发送</button>
        </div>
      </div>
    </div>

    <!-- 飞行棋游戏悬浮窗 -->
    <div
      id="ludo-game-modal"
      class="ludo-floating-window"
      style="display: none"
    >
      <div class="ludo-console-frame">
        <!-- 游戏机顶部装饰 -->
        <div class="ludo-console-top-decor">
          <div class="console-led"></div>
          <div class="console-led"></div>
          <div class="console-led"></div>
        </div>

        <!-- 游戏头部 -->
        <div class="ludo-header">
          <span class="ludo-title">✈️ 飞行棋</span>
          <div class="ludo-header-actions">
            <button
              id="ludo-export-css-btn"
              class="ludo-action-btn"
              title="导出CSS样式"
            >
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
              </svg>
            </button>
            <button id="ludo-close-btn" class="ludo-close-btn">
              <svg
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </div>
        </div>

        <!-- 玩家区域 -->
        <div class="ludo-players">
          <div class="ludo-player ai-player">
            <img
              id="ludo-ai-avatar"
              class="ludo-player-avatar"
              src=""
              alt="AI"
            />
            <div id="ludo-ai-bubble" class="ludo-player-bubble">准备起飞~</div>
          </div>
          <div class="ludo-player user-player">
            <div id="ludo-user-bubble" class="ludo-player-bubble">出发吧！</div>
            <img
              id="ludo-user-avatar"
              class="ludo-player-avatar"
              src=""
              alt="User"
            />
          </div>
        </div>

        <!-- 骰子区域 -->
        <div class="ludo-dice-area">
          <div id="ludo-dice" class="ludo-dice">
            <div class="dice-face" data-face="1">
              <span class="dot center"></span>
            </div>
          </div>
          <div id="ludo-status" class="ludo-status">选择先手开始游戏</div>
        </div>

        <!-- 棋盘区域 (30格田字形) -->
        <div class="ludo-board-container">
          <svg id="ludo-board" class="ludo-board" viewBox="0 0 280 280">
            <!-- 棋盘格子将由JS动态生成 -->
          </svg>
        </div>

        <!-- 游戏控制区 -->
        <div class="ludo-controls">
          <div id="ludo-start-panel" class="ludo-start-panel">
            <button id="ludo-user-first-btn" class="ludo-btn primary">
              我先飞
            </button>
            <button id="ludo-ai-first-btn" class="ludo-btn secondary">
              TA先飞
            </button>
          </div>
          <button
            id="ludo-roll-btn"
            class="ludo-btn roll-btn"
            style="display: none"
          >
            🎲 掷骰子
          </button>
          <!-- 聊天输入 -->
          <div
            id="ludo-chat-input-container"
            class="ludo-chat-input-container"
            style="display: none"
          >
            <input
              type="text"
              id="ludo-chat-input"
              class="ludo-chat-input"
              placeholder="说点什么..."
            />
            <button id="ludo-send-chat-btn" class="ludo-send-btn">
              <svg
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <line x1="22" y1="2" x2="11" y2="13"></line>
                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
              </svg>
            </button>
          </div>
          <button id="ludo-restart-btn" class="ludo-btn" style="display: none">
            再来一局
          </button>
        </div>

        <!-- 游戏机底部装饰 -->
        <div class="ludo-console-bottom-decor">
          <div class="console-dpad"></div>
          <div class="console-buttons">
            <div class="console-btn-a">A</div>
            <div class="console-btn-b">B</div>
          </div>
        </div>
      </div>
    </div>

    <!-- === 记忆功能弹窗 === -->
    <div id="memory-modal" class="memory-modal" style="display: none">
      <div class="memory-modal-overlay"></div>
      <div class="memory-modal-content">
        <!-- 关闭按钮 -->
        <button id="memory-close-btn" class="memory-close-btn">
          <svg
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M18 6L6 18M6 6l12 12"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
            />
          </svg>
        </button>

        <div class="memory-right-page">
          <!-- 顶栏Tab切换 -->
          <div class="memory-tab-bar">
            <button class="memory-tab active" data-tab="retrospect">
              回溯
            </button>
            <button class="memory-tab" data-tab="bonds">羁绊</button>
            <div class="memory-tab-indicator"></div>
          </div>

          <!-- 回溯界面 -->
          <div id="memory-retrospect-panel" class="memory-panel active">
            <!-- 统计信息 -->
            <div class="memory-stats-card">
              <div class="memory-stat-item">
                <span class="memory-stat-label">当前记录数:</span>
                <span id="memory-total-count" class="memory-stat-value">0</span>
              </div>
              <div class="memory-stat-item">
                <span class="memory-stat-label">上次总结位置:</span>
                <span id="memory-last-summarized" class="memory-stat-value"
                  >0</span
                >
              </div>
              <div class="memory-stat-item">
                <span class="memory-stat-label">未处理记录:</span>
                <span id="memory-unprocessed-count" class="memory-stat-value"
                  >0</span
                >
              </div>
            </div>

            <!-- 选择记录数量 -->
            <div class="memory-form-group">
              <label for="memory-message-count">选择最近的记录数:</label>
              <input
                type="number"
                id="memory-message-count"
                class="memory-input"
                value="20"
                min="1"
                max="200"
              />
            </div>

            <!-- 模型选择 (带拉取按钮) -->
            <div class="memory-form-group">
              <label for="memory-model-select">选择总结模型:</label>
              <div class="memory-input-group">
                <select id="memory-model-select" class="memory-select">
                  <option value="">加载中...</option>
                </select>
                <button
                  id="memory-fetch-models-btn"
                  class="memory-icon-btn"
                  title="拉取API模型列表"
                >
                  <svg
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path
                      d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"
                    />
                  </svg>
                </button>
              </div>
            </div>

            <!-- Prompt编辑器 -->
            <div class="memory-form-group">
              <label for="memory-prompt-input">总结Prompt:</label>
              <textarea
                id="memory-prompt-input"
                class="memory-textarea"
                rows="6"
                placeholder="你是一位专业的内容总结大师,请根据以下聊天记录进行总结..."
              ></textarea>
            </div>

            <!-- 总结按钮 -->
            <button id="memory-summarize-btn" class="memory-btn-primary">
              <svg
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
              <span>开始总结</span>
            </button>
          </div>

          <!-- 羁绊界面 (记忆支票列表) -->
          <div id="memory-bonds-panel" class="memory-panel">
            <div id="memory-cheques-container" class="memory-cheques-container">
              <!-- 支票卡片将通过JS动态添加 -->
              <div class="memory-empty-state">
                <svg
                  width="64"
                  height="64"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    opacity="0.4"
                    d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2Z"
                    fill="currentColor"
                  />
                  <path
                    d="M12 17C9.24 17 7 14.76 7 12H9C9 13.66 10.34 15 12 15C13.66 15 15 13.66 15 12H17C17 14.76 14.76 17 12 17Z"
                    fill="currentColor"
                  />
                </svg>
                <p>暂无记忆支票</p>
                <p class="memory-empty-hint">在回溯界面生成第一个记忆吧~</p>
              </div>
            </div>

            <!-- 翻页控件 -->
            <div
              class="memory-cheque-pagination"
              id="memory-cheque-pagination"
              style="display: none"
            >
              <button id="memory-prev-cheque" class="memory-page-btn">
                &lt;
              </button>
              <span id="memory-cheque-indicator" class="memory-page-info"
                >1 / 1</span
              >
              <button id="memory-next-cheque" class="memory-page-btn">
                &gt;
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <input
      type="file"
      id="preset-import-input"
      accept=".json"
      style="display: none"
    />
    <div id="wow-notification-toast" class="wow-notification-toast">
      <div class="wow-notif-icon">🔔</div>
      <div class="wow-notif-text">你收到了一条消息 - 来自哇呜</div>
    </div>
    <script src="app.js"></script>
    <!-- Peeping Feature Modal -->
    <div id="peeping-modal" class="peeping-modal">
      <div class="peeping-overlay"></div>
      <div class="peeping-container">
        <div class="peeping-header">
          <div class="peeping-title">今日观序</div>
          <button class="peeping-close-btn">
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>

        <div class="peeping-content-area" id="peeping-content-area">
          <!-- Initial State -->
          <div class="peeping-intro">
            <div class="peeping-intro-icon">
              <svg
                width="64"
                height="64"
                viewBox="0 0 64 64"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  opacity="0.4"
                  d="M52.7733 11.2535C44.88 3.38685 32.08 3.38685 24.24 11.2535C18.72 16.7202 17.0666 24.5868 19.2 31.5202L6.66665 44.0535C5.78665 44.9602 5.17332 46.7468 5.35998 48.0268L6.15998 53.8402C6.45332 55.7602 8.23998 57.5735 10.16 57.8402L15.9733 58.6402C17.2533 58.8268 19.04 58.2402 19.9467 57.3068L22.1333 55.1202C22.6667 54.6135 22.6667 53.7602 22.1333 53.2268L16.96 48.0535C16.1867 47.2802 16.1867 46.0002 16.96 45.2268C17.7333 44.4535 19.0133 44.4535 19.7867 45.2268L24.9867 50.4268C25.4933 50.9335 26.3466 50.9335 26.8533 50.4268L32.5066 44.8002C39.4133 46.9602 47.28 45.2802 52.7733 39.8135C60.64 31.9468 60.64 19.1202 52.7733 11.2535ZM38.6666 32.0002C34.9866 32.0002 32 29.0135 32 25.3335C32 21.6535 34.9866 18.6668 38.6666 18.6668C42.3466 18.6668 45.3333 21.6535 45.3333 25.3335C45.3333 29.0135 42.3466 32.0002 38.6666 32.0002Z"
                  fill="#4ECDC4"
                />
                <path
                  d="M38.6667 32.0003C42.3486 32.0003 45.3333 29.0156 45.3333 25.3337C45.3333 21.6518 42.3486 18.667 38.6667 18.667C34.9848 18.667 32 21.6518 32 25.3337C32 29.0156 34.9848 32.0003 38.6667 32.0003Z"
                  fill="#4ECDC4"
                />
              </svg>
            </div>
            <h2>探索今日踪迹</h2>
            <p>重现TA今日的生活轨迹、消费记录与内心独白。</p>
            <button id="peeping-start-btn" class="peeping-action-btn">
              <span class="btn-text">开始观序</span>
              <div class="btn-loader"></div>
            </button>
          </div>

          <!-- Timeline Container (Hidden initially) -->
          <div
            id="peeping-timeline"
            class="peeping-timeline"
            style="display: none"
          ></div>
        </div>
      </div>
    </div>

    <!-- Contact Action Sheet (Context Menu) -->
    <div
      id="contact-action-sheet"
      class="action-sheet-overlay"
      style="display: none"
    >
      <div class="action-sheet-content">
        <div class="action-sheet-group">
          <button id="action-sheet-pin" class="action-sheet-btn">
            置顶对话
          </button>
          <button id="action-sheet-delete" class="action-sheet-btn danger-text">
            删除对话
          </button>
        </div>
        <div class="action-sheet-group cancel-group">
          <button id="action-sheet-cancel" class="action-sheet-btn">
            取消
          </button>
        </div>
      </div>
    </div>

    <!-- Location Input Modal -->
    <div id="location-input-modal" class="modal-overlay" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h2>分享定位</h2>
          <button id="location-modal-close-btn" class="modal-close-button">
            &times;
          </button>
        </div>
        <div
          class="modal-body"
          style="
            gap: 15px;
            padding: 15px 20px;
            display: flex;
            flex-direction: column;
          "
        >
          <div class="form-group">
            <label for="location-name-input">位置名称</label>
            <input
              type="text"
              id="location-name-input"
              class="form-input"
              placeholder="例如：万达广场"
              required
            />
          </div>
          <div class="form-group">
            <label for="location-address-input">详细地址</label>
            <input
              type="text"
              id="location-address-input"
              class="form-input"
              placeholder="例如：江城市梧桐路永新街002号"
              required
            />
          </div>
          <div class="form-group">
            <label for="location-distance-input">距离 (km)</label>
            <input
              type="number"
              id="location-distance-input"
              class="form-input"
              placeholder="0.0"
              step="0.1"
              min="0"
              required
            />
          </div>
        </div>
        <div class="modal-footer">
          <button id="send-location-btn" class="save-button">发送</button>
        </div>
      </div>
    </div>

    <!-- ======================== -->
    <!-- 🏮 逸事 Modal (Anecdotes) -->
    <!-- ======================== -->
    <div id="anecdotes-modal" class="anecdotes-modal">
      <!-- 关闭按钮 -->
      <button id="anecdotes-close-btn" class="anecdotes-close-btn">
        &times;
      </button>

      <!-- 爱品入口 -->
      <button
        id="anecdotes-collection-btn"
        class="anecdotes-collection-btn"
        title="爱品"
      >
        <svg
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20" />
          <path
            d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"
          />
        </svg>
      </button>

      <!-- 古风宝盒 -->
      <div id="anecdotes-box" class="treasure-box">
        <div class="box-glow"></div>
        <div class="box-lid"></div>
        <div class="box-body"></div>
      </div>

      <!-- 信纸容器 -->
      <div id="anecdotes-letter" class="letter-container">
        <div class="letter-paper">
          <!-- 输入模式 -->
          <div id="letter-input-view" class="letter-input-mode">
            <div class="letter-title">📜 落笔成书</div>
            <textarea
              id="anecdotes-input"
              class="letter-textarea"
              placeholder="在此写下你想说的话，亦或是想象的场景..."
            ></textarea>
            <button id="anecdotes-confirm-btn" class="letter-confirm-btn">
              封笺寄出
            </button>
          </div>

          <!-- 响应模式 (初始隐藏) -->
          <div
            id="letter-response-view"
            class="letter-response-mode"
            style="display: none"
          >
            <div id="anecdotes-response-content" class="letter-content"></div>
            <div id="anecdotes-signature" class="letter-signature"></div>
            <div
              class="letter-actions"
              style="margin-top: 20px; display: flex; gap: 10px"
            >
              <button
                id="anecdotes-remail-btn"
                class="letter-again-btn"
                style="flex: 1; border-top: 1px dashed #ddd; margin-top: 0"
              >
                ↻ 重新邮寄
              </button>
              <button
                id="anecdotes-again-btn"
                class="letter-again-btn"
                style="flex: 1; border-top: 1px dashed #ddd; margin-top: 0"
              >
                ✎ 再写一封
              </button>
            </div>
          </div>

          <!-- 加载状态 (初始隐藏) -->
          <div
            id="letter-loading-view"
            class="letter-loading"
            style="display: none"
          >
            <div class="letter-loading-spinner"></div>
            <div class="letter-loading-text">信件正在邮寄...</div>
          </div>
        </div>
      </div>

      <!-- 提示文字 -->
      <div id="anecdotes-hint" class="anecdotes-hint">
        轻启信封，书写此刻心绪
      </div>

      <!-- 爱品 (收藏夹) 界面 -->
      <div id="anecdotes-collection-modal" class="anecdotes-collection-modal">
        <div class="collection-binder">
          <div class="binder-header">
            <h2>爱品 · 珍藏</h2>
            <button id="collection-close-btn" class="collection-close-btn">
              ×
            </button>
          </div>
          <div id="collection-list" class="collection-list">
            <!-- 列表项由 JS 生成 -->
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
